<!DOCTYPE HTML>
<html lang="en" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Variables and Interpolation - Prodigy Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="AI-powered workflow orchestration for development teams">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Prodigy Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/iepathos/prodigy" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/iepathos/prodigy/edit/main/book/src/variables.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="variable-interpolation"><a class="header" href="#variable-interpolation">Variable Interpolation</a></h1>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>Prodigy provides two complementary variable systems:</p>
<ol>
<li><strong>Built-in Variables</strong>: Automatically available based on workflow context (workflow state, step info, work items, etc.)</li>
<li><strong>Custom Captured Variables</strong>: User-defined variables created via the <code>capture:</code> field in commands</li>
</ol>
<p>Both systems use the same <code>${variable.name}</code> interpolation syntax and can be freely mixed in your workflows.</p>
<h2 id="variable-availability-by-phase"><a class="header" href="#variable-availability-by-phase">Variable Availability by Phase</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Variable Category</th><th>Setup</th><th>Map</th><th>Reduce</th><th>Merge</th></tr></thead><tbody>
<tr><td>Standard Variables</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td></tr>
<tr><td>Output Variables</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td></tr>
<tr><td>Item Variables (<code>${item.*}</code>)</td><td>✗</td><td>✓</td><td>✗</td><td>✗</td></tr>
<tr><td>Map Aggregation (<code>${map.total}</code>, etc.)</td><td>✗</td><td>✗</td><td>✓</td><td>✗</td></tr>
<tr><td>Merge Variables</td><td>✗</td><td>✗</td><td>✗</td><td>✓</td></tr>
<tr><td>Custom Captured Variables</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td></tr>
</tbody></table>
</div>
<p><strong>Note</strong>: Using phase-specific variables outside their designated phase (e.g., <code>${item}</code> in reduce phase, <code>${map.results}</code> in map phase) will result in interpolation errors or empty values. Always verify variable availability matches your workflow phase.</p>
<p><strong>Reduce Phase Access to Item Data</strong>: In reduce phase, individual item variables (<code>${item.*}</code>) are not directly available, but you can access all item data through <code>${map.results}</code> which contains the aggregated results from all map agents. This allows you to process item-level information during aggregation.</p>
<h2 id="available-variables"><a class="header" href="#available-variables">Available Variables</a></h2>
<h3 id="standard-variables"><a class="header" href="#standard-variables">Standard Variables</a></h3>
<ul>
<li><code>${workflow.name}</code> - Workflow name</li>
<li><code>${workflow.id}</code> - Workflow unique identifier</li>
<li><code>${workflow.iteration}</code> - Current iteration number</li>
<li><code>${step.name}</code> - Current step name</li>
<li><code>${step.index}</code> - Current step index</li>
</ul>
<p><strong>Note</strong>: For detailed file tracking, use the Git Context Variables section below which includes <code>step.files_changed</code>, <code>step.files_added</code>, <code>step.files_modified</code>, etc.</p>
<h3 id="system-variables"><a class="header" href="#system-variables">System Variables</a></h3>
<p>These variables are automatically available in all workflow contexts:</p>
<ul>
<li><code>${PROJECT_ROOT}</code> - Absolute path to the working directory (repository root)</li>
<li><code>${WORKTREE}</code> - Name of the current worktree (if running in a Prodigy worktree session)</li>
<li><code>${git.branch}</code> - Current git branch name</li>
<li><code>${git.commit}</code> - Current git commit hash (short SHA)</li>
</ul>
<p><strong>Git Context Variables:</strong> The <code>git.branch</code> and <code>git.commit</code> variables are dynamically populated from your repository state when the workflow runs. They are not available if running outside a git repository.</p>
<p><strong>Example Usage:</strong></p>
<pre><code class="language-yaml">- shell: "cd ${PROJECT_ROOT} &amp;&amp; cargo build"
- shell: "echo 'Running on branch: ${git.branch}'"
- shell: "echo 'Commit: ${git.commit}'"
</code></pre>
<h3 id="output-variables"><a class="header" href="#output-variables">Output Variables</a></h3>
<p><strong>Primary Output Variables:</strong></p>
<ul>
<li><code>${shell.output}</code> - Output (stdout) from last shell command</li>
<li><code>${claude.output}</code> - Output from last Claude command</li>
<li><code>${last.output}</code> - Output from last executed command (any type)</li>
<li><code>${last.exit_code}</code> - Exit code from last command</li>
</ul>
<p><strong>Note</strong>: <code>${shell.output}</code> is the correct variable name for shell command output. The code uses <code>shell.output</code>, not <code>shell.stdout</code>.</p>
<p><strong>Legacy/Specialized Output Variables (Deprecated):</strong></p>
<p>These variables are still supported but <strong>deprecated</strong> in favor of custom capture:</p>
<ul>
<li><code>${handler.output}</code> - Output from handler command (used in error handling)</li>
<li><code>${test.output}</code> - Output from test command (used in validation)</li>
<li><code>${goal_seek.output}</code> - Output from goal-seeking command</li>
</ul>
<p><strong>Migration Note</strong>: These variables are automatically set by specific command types but are deprecated. Use custom capture variables (via <code>capture:</code> field) instead for explicit naming and better readability.</p>
<pre><code class="language-yaml"># OLD (deprecated):
- shell: "echo 'Result: ${shell.output}'"

# NEW (preferred):
- shell: "make build"
  capture: "build_result"
- shell: "echo 'Result: ${build_result}'"
</code></pre>
<h3 id="mapreduce-variables"><a class="header" href="#mapreduce-variables">MapReduce Variables</a></h3>
<p><strong>Map Phase Variables</strong> (available in <code>agent_template:</code> commands):</p>
<ul>
<li><code>${item}</code> - Current work item in map phase (scope: map phase only)</li>
<li><code>${item.value}</code> - Value of current item (for simple items)</li>
<li><code>${item.path}</code> - Path field of current item</li>
<li><code>${item.name}</code> - Name field of current item</li>
<li><code>${item.*}</code> - Access any item field using wildcard pattern (e.g., <code>${item.id}</code>, <code>${item.priority}</code>)</li>
<li><code>${item_index}</code> - Index of current item in the list</li>
<li><code>${item_total}</code> - Total number of items being processed</li>
<li><code>${map.key}</code> - Current map key</li>
<li><code>${worker.id}</code> - ID of the current worker agent</li>
</ul>
<p><strong>Reduce Phase Variables</strong> (available in <code>reduce:</code> commands):</p>
<ul>
<li><code>${map.total}</code> - Total items processed across all map agents</li>
<li><code>${map.successful}</code> - Number of successfully processed items</li>
<li><code>${map.failed}</code> - Number of failed items</li>
<li><code>${map.results}</code> - Aggregated results from all map agents (JSON array)</li>
</ul>
<p><strong>Note</strong>: <code>${item}</code> and related item variables are only available within the map phase. The aggregation variables (<code>${map.total}</code>, <code>${map.successful}</code>, <code>${map.failed}</code>, <code>${map.results}</code>) are only available in the reduce phase.</p>
<h4 id="using-mapresults-in-reduce-phase"><a class="header" href="#using-mapresults-in-reduce-phase">Using map.results in Reduce Phase</a></h4>
<p>The <code>${map.results}</code> variable contains the complete aggregated results from all map agents as a JSON array. This variable can be very large (&gt;1MB with many agents) and requires special handling.</p>
<p><strong>Supported Commands:</strong></p>
<p>✓ <strong>write_file commands</strong> - Fully supported with <code>${map.results}</code> interpolation</p>
<pre><code class="language-yaml">reduce:
  - write_file:
      path: "results.json"
      content: "${map.results}"
      format: json
</code></pre>
<p>✗ <strong>shell and Claude commands</strong> - NOT supported for <code>${map.results}</code> (environment variable size limits)</p>
<pre><code class="language-yaml"># DON'T DO THIS - Will fail with E2BIG error
reduce:
  - shell: "echo '${map.results}' &gt; results.json"  # ✗ Fails
  - claude: "/analyze ${map.results}"              # ✗ Fails
</code></pre>
<p><strong>Why the Difference?</strong></p>
<ul>
<li><strong>write_file</strong>: Uses direct interpolation without environment variables. Can handle multi-megabyte variables safely.</li>
<li><strong>shell/Claude</strong>: Must pass variables via environment variables, which have OS limits (typically ~1MB). Large <code>${map.results}</code> exceeds these limits.</li>
</ul>
<p><strong>Best Practices:</strong></p>
<ol>
<li>
<p><strong>Write map.results to file first</strong> using <code>write_file</code>:</p>
<pre><code class="language-yaml">reduce:
  # Step 1: Write results to file using write_file
  - write_file:
      path: "map_results.json"
      content: "${map.results}"
      format: json

  # Step 2: Process file in shell/Claude commands
  - shell: "jq '.[] | select(.success == true)' map_results.json &gt; successful.json"
  - claude: "/analyze-results map_results.json"
</code></pre>
</li>
<li>
<p><strong>Use scalar variables for shell/Claude</strong>:</p>
<pre><code class="language-yaml">reduce:
  # Safe - scalar values are small
  - shell: "echo 'Processed ${map.total} items'"
  - shell: "echo 'Success rate: ${map.successful}/${map.total}'"
  - claude: "/summarize-results --total ${map.total} --failed ${map.failed}"
</code></pre>
</li>
<li>
<p><strong>Format JSON properly</strong> with write_file:</p>
<pre><code class="language-yaml">reduce:
  # Prodigy will serialize map.results as valid JSON
  - write_file:
      path: "results.json"
      content: "${map.results}"
      format: json  # Ensures proper JSON formatting
</code></pre>
</li>
</ol>
<p><strong>Example Workflow:</strong></p>
<pre><code class="language-yaml">name: process-with-results
mode: mapreduce

map:
  input: "items.json"
  json_path: "$.items[*]"
  agent_template:
    - shell: "process ${item.id}"

reduce:
  # Write full results to JSON file
  - write_file:
      path: "all_results.json"
      content: "${map.results}"
      format: json

  # Write summary using scalar variables
  - write_file:
      path: "summary.txt"
      content: |
        Total Items: ${map.total}
        Successful: ${map.successful}
        Failed: ${map.failed}
      format: text

  # Process results file in shell
  - shell: "jq '[.[] | select(.success)] | length' all_results.json &gt; success_count.txt"

  # Analyze with Claude using file reference
  - claude: "/analyze all_results.json"
</code></pre>
<p><strong>Error Messages:</strong></p>
<p>If you try to use <code>${map.results}</code> in shell/Claude commands, you may see:</p>
<ul>
<li><code>E2BIG: Argument list too long</code> - Environment variable exceeded OS limits</li>
<li><code>Failed to interpolate variable</code> - Variable too large for environment</li>
</ul>
<p><strong>Solution</strong>: Always use <code>write_file</code> for <code>${map.results}</code>, then reference the file in subsequent commands.</p>
<h3 id="merge-variables"><a class="header" href="#merge-variables">Merge Variables</a></h3>
<ul>
<li><code>${merge.worktree}</code> - Worktree name</li>
<li><code>${merge.source_branch}</code> - Source branch</li>
<li><code>${merge.target_branch}</code> - Target branch</li>
<li><code>${merge.session_id}</code> - Session ID</li>
</ul>
<h3 id="validation-variables"><a class="header" href="#validation-variables">Validation Variables</a></h3>
<ul>
<li><code>${validation.completion}</code> - Completion percentage (numeric, same as completion_percentage)</li>
<li><code>${validation.completion_percentage}</code> - Completion percentage (numeric, explicit alias)</li>
<li><code>${validation.implemented}</code> - List of implemented features</li>
<li><code>${validation.missing}</code> - Missing requirements</li>
<li><code>${validation.missing_count}</code> - Number of missing requirements (numeric)</li>
<li><code>${validation.gaps}</code> - Gap details</li>
<li><code>${validation.status}</code> - Status (complete/incomplete/failed)</li>
</ul>
<p><strong>Note</strong>: <code>validation.completion</code> and <code>validation.completion_percentage</code> are equivalent - both return the numeric completion percentage value.</p>
<h3 id="git-context-variables"><a class="header" href="#git-context-variables">Git Context Variables</a></h3>
<p><strong>Commit Tracking:</strong></p>
<ul>
<li><code>${step.commits}</code> - Space-separated commit hashes from current step</li>
<li><code>${workflow.commits}</code> - Space-separated commit hashes from entire workflow</li>
</ul>
<p><strong>Note</strong>: These are space-separated strings of commit hashes (e.g., “abc123 def456 ghi789”), not arrays. Use in shell commands that accept commit lists.</p>
<p><strong>File Change Tracking:</strong></p>
<ul>
<li><code>${step.files_added}</code> - Space-separated list of files added in current step</li>
<li><code>${step.files_modified}</code> - Space-separated list of files modified in current step</li>
<li><code>${step.files_deleted}</code> - Space-separated list of files deleted in current step</li>
<li><code>${step.files_changed}</code> - Space-separated list of all changed files (union of added, modified, deleted)</li>
<li><code>${step.commit_count}</code> - Number of commits in current step (numeric)</li>
<li><code>${step.insertions}</code> - Lines added in current step (numeric)</li>
<li><code>${step.deletions}</code> - Lines removed in current step (numeric)</li>
</ul>
<p><strong>Workflow Change Tracking:</strong></p>
<ul>
<li><code>${workflow.files_added}</code> - Space-separated list of all files added in entire workflow</li>
<li><code>${workflow.files_modified}</code> - Space-separated list of all files modified in entire workflow</li>
<li><code>${workflow.files_deleted}</code> - Space-separated list of all files deleted in entire workflow</li>
<li><code>${workflow.files_changed}</code> - Space-separated list of all changed files in entire workflow</li>
<li><code>${workflow.commit_count}</code> - Total commits in entire workflow (numeric)</li>
<li><code>${workflow.insertions}</code> - Total lines added in entire workflow (numeric)</li>
<li><code>${workflow.deletions}</code> - Total lines removed in entire workflow (numeric)</li>
</ul>
<p><strong>Example Usage:</strong></p>
<pre><code class="language-yaml"># Check if step made changes
- shell: "echo 'Step made ${step.commit_count} commits'"
- shell: "echo 'Modified files: ${step.files_modified}'"
- shell: "echo 'Code changes: +${step.insertions}/-${step.deletions} lines'"

# Use commit hashes
- shell: "git show ${step.commits}"
- shell: "echo 'All commits: ${workflow.commits}'"

# Use file lists in shell commands
- shell: "for file in ${step.files_changed}; do echo $file; done"
- shell: "wc -l ${step.files_added}"  # Count lines in newly added files
</code></pre>
<h3 id="legacy-variable-aliases"><a class="header" href="#legacy-variable-aliases">Legacy Variable Aliases</a></h3>
<p>These legacy aliases are supported for backward compatibility but should be replaced with modern equivalents:</p>
<ul>
<li><code>$ARG</code> / <code>$ARGUMENT</code> - Legacy aliases for <code>${item.value}</code> (available in WithArguments mode)</li>
<li><code>$FILE</code> / <code>$FILE_PATH</code> - Legacy aliases for <code>${item.path}</code> (available in WithFilePattern mode)</li>
</ul>
<p><strong>Note:</strong> Use the modern <code>${item.*}</code> syntax in new workflows instead of legacy aliases.</p>
<hr />
<h2 id="custom-variable-capture"><a class="header" href="#custom-variable-capture">Custom Variable Capture</a></h2>
<p>Custom capture variables allow you to save command output with explicit names for later use. This is the recommended approach for most workflows instead of relying on automatic output variables.</p>
<h3 id="basic-capture-examples"><a class="header" href="#basic-capture-examples">Basic Capture Examples</a></h3>
<pre><code class="language-yaml"># Capture to custom variable
- shell: "ls -la | wc -l"
  capture: "file_count"
  capture_format: number  # Default: string

# Use in next command
- shell: "echo 'Found ${file_count} files'"
</code></pre>
<h3 id="capture-formats"><a class="header" href="#capture-formats">Capture Formats</a></h3>
<p>The <code>capture_format</code> field determines how output is parsed and stored:</p>
<pre><code class="language-yaml"># String format (default) - stores raw output
- shell: "echo 'Hello World'"
  capture: "greeting"
  capture_format: string
# Access: ${greeting} → "Hello World"

# Number format - parses numeric output
- shell: "echo 42"
  capture: "answer"
  capture_format: number
# Access: ${answer} → 42 (as number, not string)

# Boolean format - converts to true/false
- shell: "[ -f README.md ] &amp;&amp; echo true || echo false"
  capture: "has_readme"
  capture_format: boolean
# Access: ${has_readme} → true or false

# JSON format - parses JSON output
- shell: "echo '{\"name\": \"project\", \"version\": \"1.0\"}'"
  capture: "package_info"
  capture_format: json
# Access nested fields: ${package_info.name} → "project"
# Access nested fields: ${package_info.version} → "1.0"

# Lines format - splits into array by newlines
- shell: "ls *.md"
  capture: "markdown_files"
  capture_format: lines
# Access: ${markdown_files} → array of filenames
</code></pre>
<h3 id="capture-streams"><a class="header" href="#capture-streams">Capture Streams</a></h3>
<p>Control which output streams to capture (useful for detailed command analysis):</p>
<pre><code class="language-yaml"># Capture specific streams
- shell: "cargo test 2&gt;&amp;1"
  capture: "test_results"
  capture_streams:
    stdout: true      # Default: true
    stderr: true      # Default: false
    exit_code: true   # Default: true
    success: true     # Default: true
    duration: true    # Default: true

# Access captured stream data
- shell: "echo 'Exit code: ${test_results.exit_code}'"
- shell: "echo 'Success: ${test_results.success}'"
- shell: "echo 'Duration: ${test_results.duration}s'"
</code></pre>
<p><strong>Default Behavior</strong>: By default, <code>stdout</code>, <code>exit_code</code>, <code>success</code>, and <code>duration</code> are captured (all <code>true</code>). Set <code>stderr: true</code> to also capture error output.</p>
<h3 id="nested-json-field-access"><a class="header" href="#nested-json-field-access">Nested JSON Field Access</a></h3>
<p>For JSON-formatted captures, use dot notation to access nested fields:</p>
<pre><code class="language-yaml"># Example: API response with nested data
- shell: "curl -s https://api.example.com/user/123"
  capture: "user"
  capture_format: json

# Access nested fields with dot notation
- shell: "echo 'Name: ${user.profile.name}'"
- shell: "echo 'Email: ${user.contact.email}'"
- shell: "echo 'City: ${user.address.city}'"
</code></pre>
<p><strong>Error Handling</strong>: Accessing non-existent fields (e.g., <code>${user.missing.field}</code>) will return an error. Ensure your JSON structure matches your field access patterns, or use validation to handle missing fields gracefully.</p>
<h3 id="variable-scope-and-precedence"><a class="header" href="#variable-scope-and-precedence">Variable Scope and Precedence</a></h3>
<p>Variables follow a parent/child scope hierarchy:</p>
<ol>
<li><strong>Local Scope</strong>: Variables defined in the current command block</li>
<li><strong>Parent Scope</strong>: Variables from enclosing blocks (foreach, map phase, etc.)</li>
<li><strong>Built-in Variables</strong>: Standard workflow context variables</li>
</ol>
<p><strong>Precedence</strong>: Local variables override parent scope variables, which override built-in variables.</p>
<p><strong>Scope Lifetime</strong>: Child scopes are temporary. When a child block (foreach loop, map phase agent) completes, its local variables are discarded and the parent scope is automatically restored.</p>
<pre><code class="language-yaml"># Parent scope
- shell: "echo 'outer'"
  capture: "message"

# Child scope (foreach creates new scope)
- foreach:
    items: [1, 2, 3]
    commands:
      # This creates a local 'message' that shadows parent
      - shell: "echo 'inner-${item}'"
        capture: "message"
      - shell: "echo ${message}"  # Uses local 'message'

# After foreach, parent 'message' is still accessible
# The local 'message' from foreach is discarded
- shell: "echo ${message}"  # Uses parent 'message' → "outer"
</code></pre>
<hr />
<h2 id="troubleshooting-variable-interpolation"><a class="header" href="#troubleshooting-variable-interpolation">Troubleshooting Variable Interpolation</a></h2>
<h3 id="common-errors-and-solutions"><a class="header" href="#common-errors-and-solutions">Common Errors and Solutions</a></h3>
<p><strong>Error: “Variable not found: item”</strong></p>
<ul>
<li><strong>Cause</strong>: Using <code>${item}</code> or <code>${item.*}</code> outside the map phase</li>
<li><strong>Solution</strong>: Item variables are only available in <code>agent_template:</code> commands within MapReduce workflows. Move your code to the map phase or use a different variable.</li>
</ul>
<p><strong>Error: “Variable not found: map.results”</strong></p>
<ul>
<li><strong>Cause</strong>: Using <code>${map.results}</code> outside the reduce phase</li>
<li><strong>Solution</strong>: Map aggregation variables are only available in <code>reduce:</code> commands. See the phase availability table above.</li>
</ul>
<p><strong>Error: “Failed to parse JSON field”</strong></p>
<ul>
<li><strong>Cause</strong>: Accessing a non-existent nested field in a JSON capture</li>
<li><strong>Solution</strong>: Verify your JSON structure matches your field access. Use <code>jq</code> or similar tools to inspect the JSON first.</li>
</ul>
<p><strong>Error: “Invalid variable interpolation syntax”</strong></p>
<ul>
<li><strong>Cause</strong>: Missing <code>${}</code> braces or incorrect syntax</li>
<li><strong>Solution</strong>: Always use <code>${variable.name}</code> format. Shell-style <code>$VAR</code> is not supported for Prodigy variables (only for environment variables).</li>
</ul>
<p><strong>Empty/Undefined Variable Value</strong></p>
<ul>
<li><strong>Cause</strong>: Variable hasn’t been set yet, or phase mismatch</li>
<li><strong>Solution</strong>: Check command order and ensure the variable is captured before use. Review the phase availability table.</li>
</ul>
<h3 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h3>
<ol>
<li><strong>Use custom capture for clarity</strong>: Prefer <code>capture: "my_var"</code> over automatic <code>${shell.output}</code></li>
<li><strong>Name variables descriptively</strong>: Use <code>${test_results}</code> not <code>${x}</code></li>
<li><strong>Validate JSON captures</strong>: Test JSON structure before accessing nested fields</li>
<li><strong>Check phase availability</strong>: Ensure variables match your workflow phase</li>
<li><strong>Use appropriate capture formats</strong>: <code>number</code>, <code>json</code>, <code>boolean</code> provide type safety</li>
</ol>
<hr />
<h2 id="see-also"><a class="header" href="#see-also">See Also</a></h2>
<ul>
<li><strong><a href="./commands.html">Command Types</a></strong> - Learn about command types and their capture behavior</li>
<li><strong><a href="./mapreduce.html">MapReduce Workflows</a></strong> - Deep dive into MapReduce variables and phases</li>
<li><strong><a href="./environment.html">Environment Variables</a></strong> - Using environment variables in workflows</li>
<li><strong><a href="./examples.html">Workflow Examples</a></strong> - Practical examples using variables in real workflows</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="commands.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="environment.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="commands.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="environment.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
