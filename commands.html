<!DOCTYPE HTML>
<html lang="en" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Command Types - Prodigy Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="AI-powered workflow orchestration for development teams">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Prodigy Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/iepathos/prodigy" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/iepathos/prodigy/edit/main/book/src/commands.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="command-types"><a class="header" href="#command-types">Command Types</a></h1>
<h2 id="1-shell-commands"><a class="header" href="#1-shell-commands">1. Shell Commands</a></h2>
<pre><code class="language-yaml"># Simple shell command
- shell: "cargo test"

# With output capture
- shell: "ls -la | wc -l"
  capture_output: "file_count"

# With failure handling
- shell: "cargo clippy"
  on_failure:
    claude: "/fix-warnings ${shell.output}"

# With nested failure handlers (multi-level error recovery)
- shell: "cargo test"
  on_failure:
    claude: "/debug-test-failures ${shell.output}"
    on_failure:
      shell: "notify-team.sh 'Tests failed and debugging unsuccessful'"

# With timeout
- shell: "cargo bench"
  timeout: 600  # seconds

# With conditional execution
- shell: "cargo build --release"
  when: "${tests_passed}"

# Working directory control (use shell cd command)
- shell: "cd crates/prodigy-core &amp;&amp; cargo test"

# Environment variables (use shell syntax)
- shell: "PATH=/custom/bin:$PATH rustfmt --check src/**/*.rs"
</code></pre>
<h2 id="2-claude-commands"><a class="header" href="#2-claude-commands">2. Claude Commands</a></h2>
<pre><code class="language-yaml"># Simple Claude command
- claude: "/prodigy-analyze"

# With arguments
- claude: "/prodigy-implement-spec ${spec_file}"

# With commit requirement
- claude: "/prodigy-fix-bugs"
  commit_required: true

# With output capture
- claude: "/prodigy-generate-plan"
  capture_output: "implementation_plan"
</code></pre>
<h2 id="3-goal-seeking-commands"><a class="header" href="#3-goal-seeking-commands">3. Goal-Seeking Commands</a></h2>
<p>Iteratively refine code until a validation threshold is met.</p>
<pre><code class="language-yaml">- goal_seek:
    goal: "Achieve 90% test coverage"
    claude: "/prodigy-coverage --improve"
    validate: "cargo tarpaulin --print-summary | grep 'Coverage' | sed 's/.*Coverage=\\([0-9]*\\).*/score: \\1/'"
    threshold: 90
    max_attempts: 5
    timeout_seconds: 300
    fail_on_incomplete: true
  commit_required: true
</code></pre>
<p><strong>Fields:</strong></p>
<ul>
<li><code>goal</code>: Human-readable description</li>
<li><code>claude</code> or <code>shell</code>: Command to execute for refinement</li>
<li><code>validate</code>: Command that outputs <code>score: N</code> (0-100)</li>
<li><code>threshold</code>: Minimum score to consider complete</li>
<li><code>max_attempts</code>: Maximum refinement iterations</li>
<li><code>timeout_seconds</code>: Optional timeout per attempt</li>
<li><code>fail_on_incomplete</code>: Whether to fail workflow if threshold not met (default: true)</li>
</ul>
<p><strong>Troubleshooting:</strong></p>
<ul>
<li><strong>Threshold not met:</strong> Check that validate command outputs exactly <code>score: N</code> format (0-100)</li>
<li><strong>Not converging:</strong> Use <code>fail_on_incomplete: false</code> for optional quality gates</li>
<li><strong>Debug scores:</strong> Run workflow with verbose mode (<code>-v</code>) to see validation scores each iteration</li>
<li><strong>Max attempts reached:</strong> Increase <code>max_attempts</code> or lower <code>threshold</code> if goal is too ambitious</li>
</ul>
<h2 id="4-foreach-commands"><a class="header" href="#4-foreach-commands">4. Foreach Commands</a></h2>
<p>Iterate over a list with optional parallelism.</p>
<pre><code class="language-yaml">- foreach:
    input: "find . -name '*.rs' -type f"  # Command
    # OR
    # input: ["file1.rs", "file2.rs"]    # List

    parallel: 5  # Number of parallel executions (or true/false)

    do:
      - claude: "/analyze-file ${item}"
      - shell: "cargo check ${item}"

    continue_on_error: true
    max_items: 50
</code></pre>
<p><strong>Variables and Error Handling:</strong></p>
<ul>
<li><strong>${item}</strong>: Current item value available in loop body</li>
<li><strong>continue_on_error: true</strong> (default): Failed items don’t stop the loop</li>
<li><strong>Parallel execution caveat</strong>: Output order is not guaranteed when using <code>parallel</code></li>
<li><strong>No built-in result aggregation</strong>: Use <code>write_file</code> commands to collect results if needed</li>
</ul>
<p><strong>Example with result collection:</strong></p>
<pre><code class="language-yaml">- foreach:
    input: ["module1", "module2", "module3"]
    parallel: 3
    do:
      - shell: "cargo test --package ${item}"
      - write_file:
          path: "results/${item}.txt"
          content: "Test result: ${shell.output}"
          create_dirs: true
</code></pre>
<h2 id="5-write-file-commands"><a class="header" href="#5-write-file-commands">5. Write File Commands</a></h2>
<p>Create or overwrite files with content from variables or literals. Supports text, JSON, and YAML formats with automatic validation and formatting.</p>
<pre><code class="language-yaml"># Write plain text file
- write_file:
    path: "output/result.txt"
    content: "Build completed at ${shell.output}"
    format: text
    mode: "0644"
    create_dirs: true

# Write JSON file with validation
- write_file:
    path: "config/generated.json"
    content: |
      {
        "version": "${version}",
        "timestamp": "${timestamp}",
        "items": ${items_json}
      }
    format: json

# Write YAML file with formatting
- write_file:
    path: ".prodigy/metadata.yml"
    content: |
      workflow: ${workflow.name}
      iteration: ${workflow.iteration}
      results:
        success: ${map.successful}
        total: ${map.total}
    format: yaml
</code></pre>
<p><strong>WriteFileConfig Fields:</strong></p>
<ul>
<li><code>path</code> - File path to write (supports variable interpolation)</li>
<li><code>content</code> - Content to write (supports variable interpolation)</li>
<li><code>format</code> - Output format: <code>text</code> (default), <code>json</code>, <code>yaml</code></li>
<li><code>mode</code> - File permissions in octal (default: “0644”)</li>
<li><code>create_dirs</code> - Create parent directories if they don’t exist (default: false)</li>
</ul>
<p><strong>Format Validation:</strong></p>
<ul>
<li><code>json</code> - Validates JSON syntax and pretty-prints output</li>
<li><code>yaml</code> - Validates YAML syntax and formats output</li>
<li><code>text</code> - Writes content as-is without validation</li>
</ul>
<p><strong>Best Practices:</strong></p>
<ul>
<li><strong>Use format validation for config files</strong>: Set <code>format: json</code> or <code>format: yaml</code> when generating configuration files to catch syntax errors early</li>
<li><strong>Set appropriate permissions</strong>: Use <code>mode</code> field to control file permissions (e.g., <code>"0600"</code> for sensitive files)</li>
<li><strong>Handle nested paths</strong>: Set <code>create_dirs: true</code> when writing to paths that may not exist</li>
<li><strong>Combine with validation</strong>: Use <code>validate</code> field to ensure generated files meet requirements before proceeding</li>
<li><strong>For logs and documentation</strong>: Use <code>format: text</code> to write content as-is without validation overhead</li>
</ul>
<h2 id="6-validation-commands"><a class="header" href="#6-validation-commands">6. Validation Commands</a></h2>
<p>Validate implementation completeness with automatic retry.</p>
<blockquote>
<p><strong>Warning:</strong> The <code>command</code> field in ValidationConfig is deprecated. Use <code>shell</code> instead for shell commands or <code>claude</code> for Claude commands. The <code>command</code> field is still supported for backward compatibility but will be removed in a future version.</p>
</blockquote>
<pre><code class="language-yaml">- claude: "/implement-auth-spec"
  validate:
    shell: "debtmap validate --spec auth.md --output result.json"
    result_file: "result.json"
    threshold: 95  # Percentage completion required (default: 100.0)
    timeout: 60
    expected_schema: "validation-schema.json"  # Optional JSON schema

    # What to do if incomplete
    on_incomplete:
      claude: "/complete-implementation ${validation.gaps}"
      max_attempts: 3
      fail_workflow: true
      commit_required: true
      prompt: "Implementation incomplete. Continue?"  # Optional interactive prompt
</code></pre>
<p><strong>ValidationConfig Fields:</strong></p>
<ul>
<li><code>shell</code> or <code>claude</code> - Single validation command (use <code>shell</code>, not deprecated <code>command</code>)</li>
<li><code>commands</code> - Array of commands for multi-step validation</li>
<li><code>result_file</code> - Path to JSON file with validation results</li>
<li><code>threshold</code> - Minimum completion percentage (default: 100.0)</li>
<li><code>timeout</code> - Timeout in seconds</li>
<li><code>expected_schema</code> - JSON schema for validation output structure</li>
</ul>
<p><strong>OnIncompleteConfig Fields:</strong></p>
<ul>
<li><code>shell</code> or <code>claude</code> - Single gap-filling command</li>
<li><code>commands</code> - Array of commands for multi-step gap filling</li>
<li><code>max_attempts</code> - Maximum retry attempts (default: 2)</li>
<li><code>fail_workflow</code> - Whether to fail workflow if validation incomplete (default: true)</li>
<li><code>commit_required</code> - Whether to require commit after gap filling (default: false)</li>
<li><code>prompt</code> - Optional interactive prompt for user guidance</li>
</ul>
<p><strong>Alternative: Array format for multi-step validation</strong></p>
<pre><code class="language-yaml">- claude: "/implement-feature"
  validate:
    # When using array format, ValidationConfig uses default threshold (100.0)
    # and creates a commands array
    - shell: "run-tests.sh"
    - shell: "check-coverage.sh"
    - claude: "/validate-implementation --output validation.json"
      result_file: "validation.json"
</code></pre>
<p><strong>Alternative: Multi-step gap filling</strong></p>
<pre><code class="language-yaml">- claude: "/implement-feature"
  validate:
    shell: "validate.sh"
    result_file: "result.json"
    on_incomplete:
      commands:
        - claude: "/analyze-gaps ${validation.gaps}"
        - shell: "run-fix-script.sh"
        - claude: "/verify-fixes"
      max_attempts: 2
</code></pre>
<hr />
<h2 id="command-reference"><a class="header" href="#command-reference">Command Reference</a></h2>
<h3 id="command-fields"><a class="header" href="#command-fields">Command Fields</a></h3>
<p>All command types support these common fields:</p>
<p><strong>Source</strong>: src/config/command.rs:320-401</p>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>id</code></td><td>string</td><td>Unique identifier for referencing outputs</td></tr>
<tr><td><code>timeout</code></td><td>number</td><td>Command timeout in seconds</td></tr>
<tr><td><code>commit_required</code></td><td>boolean</td><td>Whether command should create a git commit</td></tr>
<tr><td><code>when</code></td><td>string</td><td>Conditional execution expression</td></tr>
<tr><td><code>capture_output</code></td><td>boolean/string</td><td>Capture command output to a variable (boolean for default “output” var, string for custom name)</td></tr>
<tr><td><code>capture_format</code></td><td>enum</td><td>Output parsing format: <code>string</code> (default), <code>number</code>, <code>json</code>, <code>lines</code>, <code>boolean</code></td></tr>
<tr><td><code>on_success</code></td><td>object</td><td>Command to run on success</td></tr>
<tr><td><code>on_failure</code></td><td>object</td><td>Error handling configuration (see OnFailure Handler section below)</td></tr>
<tr><td><code>validate</code></td><td>object</td><td>Validation configuration for implementation completeness</td></tr>
<tr><td><code>output_file</code></td><td>string</td><td>Redirect command output to a file path</td></tr>
</tbody></table>
</div>
<p><strong>Note on Field Availability</strong>: All fields in this table are available in the user-facing YAML WorkflowStepCommand format (src/config/command.rs:320-401). Additional fields like <code>working_dir</code>, <code>env</code>, <code>on_exit_code</code>, and <code>capture</code> exist in the internal WorkflowStep representation (src/cook/workflow/executor/data_structures.rs:35-157) but are NOT exposed in YAML. See the Technical Notes section below for workarounds.</p>
<h3 id="onfailure-handler-configuration"><a class="header" href="#onfailure-handler-configuration">OnFailure Handler Configuration</a></h3>
<p>The <code>on_failure</code> field accepts an <code>OnFailureConfig</code> which supports multiple configuration formats:</p>
<p><strong>Source</strong>: src/cook/workflow/on_failure.rs:67-115</p>
<p><strong>Simple Format - Single Command:</strong></p>
<pre><code class="language-yaml">- shell: "cargo clippy"
  on_failure:
    claude: "/fix-warnings ${shell.output}"
</code></pre>
<p><strong>Advanced Format - With Retry Control:</strong></p>
<pre><code class="language-yaml">- shell: "cargo test"
  on_failure:
    claude: "/debug-test-failures ${shell.output}"
    max_retries: 3              # Maximum retry attempts (default: 1)
    fail_workflow: false        # Continue workflow even after failure handling
    retry_original: true        # Retry original command after handler (default: false)
</code></pre>
<p><strong>Detailed Format - With Handler Strategy:</strong></p>
<p>For fine-grained control over failure handling behavior, use the Detailed format with <code>FailureHandlerConfig</code> (src/cook/workflow/on_failure.rs:9-49):</p>
<pre><code class="language-yaml">- shell: "cargo build"
  on_failure:
    commands:
      - claude: "/analyze-build-errors ${shell.output}"
      - shell: "cargo clean &amp;&amp; cargo build"
    strategy: recovery          # recovery, fallback, cleanup, or custom
    timeout: 300                # Handler timeout in seconds
    fail_workflow: false        # Whether to fail workflow after handling
    handler_failure_fatal: true # Whether handler failure should be fatal
</code></pre>
<p><strong>Handler Strategies</strong> (src/cook/workflow/on_failure.rs:9-22):</p>
<ul>
<li><code>recovery</code> (default) - Attempt to fix the problem and retry the original operation. Use this when failures are transient or can be resolved programmatically.</li>
<li><code>fallback</code> - Use an alternative approach when the primary method fails. Best for scenarios with multiple valid execution paths.</li>
<li><code>cleanup</code> - Perform resource cleanup before failing. Use for releasing locks, closing connections, or removing temporary files.</li>
<li><code>custom</code> - Custom handler logic for specialized error recovery patterns not covered by other strategies.</li>
</ul>
<p><strong>Real-World Examples:</strong></p>
<p>From <code>workflows/coverage.yml</code> (lines 13-17):</p>
<pre><code class="language-yaml">- shell: "just test"
  on_failure:
    claude: "/prodigy-debug-test-failure --spec ${coverage.spec} --output ${shell.output}"
    max_attempts: 3
    fail_workflow: false
</code></pre>
<p>From <code>workflows/implement.yml</code> (lines 20-30):</p>
<pre><code class="language-yaml">- shell: "just test"
  on_failure:
    claude: "/prodigy-debug-test-failure --spec $ARG --output ${shell.output}"
    max_attempts: 5
    fail_workflow: false
</code></pre>
<p><strong>Nested Failure Handlers:</strong></p>
<pre><code class="language-yaml">- shell: "cargo test"
  on_failure:
    claude: "/debug-test-failures ${shell.output}"
    on_failure:
      shell: "notify-team.sh 'Tests failed and debugging unsuccessful'"
</code></pre>
<h3 id="planned-feature-capturestreams"><a class="header" href="#planned-feature-capturestreams">Planned Feature: CaptureStreams</a></h3>
<blockquote>
<p><strong>Note:</strong> The <code>capture_streams</code> field is defined in WorkflowStepCommand (src/config/command.rs:394-396) but is <strong>reserved for future use</strong> and not yet functional in YAML workflows.</p>
<p><strong>Why it’s not available yet</strong>: The field exists as a <code>String</code> placeholder in the YAML parser, but the execution engine doesn’t yet support fine-grained stream capture control. This feature is planned to provide selective capture of stdout, stderr, exit codes, success status, and execution duration.</p>
</blockquote>
<p><strong>Current Approach:</strong> Use the <code>capture_output</code> and <code>capture_format</code> fields to control output capture, which cover most common use cases:</p>
<pre><code class="language-yaml"># Capture stdout as string (most common use case)
- shell: "cargo test"
  capture_output: "test_output"
  capture_format: "string"

# Capture exit status as boolean
- shell: "cargo test"
  capture_output: "test_passed"
  capture_format: "boolean"

# Capture and parse JSON output
- shell: "cargo metadata --format-version 1"
  capture_output: "project_info"
  capture_format: "json"
</code></pre>
<p><strong>When will this be available?</strong> This feature requires execution engine changes to support the internal <code>CaptureStreams</code> type (src/cook/workflow/executor/data_structures.rs:83). Until then, use the <code>capture_output</code> and <code>capture_format</code> fields which cover most common use cases.</p>
<h3 id="capture-format-examples"><a class="header" href="#capture-format-examples">Capture Format Examples</a></h3>
<p>The <code>capture_format</code> field controls how captured output is parsed:</p>
<pre><code class="language-yaml"># String format (default) - raw text output
- shell: "git rev-parse HEAD"
  capture: "commit_hash"
  capture_format: "string"

# Number format - parses numeric output
- shell: "wc -l &lt; file.txt"
  capture: "line_count"
  capture_format: "number"

# JSON format - parses JSON output
- shell: "cargo metadata --format-version 1"
  capture: "project_metadata"
  capture_format: "json"

# Lines format - splits output into array of lines
- shell: "git diff --name-only"
  capture: "changed_files"
  capture_format: "lines"

# Boolean format - true if command succeeds, false otherwise
- shell: "grep -q 'pattern' file.txt"
  capture: "pattern_found"
  capture_format: "boolean"
</code></pre>
<h3 id="deprecated-fields"><a class="header" href="#deprecated-fields">Deprecated Fields</a></h3>
<blockquote>
<p><strong>Warning:</strong> The following fields are deprecated but still supported for backward compatibility. They will be removed in a future version. Please migrate to the recommended alternatives.</p>
</blockquote>
<p>These fields are deprecated:</p>
<ul>
<li><code>test:</code> - <strong>Use <code>shell:</code> with <code>on_failure:</code> instead</strong></li>
<li><code>command:</code> in ValidationConfig - <strong>Use <code>shell:</code> instead</strong></li>
<li>Nested <code>commands:</code> in <code>agent_template</code> and <code>reduce</code> - <strong>Use direct array format instead</strong></li>
<li>Legacy variable aliases (<code>$ARG</code>, <code>$ARGUMENT</code>, <code>$FILE</code>, <code>$FILE_PATH</code>) - <strong>Use modern <code>${item.*}</code> syntax</strong></li>
</ul>
<p><strong>Using capture_output Field</strong></p>
<p>The <code>capture_output</code> field supports both Boolean and String variants for backward compatibility:</p>
<p><strong>Source</strong>: src/config/command.rs:366-368 (CaptureOutputConfig enum: src/config/command.rs:403-411)</p>
<pre><code class="language-yaml"># String variant - captures to named variable (recommended)
- shell: "git rev-parse HEAD"
  capture_output: "commit_hash"

# Boolean variant - captures to default "output" variable
- shell: "ls -la | wc -l"
  capture_output: true
</code></pre>
<p><strong>Migration Guide - capture_output Variants:</strong></p>
<p>The <code>capture_output</code> field accepts both boolean and string values for backward compatibility:</p>
<div class="table-wrapper"><table><thead><tr><th>Syntax</th><th>Variable Name</th><th>When to Use</th></tr></thead><tbody>
<tr><td><code>capture_output: true</code></td><td><code>${output}</code></td><td>Quick capture to default variable</td></tr>
<tr><td><code>capture_output: "myvar"</code></td><td><code>${myvar}</code></td><td>Recommended: explicit variable name</td></tr>
</tbody></table>
</div>
<p><strong>Before and After Examples:</strong></p>
<pre><code class="language-yaml"># Boolean variant - captures to ${output}
# BEFORE:
- shell: "git rev-parse HEAD"
  capture_output: true
# Access with: ${output}

# AFTER (recommended):
- shell: "git rev-parse HEAD"
  capture_output: "commit_hash"
# Access with: ${commit_hash}

# String variant - already correct
- shell: "ls -la | wc -l"
  capture_output: "file_count"
# Access with: ${file_count}
</code></pre>
<p><strong>Note</strong>: The internal WorkflowStep struct (src/cook/workflow/executor/data_structures.rs:75) uses a <code>capture</code> field internally, but this is NOT exposed in the user-facing YAML WorkflowStepCommand struct. Always use <code>capture_output</code> for capturing command output in YAML workflows.</p>
<p>You can then reference captured values using <code>${commit_hash}</code> or <code>${output}</code> in subsequent commands.</p>
<hr />
<h2 id="technical-notes"><a class="header" href="#technical-notes">Technical Notes</a></h2>
<details>
<summary>Internal Implementation Fields (for contributors)</summary>
<p>The following fields exist in the internal WorkflowStep struct (src/cook/workflow/executor/data_structures.rs:35-157) but are NOT available in the user-facing WorkflowStepCommand YAML syntax (src/config/command.rs:320-401). These are implementation details managed by Prodigy’s execution engine during workflow execution:</p>
<p><strong>Execution Control Fields (Internal Only):</strong></p>
<ul>
<li><code>handler</code> - Internal HandlerStep for execution routing</li>
<li><code>retry</code> - Internal RetryConfig for automatic retry logic</li>
<li><code>auto_commit</code> - Internal commit tracking</li>
<li><code>commit_config</code> - Internal commit configuration</li>
<li><code>step_validate</code> - Internal validation state</li>
<li><code>skip_validation</code> - Internal validation control</li>
<li><code>validation_timeout</code> - Internal validation timing</li>
<li><code>ignore_validation_failure</code> - Internal validation handling</li>
</ul>
<p><strong>Environment and Context Fields (Planned/Not Yet Exposed in YAML):</strong></p>
<ul>
<li><code>working_dir</code> - Working directory control (WorkflowStep:99, NOT in WorkflowStepCommand)</li>
<li><code>env</code> - Environment variable overrides (WorkflowStep:103, NOT in WorkflowStepCommand)</li>
<li><code>on_exit_code</code> - Exit code specific handlers (WorkflowStep:119, NOT in WorkflowStepCommand)</li>
<li><code>capture</code> - Variable name for output (WorkflowStep:75, use <code>capture_output</code> in YAML instead)</li>
</ul>
<p><strong>Why the separation?</strong> WorkflowStepCommand defines what users can write in YAML. WorkflowStep is the internal runtime representation with additional fields populated during execution. Some features exist in the execution layer but aren’t yet exposed in the YAML syntax.</p>
<p><strong>Workarounds for missing YAML fields:</strong></p>
<p>Since <code>cwd</code>, <code>env</code>, and <code>on_exit_code</code> are NOT available in WorkflowStepCommand, use these shell-level alternatives:</p>
<pre><code class="language-yaml"># Instead of cwd field (NOT available):
# ❌ - shell: "cargo test"
#      cwd: "crates/prodigy-core"

# ✓ Use shell cd command:
- shell: "cd crates/prodigy-core &amp;&amp; cargo test"

# Instead of env field (NOT available):
# ❌ - shell: "rustfmt --check src/**/*.rs"
#      env:
#        PATH: "/custom/bin:${PATH}"

# ✓ Use shell environment syntax:
- shell: "PATH=/custom/bin:$PATH rustfmt --check src/**/*.rs"

# Instead of on_exit_code field (NOT available):
# ❌ - shell: "cargo build"
#      on_exit_code:
#        1:
#          claude: "/fix-compile-errors"

# ✓ Use on_failure with conditional logic:
- shell: "cargo build"
  on_failure:
    claude: "/fix-compile-errors ${shell.output}"
</code></pre>
<p>These planned features may be exposed in future versions of Prodigy.</p>
</details>
<hr />
<h2 id="cross-references"><a class="header" href="#cross-references">Cross-References</a></h2>
<p>For more information on related topics:</p>
<ul>
<li><strong>Variable Interpolation</strong>: See the <a href="./variables/index.html#captured-variables">Variables chapter</a> for details on using captured outputs like <code>${variable_name}</code> in subsequent commands</li>
<li><strong>Environment Variables</strong>: See the <a href="./environment.html#step-level-environment-variables">Environment Variables chapter</a> for global env, secrets, and profiles</li>
<li><strong>Error Handling</strong>: See the <a href="./error-handling.html#on-failure-handlers">Error Handling chapter</a> for advanced <code>on_failure</code> strategies and retry patterns</li>
<li><strong>MapReduce Workflows</strong>: See the <a href="./mapreduce/index.html#map-phase">MapReduce chapter</a> for large-scale parallel command execution with agent templates</li>
</ul>
<p><strong>Example: Using Captured Output in Subsequent Commands</strong></p>
<pre><code class="language-yaml"># Capture build output and use it in later commands
- shell: "cargo build --release 2&gt;&amp;1"
  capture: "build_output"
  capture_format: "string"

# Use the captured output in Claude command
- claude: "/analyze-warnings '${build_output}'"
  when: "${build_output contains 'warning'}"

# Store output to file for later analysis
- write_file:
    path: "logs/build-${workflow.iteration}.log"
    content: "${build_output}"
    create_dirs: true
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="mapreduce/workflow-format-comparison.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="variables/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="mapreduce/workflow-format-comparison.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="variables/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
