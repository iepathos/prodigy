# Example of using custom variable names for captured output
# This feature allows you to specify exactly which variable name should 
# receive the output from a command, making workflows more readable and
# avoiding variable name conflicts.

name: capture-output-custom-variables
mode: mapreduce

setup:
  # Capture to default variable name (shell.output)
  - shell: "echo 'Starting analysis...'"
    capture_output: true
    
  # Capture to a custom variable name
  - shell: "ls -la | wc -l"
    capture_output: "file_count"
    
  # Use the captured variable in next command
  - shell: "echo 'Found ${file_count} files in current directory'"

map:
  input: items.json
  json_path: "$.items[*]"
  
  agent_template:
    commands:
      # Capture Claude output to custom variable
      - claude: "/analyze-item --id ${item.id}"
        capture_output: "analysis_result"
        
      # Capture shell output to another custom variable  
      - shell: "grep -c TODO src/*.rs || echo 0"
        capture_output: "todo_count"
        
      # Use both captured variables
      - shell: |
          echo "Analysis: ${analysis_result}"
          echo "TODOs found: ${todo_count}"

reduce:
  commands:
    # Run debtmap analysis and capture to custom variable
    - shell: "debtmap analyze . --output debtmap.json --format json"
      capture_output: "debtmap_output"
    
    # Get summary from Claude with specific variable name
    - claude: "/summarize-results --items ${map.total}"
      capture_output: "summary"
    
    # Create commit using the captured variables
    - shell: |
        git add -A && git commit -m "Process ${map.successful} items
        
        Summary: ${summary}
        
        Debtmap analysis:
        ${debtmap_output}"

# Output capture modes:
# 1. capture_output: false (or omitted) - Don't capture output
# 2. capture_output: true - Capture to default variable names:
#    - claude.output for Claude commands
#    - shell.output for shell commands  
#    - handler.output for handler commands
#    - test.output for test commands
# 3. capture_output: "custom_name" - Capture to specified variable name
#
# Variables are available to all subsequent commands in the same phase