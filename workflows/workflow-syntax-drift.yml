# Workflow to detect and fix documentation drift in workflow syntax guide
# This workflow analyzes the codebase and updates docs/workflow-syntax.md
# to reflect the latest supported syntax and features.

name: workflow-syntax-drift-detection
mode: mapreduce

# Setup phase: Analyze codebase for workflow syntax
setup:
  - shell: "mkdir -p .prodigy/syntax-analysis"

  - claude: "/prodigy-analyze-workflow-features"

# Map phase: Analyze each documentation section for drift
map:
  input: "workflows/data/workflow-syntax-sections.json"
  json_path: "$.sections[*]"

  agent_template:
    - claude: "/prodigy-analyze-doc-section-drift --json '${item}'"
      commit_required: true

  max_parallel: 3
  agent_timeout_secs: 300

# Reduce phase: Aggregate drift findings and update documentation
reduce:
  - claude: "/prodigy-fix-workflow-syntax-drift"
    commit_required: true

# Error handling
error_policy:
  on_item_failure: dlq
  continue_on_failure: true
  max_failures: 2
  error_collection: aggregate
