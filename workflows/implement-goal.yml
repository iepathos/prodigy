# implement-goal.yml - Enhanced specification implementation with goal-seeking
# Improves upon implement.yml by using iterative refinement for better results

# The $ARG variable contains the spec ID or direct argument value

# Step 1: Implement the specification with iterative refinement
# Goal-seeking ensures a more complete initial implementation
- goal_seek:
    goal: "Implement specification: $ARG"
    claude: "/prodigy-implement-spec $ARG"
    validate: "git diff --stat | grep -q '.*\\.rs' && echo 'score: 100' || echo 'score: 0'"
    threshold: 90
    max_attempts: 3
    timeout_seconds: 600
  commit_required: true

# Step 2: Ensure tests pass with iterative fixing
# Goal-seeking will retry until all tests pass
- goal_seek:
    goal: "Fix all test failures"
    claude: "/prodigy-debug-test-failure --spec $ARG"
    validate: "just test 2>&1 | grep -q 'test result: ok' && echo 'score: 100' || echo 'score: 0'"
    threshold: 100
    max_attempts: 5
    timeout_seconds: 300
    fail_on_incomplete: true
  commit_required: true

# Step 3: Fix any linting and formatting issues
# Goal-seeking ensures code meets quality standards
- goal_seek:
    goal: "Fix linting and formatting"
    claude: "/prodigy-lint"
    validate: "just fmt-check && just lint && echo 'score: 100' || echo 'score: 0'"
    threshold: 100
    max_attempts: 3
    timeout_seconds: 180
  commit_required: true