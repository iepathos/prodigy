<!DOCTYPE HTML>
<html lang="en" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Environment Profiles - Prodigy Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="AI-powered workflow orchestration for development teams">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Prodigy Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/iepathos/prodigy" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/iepathos/prodigy/edit/main/book/src/environment/environment-profiles.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="environment-profiles"><a class="header" href="#environment-profiles">Environment Profiles</a></h2>
<p>Environment profiles allow you to define named sets of environment variables for different execution contexts (development, staging, production, etc.). Each profile contains environment variables that are applied when the profile is activated.</p>
<p><strong>Source</strong>: Profile infrastructure implemented in <a href="../../../src/cook/environment/config.rs">src/cook/environment/config.rs</a> (EnvironmentConfig struct) and <a href="../../../src/cook/environment/manager.rs">src/cook/environment/manager.rs</a> (profile application logic).</p>
<h3 id="defining-profiles"><a class="header" href="#defining-profiles">Defining Profiles</a></h3>
<p>Profiles use a flat structure where environment variables are defined directly at the profile level (not nested under an <code>env:</code> key):</p>
<pre><code class="language-yaml"># Define multiple profiles for different environments
profiles:
  development:
    description: "Development environment with debug enabled"
    NODE_ENV: development
    DEBUG: "true"
    API_URL: http://localhost:3000
    LOG_LEVEL: debug

  staging:
    description: "Staging environment for QA"
    NODE_ENV: staging
    DEBUG: "true"
    API_URL: https://staging.api.example.com
    LOG_LEVEL: info

  production:
    description: "Production environment configuration"
    NODE_ENV: production
    DEBUG: "false"
    API_URL: https://api.example.com
    LOG_LEVEL: error

# Global environment variables (apply to all profiles)
env:
  APP_NAME: "my-app"
  VERSION: "1.0.0"

commands:
  - shell: "npm run build"
</code></pre>
<p><strong>Source</strong>: Profile structure defined in <a href="../../../src/cook/environment/config.rs">src/cook/environment/config.rs</a> (EnvProfile type).</p>
<p><strong>Profile Structure Details</strong>:</p>
<ul>
<li><strong>description</strong> (optional): Human-readable description of the profile’s purpose</li>
<li><strong>Environment variables</strong>: Direct key-value pairs at the profile level</li>
<li>All variable values must be strings in YAML</li>
</ul>
<h3 id="activating-profiles"><a class="header" href="#activating-profiles">Activating Profiles</a></h3>
<p><strong>Design Note</strong>: The profile activation infrastructure is architecturally complete in the codebase. The <code>EnvironmentConfig</code> struct has an <code>active_profile</code> field (<a href="../../../src/cook/environment/config.rs">src/cook/environment/config.rs:33-35</a>), and the <code>EnvironmentManager</code> applies active profiles during environment setup (<a href="../../../src/cook/environment/manager.rs">src/cook/environment/manager.rs:118-120</a>). Comprehensive integration tests demonstrate profile activation (<a href="../../../tests/environment_workflow_test.rs">tests/environment_workflow_test.rs:63-132</a>).</p>
<p><strong>Current Implementation Status</strong>: As of this documentation, the CLI wiring for profile activation (<code>--profile</code> flag and <code>PRODIGY_PROFILE</code> environment variable) is not yet connected to the argument parser. The profile application infrastructure exists and is tested, but requires the active profile to be set programmatically rather than via command-line arguments.</p>
<p><strong>Intended Usage</strong> (when CLI wiring is complete):</p>
<pre><code class="language-bash"># Activate profile via command line flag
prodigy run workflow.yml --profile production

# Activate profile via environment variable
export PRODIGY_PROFILE=staging
prodigy run workflow.yml
</code></pre>
<p><strong>Current Workaround</strong>: Profiles can be activated programmatically in tests or by directly setting the <code>active_profile</code> field when constructing <code>EnvironmentConfig</code> objects.</p>
<h3 id="common-use-cases"><a class="header" href="#common-use-cases">Common Use Cases</a></h3>
<p>Profiles are ideal for managing environment-specific configuration:</p>
<ol>
<li>
<p><strong>Different API Endpoints</strong></p>
<pre><code class="language-yaml">profiles:
  development:
    API_URL: http://localhost:3000
    AUTH_URL: http://localhost:4000

  production:
    API_URL: https://api.example.com
    AUTH_URL: https://auth.example.com
</code></pre>
</li>
<li>
<p><strong>Environment-Specific Credentials</strong></p>
<pre><code class="language-yaml">profiles:
  development:
    DB_HOST: localhost
    DB_NAME: myapp_dev
    DB_USER: dev_user

  production:
    DB_HOST: prod-db.example.com
    DB_NAME: myapp_prod
    DB_USER: prod_user
</code></pre>
</li>
<li>
<p><strong>Deployment Target Configuration</strong></p>
<pre><code class="language-yaml">profiles:
  aws:
    CLOUD_PROVIDER: aws
    REGION: us-east-1
    DEPLOY_COMMAND: "aws deploy"

  gcp:
    CLOUD_PROVIDER: gcp
    REGION: us-central1
    DEPLOY_COMMAND: "gcloud deploy"
</code></pre>
</li>
</ol>
<h3 id="environment-variable-precedence"><a class="header" href="#environment-variable-precedence">Environment Variable Precedence</a></h3>
<p>When a profile is active, environment variables are resolved in this order (highest to lowest precedence):</p>
<ol>
<li><strong>Step-level environment</strong> - Variables defined in individual command <code>env:</code> blocks</li>
<li><strong>Active profile environment</strong> - Variables from the activated profile</li>
<li><strong>Global environment</strong> - Variables from top-level <code>env:</code> block</li>
<li><strong>System environment</strong> - Variables inherited from the shell</li>
</ol>
<p><strong>Source</strong>: Precedence chain implemented in <a href="../../../src/cook/environment/manager.rs">src/cook/environment/manager.rs</a> and tested in <a href="../../../tests/environment_workflow_test.rs">tests/environment_workflow_test.rs</a>.</p>
<p>For detailed information on precedence rules, see <a href="environment-precedence.html">Environment Precedence</a>.</p>
<h3 id="profile-best-practices"><a class="header" href="#profile-best-practices">Profile Best Practices</a></h3>
<p><strong>Define sensible defaults</strong>:</p>
<pre><code class="language-yaml">profiles:
  development:
    description: "Local development with debug enabled"
    DEBUG: "true"
    LOG_LEVEL: debug

  production:
    description: "Production environment with minimal logging"
    DEBUG: "false"
    LOG_LEVEL: error
</code></pre>
<p><strong>Combine with env_files for secrets</strong>:</p>
<pre><code class="language-yaml">profiles:
  production:
    API_URL: https://api.example.com
    DEBUG: "false"

env_files:
  - path: .env.production
    required: true  # Contains secrets like API_KEY
</code></pre>
<p>See <a href="environment-files.html">Environment Files</a> for more on combining profiles with environment files.</p>
<p><strong>Override profile values at step level</strong>:</p>
<pre><code class="language-yaml">profiles:
  production:
    LOG_LEVEL: error

commands:
  - shell: "run-diagnostics.sh"
    env:
      LOG_LEVEL: debug  # Override for this step only
</code></pre>
<p>See <a href="per-command-environment-overrides.html">Per-Command Environment Overrides</a> for step-level overrides.</p>
<h3 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h3>
<p><strong>Profile not applied</strong>:</p>
<ul>
<li>Verify profile name matches exactly (case-sensitive)</li>
<li>Check that profile is defined in <code>profiles:</code> section</li>
<li>Confirm profile activation method is used correctly</li>
</ul>
<p><strong>Variables not resolved</strong>:</p>
<ul>
<li>Ensure variable names are correct in profile definition</li>
<li>Check precedence - higher-precedence sources may override profile values</li>
<li>Verify string values are quoted in YAML if they contain special characters</li>
</ul>
<p><strong>See Also</strong>:</p>
<ul>
<li><a href="environment-precedence.html">Environment Precedence</a> - Understanding variable resolution order</li>
<li><a href="environment-files.html">Environment Files</a> - Loading variables from external files</li>
<li><a href="best-practices.html">Best Practices</a> - Recommended patterns for environment configuration</li>
</ul>
<hr />

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../environment/secrets-management.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../environment/per-command-environment-overrides.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../environment/secrets-management.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../environment/per-command-environment-overrides.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
