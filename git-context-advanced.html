<!DOCTYPE HTML>
<html lang="en" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Advanced Git Context - Prodigy Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="AI-powered workflow orchestration for development teams">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Prodigy Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/iepathos/prodigy" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/iepathos/prodigy/edit/main/book/src/git-context-advanced.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="advanced-git-context"><a class="header" href="#advanced-git-context">Advanced Git Context</a></h1>
<p>This chapter covers automatic git tracking and git context variables in Prodigy workflows. Learn how to access file changes, commits, and modification statistics, and how to filter and format this data using shell commands.</p>
<blockquote>
<p><strong>⚠️ Current Implementation Status</strong></p>
<p>Git context variables are currently provided as <strong>space-separated strings only</strong>. Advanced features like pattern filtering (<code>:*.rs</code>) and format modifiers (<code>:json</code>, <code>:lines</code>) are <strong>not yet implemented</strong> in the variable interpolation system, though the underlying infrastructure exists.</p>
<p><strong>For filtering and formatting</strong>, use shell post-processing commands like <code>grep</code>, <code>tr</code>, <code>jq</code>, and <code>xargs</code>. See <a href="#shell-based-filtering-and-formatting">Shell-Based Filtering and Formatting</a> for practical examples.</p>
</blockquote>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>Prodigy automatically tracks git changes throughout workflow execution and exposes them through variables. No configuration is needed—git context variables are available out-of-the-box in any git repository. You can access file changes, commits, and modification statistics at both the step and workflow level.</p>
<p><strong>What you get:</strong></p>
<ul>
<li>Automatic tracking of all git changes during workflow execution</li>
<li>Variables for step-level changes (current command) and workflow-level changes (cumulative)</li>
<li>Simple space-separated format ready for shell commands</li>
<li>Full integration with MapReduce workflows</li>
</ul>
<h2 id="how-git-tracking-works"><a class="header" href="#how-git-tracking-works">How Git Tracking Works</a></h2>
<h3 id="automatic-tracking"><a class="header" href="#automatic-tracking">Automatic Tracking</a></h3>
<p>Git context is automatically tracked when you run workflows in a git repository:</p>
<ul>
<li><strong>GitChangeTracker</strong> is initialized at workflow start (src/cook/workflow/git_context.rs)</li>
<li>Each step’s changes are tracked between <code>begin_step</code> and <code>complete_step</code> calls</li>
<li>Variables are pre-formatted as space-separated strings and added to the interpolation context</li>
<li>No YAML configuration needed—tracking happens transparently</li>
</ul>
<p><strong>Technical Details</strong> (src/cook/workflow/executor/context.rs:96-172):</p>
<p>When preparing the interpolation context for each command, git variables are added like this:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Variables are pre-formatted as space-separated strings
context.set("step.files_added", Value::String(changes.files_added.join(" ")));
context.set("step.files_modified", Value::String(changes.files_modified.join(" ")));
// ... etc for all git context variables
<span class="boring">}</span></code></pre></pre>
<p>This means custom formatting must be done using shell commands after variable interpolation.</p>
<h3 id="when-tracking-is-active"><a class="header" href="#when-tracking-is-active">When Tracking is Active</a></h3>
<p>Git tracking is active in:</p>
<ul>
<li>Regular workflows running in git repositories</li>
<li>MapReduce setup, map, and reduce phases</li>
<li>Child worktrees created for map agents</li>
</ul>
<p>Git tracking is <strong>not</strong> active in:</p>
<ul>
<li>Non-git repositories</li>
<li>Workflows without git integration</li>
</ul>
<h2 id="git-context-variables"><a class="header" href="#git-context-variables">Git Context Variables</a></h2>
<h3 id="step-level-variables"><a class="header" href="#step-level-variables">Step-Level Variables</a></h3>
<p>Track changes made during the current step:</p>
<pre><code class="language-yaml"># Access files changed in this step
- shell: "echo Changed: ${step.files_changed}"
- shell: "echo Added: ${step.files_added}"
- shell: "echo Modified: ${step.files_modified}"
- shell: "echo Deleted: ${step.files_deleted}"

# Access commit information
- shell: "echo Commits: ${step.commits}"
- shell: "echo Commit count: ${step.commit_count}"

# Access modification statistics
- shell: "echo Insertions: ${step.insertions}"
- shell: "echo Deletions: ${step.deletions}"
</code></pre>
<h3 id="workflow-level-variables"><a class="header" href="#workflow-level-variables">Workflow-Level Variables</a></h3>
<p>Track cumulative changes across all steps:</p>
<pre><code class="language-yaml"># Access all files changed in workflow
- shell: "echo Changed: ${workflow.files_changed}"
- shell: "echo Added: ${workflow.files_added}"
- shell: "echo Modified: ${workflow.files_modified}"
- shell: "echo Deleted: ${workflow.files_deleted}"

# Access all commits
- shell: "echo Commits: ${workflow.commits}"
- shell: "echo Commit count: ${workflow.commit_count}"

# Access total modifications
- shell: "echo Insertions: ${workflow.insertions}"
- shell: "echo Deletions: ${workflow.deletions}"
</code></pre>
<h3 id="variable-reference"><a class="header" href="#variable-reference">Variable Reference</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Variable</th><th>Scope</th><th>Description</th></tr></thead><tbody>
<tr><td><code>step.files_added</code></td><td>Step</td><td>Files added in current step</td></tr>
<tr><td><code>step.files_modified</code></td><td>Step</td><td>Files modified in current step</td></tr>
<tr><td><code>step.files_deleted</code></td><td>Step</td><td>Files deleted in current step</td></tr>
<tr><td><code>step.files_changed</code></td><td>Step</td><td>All files changed (added + modified + deleted)</td></tr>
<tr><td><code>step.commits</code></td><td>Step</td><td>Commit SHAs from current step</td></tr>
<tr><td><code>step.commit_count</code></td><td>Step</td><td>Number of commits in current step</td></tr>
<tr><td><code>step.insertions</code></td><td>Step</td><td>Lines added in current step</td></tr>
<tr><td><code>step.deletions</code></td><td>Step</td><td>Lines deleted in current step</td></tr>
<tr><td><code>workflow.files_added</code></td><td>Workflow</td><td>All files added in workflow</td></tr>
<tr><td><code>workflow.files_modified</code></td><td>Workflow</td><td>All files modified in workflow</td></tr>
<tr><td><code>workflow.files_deleted</code></td><td>Workflow</td><td>All files deleted in workflow</td></tr>
<tr><td><code>workflow.files_changed</code></td><td>Workflow</td><td>All files changed in workflow</td></tr>
<tr><td><code>workflow.commits</code></td><td>Workflow</td><td>All commit SHAs in workflow</td></tr>
<tr><td><code>workflow.commit_count</code></td><td>Workflow</td><td>Total commits in workflow</td></tr>
<tr><td><code>workflow.insertions</code></td><td>Workflow</td><td>Total lines added in workflow</td></tr>
<tr><td><code>workflow.deletions</code></td><td>Workflow</td><td>Total lines deleted in workflow</td></tr>
</tbody></table>
</div>
<h2 id="shell-based-filtering-and-formatting"><a class="header" href="#shell-based-filtering-and-formatting">Shell-Based Filtering and Formatting</a></h2>
<p>Since git context variables are provided as space-separated strings, all filtering and formatting must be done using shell commands. This section shows practical patterns for common tasks.</p>
<h3 id="default-format-space-separated"><a class="header" href="#default-format-space-separated">Default Format (Space-Separated)</a></h3>
<p>Git context variables are always formatted as space-separated strings:</p>
<pre><code class="language-yaml">- shell: "echo ${step.files_changed}"
# Output: src/main.rs src/lib.rs tests/test.rs
</code></pre>
<p>This format works well with most shell commands:</p>
<pre><code class="language-yaml"># Pass directly to commands
- shell: "cargo fmt ${step.files_changed}"
- shell: "git add ${workflow.files_modified}"

# Use in loops
- shell: |
    for file in ${step.files_added}; do
      echo "Processing $file"
    done
</code></pre>
<h3 id="filtering-by-file-extension"><a class="header" href="#filtering-by-file-extension">Filtering by File Extension</a></h3>
<p>Use <code>grep</code> to filter files by extension or pattern:</p>
<pre><code class="language-yaml"># Only Rust files
- shell: |
    rust_files=$(echo "${step.files_changed}" | tr ' ' '\n' | grep '\.rs$')
    echo "$rust_files"
# Output:
# src/main.rs
# src/lib.rs

# Only files in src/ directory
- shell: |
    src_files=$(echo "${step.files_changed}" | tr ' ' '\n' | grep '^src/')
    echo "$src_files"

# Multiple extensions (Rust or TOML)
- shell: |
    filtered=$(echo "${step.files_modified}" | tr ' ' '\n' | grep -E '\.(rs|toml)$')
    echo "$filtered"

# Pass filtered files to a command
- shell: |
    rust_files=$(echo "${step.files_changed}" | tr ' ' '\n' | grep '\.rs$' | tr '\n' ' ')
    if [ -n "$rust_files" ]; then
      cargo fmt $rust_files
    fi
</code></pre>
<h3 id="converting-to-json-format"><a class="header" href="#converting-to-json-format">Converting to JSON Format</a></h3>
<p>Use <code>jq</code> to convert space-separated files to JSON arrays:</p>
<pre><code class="language-yaml"># Convert to JSON array
- shell: "echo ${step.files_added} | tr ' ' '\n' | jq -R | jq -s"
# Output: ["src/main.rs","src/lib.rs","tests/test.rs"]

# Filter AND convert to JSON
- shell: |
    echo "${step.files_changed}" | tr ' ' '\n' | grep '\.rs$' | jq -R | jq -s
# Output: ["src/main.rs","src/lib.rs"]

# Pretty-print JSON
- shell: |
    echo "${workflow.files_modified}" | tr ' ' '\n' | jq -R | jq -s '.'
</code></pre>
<h3 id="converting-to-newline-separated-format"><a class="header" href="#converting-to-newline-separated-format">Converting to Newline-Separated Format</a></h3>
<p>Use <code>tr</code> to convert space-separated to newline-separated:</p>
<pre><code class="language-yaml"># One file per line
- shell: "echo ${step.files_changed} | tr ' ' '\n'"
# Output:
# src/main.rs
# src/lib.rs
# tests/test.rs

# Useful with xargs for parallel processing
- shell: |
    echo "${workflow.files_modified}" | tr ' ' '\n' | xargs -I {} cp {} backup/

# Count files
- shell: "echo ${step.files_added} | tr ' ' '\n' | wc -l"
</code></pre>
<h3 id="converting-to-csv-format"><a class="header" href="#converting-to-csv-format">Converting to CSV Format</a></h3>
<p>Use <code>tr</code> to convert to comma-separated values:</p>
<pre><code class="language-yaml"># Comma-separated
- shell: "echo ${step.files_added} | tr ' ' ','"
# Output: src/main.rs,src/lib.rs,tests/test.rs

# CSV with filtering
- shell: |
    echo "${step.files_changed}" | tr ' ' '\n' | grep '\.md$' | tr '\n' ',' | sed 's/,$//'
# Output: README.md,CHANGELOG.md
</code></pre>
<h3 id="combining-filtering-and-formatting"><a class="header" href="#combining-filtering-and-formatting">Combining Filtering and Formatting</a></h3>
<p>Practical examples combining multiple operations:</p>
<pre><code class="language-yaml"># Get Rust files as JSON
- shell: |
    echo "${step.files_changed}" | tr ' ' '\n' | grep '\.rs$' | jq -R | jq -s

# Get source files as comma-separated list
- shell: |
    echo "${workflow.files_modified}" | tr ' ' '\n' | grep '^src/' | tr '\n' ',' | sed 's/,$//'

# Count files by extension
- shell: |
    echo "${workflow.files_changed}" | tr ' ' '\n' | sed 's/.*\.//' | sort | uniq -c
# Output:
#    5 md
#    12 rs
#    3 toml
</code></pre>
<h2 id="use-cases"><a class="header" href="#use-cases">Use Cases</a></h2>
<h3 id="code-review-workflows"><a class="header" href="#code-review-workflows">Code Review Workflows</a></h3>
<p>Review only source code changes using shell filtering:</p>
<pre><code class="language-yaml"># Filter to only Rust source files before review
- shell: |
    rust_files=$(echo "${step.files_changed}" | tr ' ' '\n' | grep '^src/.*\.rs$' | tr '\n' ' ')
    if [ -n "$rust_files" ]; then
      echo "Rust files changed: $rust_files"
    fi

# Pass filtered files to Claude for review
- shell: |
    src_changes=$(echo "${step.files_changed}" | tr ' ' '\n' | grep '^src/')
    if [ -n "$src_changes" ]; then
      echo "$src_changes" &gt; /tmp/review-files.txt
      # Then use /tmp/review-files.txt in your review command
    fi

- shell: "echo Reviewing ${step.commit_count} commits"
</code></pre>
<h3 id="documentation-updates"><a class="header" href="#documentation-updates">Documentation Updates</a></h3>
<p>Work with documentation changes using filtering:</p>
<pre><code class="language-yaml"># Find markdown files that changed
- shell: |
    md_files=$(echo "${workflow.files_changed}" | tr ' ' '\n' | grep '\.md$' | tr '\n' ' ')
    if [ -n "$md_files" ]; then
      echo "Documentation files changed: $md_files"
      markdownlint $md_files
    fi

# List changed docs in newline format
- shell: |
    echo "${workflow.files_modified}" | tr ' ' '\n' | grep '\.md$'

# Check if any docs were updated
- shell: |
    doc_count=$(echo "${workflow.files_changed}" | tr ' ' '\n' | grep '\.md$' | wc -l)
    if [ "$doc_count" -gt 0 ]; then
      echo "Documentation was updated ($doc_count files)"
    fi
</code></pre>
<h3 id="test-verification"><a class="header" href="#test-verification">Test Verification</a></h3>
<p>Focus on test-related changes:</p>
<pre><code class="language-yaml"># Run tests for changed test files
- shell: |
    test_files=$(echo "${step.files_changed}" | tr ' ' '\n' | grep '_test\.rs$' | tr '\n' ' ')
    if [ -n "$test_files" ]; then
      cargo test $test_files
    fi

# Verify test coverage for new files in tests/
- shell: |
    new_tests=$(echo "${step.files_added}" | tr ' ' '\n' | grep '^tests/')
    if [ -n "$new_tests" ]; then
      echo "New test files added:"
      echo "$new_tests"
      # Run coverage analysis
    fi
</code></pre>
<h3 id="conditional-execution"><a class="header" href="#conditional-execution">Conditional Execution</a></h3>
<p>Use git context with shell conditions:</p>
<pre><code class="language-yaml"># Only run clippy if Rust files changed
- shell: |
    has_rust=$(echo "${step.files_changed}" | tr ' ' '\n' | grep '\.rs$')
    if [ -n "$has_rust" ]; then
      cargo clippy
    fi

# Run different linters based on file types
- shell: |
    if echo "${workflow.files_changed}" | tr ' ' '\n' | grep -q '\.rs$'; then
      cargo fmt --check
    fi

    if echo "${workflow.files_changed}" | tr ' ' '\n' | grep -q '\.md$'; then
      markdownlint **/*.md
    fi

# Check commit count
- shell: |
    if [ "${step.commit_count}" -gt 1 ]; then
      echo "Multiple commits detected (${step.commit_count})"
    fi
</code></pre>
<h3 id="mapreduce-workflows"><a class="header" href="#mapreduce-workflows">MapReduce Workflows</a></h3>
<p>Git context works across MapReduce phases:</p>
<pre><code class="language-yaml">name: review-changes
mode: mapreduce

setup:
  # Workflow-level tracking starts here
  - shell: "git diff main --name-only &gt; changed-files.txt"
  - shell: "echo Setup modified: ${step.files_changed}"

map:
  input: "changed-files.txt"
  agent_template:
    # Each agent has its own step tracking
    - claude: "/review ${item}"
    - shell: "echo Agent changed: ${step.files_changed}"

reduce:
  # Access workflow-level changes from all agents
  - shell: "echo Total changes: ${workflow.files_changed}"
  - shell: "echo Total commits: ${workflow.commit_count}"
</code></pre>
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<ul>
<li><strong>Use Shell Filtering</strong>: Filter variables to only relevant files using <code>grep</code>, <code>tr</code>, and other shell utilities</li>
<li><strong>Choose Appropriate Format</strong>: Convert to JSON with <code>jq</code>, newlines with <code>tr</code>, or CSV for different use cases</li>
<li><strong>Scope Appropriately</strong>: Use <code>step.*</code> for current changes, <code>workflow.*</code> for cumulative tracking</li>
<li><strong>Handle Empty Results</strong>: Always check if filtered results are non-empty before using them</li>
<li><strong>Test Your Filters</strong>: Debug with <code>echo</code> commands to verify filtering works as expected</li>
<li><strong>Document Intent</strong>: Add comments explaining complex shell filtering pipelines</li>
<li><strong>Combine Operations</strong>: Chain <code>tr</code>, <code>grep</code>, and <code>jq</code> for powerful filtering and formatting</li>
</ul>
<h2 id="performance-considerations"><a class="header" href="#performance-considerations">Performance Considerations</a></h2>
<ul>
<li>Git operations are performed once per step and cached (src/cook/workflow/git_context.rs)</li>
<li>Variables are pre-formatted when added to the interpolation context</li>
<li>Shell filtering happens at runtime, so complex filters may add overhead</li>
<li>Workflow-level tracking maintains cumulative state without re-scanning git history</li>
<li>Variable resolution is fast since values are pre-computed strings</li>
</ul>
<h2 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h2>
<h3 id="filter-not-matching-any-files"><a class="header" href="#filter-not-matching-any-files">Filter Not Matching Any Files</a></h3>
<p><strong>Issue</strong>: Your grep filter doesn’t match any files</p>
<pre><code class="language-yaml"># Debug: Echo the unfiltered variable first
- shell: "echo All files: ${step.files_changed}"
- shell: |
    filtered=$(echo "${step.files_changed}" | tr ' ' '\n' | grep '\.rs$')
    echo "Filtered: $filtered"
</code></pre>
<p><strong>What happens</strong>: When a filter matches no files, the variable is empty. This is expected behavior.</p>
<p><strong>Solution</strong>: Always check if filtered results are non-empty:</p>
<pre><code class="language-yaml">- shell: |
    rust_files=$(echo "${step.files_changed}" | tr ' ' '\n' | grep '\.rs$' | tr '\n' ' ')
    if [ -n "$rust_files" ]; then
      cargo fmt $rust_files
    else
      echo "No Rust files changed"
    fi
</code></pre>
<h3 id="empty-git-context-variables"><a class="header" href="#empty-git-context-variables">Empty Git Context Variables</a></h3>
<p><strong>Issue</strong>: Git context variables are empty</p>
<p><strong>Possible causes:</strong></p>
<ul>
<li>Not running in a git repository</li>
<li>No commits have been made in the current step</li>
<li>Git tracking not initialized</li>
</ul>
<p><strong>Solution</strong>: Verify git tracking is active:</p>
<pre><code class="language-yaml"># Check if variables are populated
- shell: |
    echo "Step files changed: ${step.files_changed}"
    echo "Workflow files changed: ${workflow.files_changed}"
    echo "Commit count: ${step.commit_count}"
</code></pre>
<p>If all are empty, check:</p>
<ol>
<li>Are you in a git repository? (<code>git status</code>)</li>
<li>Has the step made any commits yet?</li>
<li>Is git tracking active for this workflow type?</li>
</ol>
<h3 id="pattern-syntax-not-working"><a class="header" href="#pattern-syntax-not-working">Pattern Syntax Not Working</a></h3>
<p><strong>Issue</strong>: Trying to use <code>:*.rs</code> or <code>:json</code> modifiers produces errors or unexpected results</p>
<p><strong>Cause</strong>: Pattern filtering and format modifiers are <strong>not implemented</strong> in variable interpolation. Git context variables are always space-separated strings.</p>
<p><strong>What you tried</strong> (doesn’t work):</p>
<pre><code class="language-yaml"># These do NOT work - modifiers not implemented
- shell: "echo ${step.files_changed:*.rs}"
- shell: "echo ${step.files_added:json}"
- shell: "echo ${workflow.files_modified:lines}"
</code></pre>
<p><strong>Solution</strong>: Use shell commands for all filtering and formatting:</p>
<pre><code class="language-yaml"># Filter with grep
- shell: "echo ${step.files_changed} | tr ' ' '\n' | grep '\.rs$'"

# Format as JSON
- shell: "echo ${step.files_added} | tr ' ' '\n' | jq -R | jq -s"

# Format as newlines
- shell: "echo ${workflow.files_modified} | tr ' ' '\n'"
</code></pre>
<p>See <a href="#shell-based-filtering-and-formatting">Shell-Based Filtering and Formatting</a> for complete examples.</p>
<h3 id="variables-not-interpolating"><a class="header" href="#variables-not-interpolating">Variables Not Interpolating</a></h3>
<p><strong>Issue</strong>: Variables appear as literal strings like <code>${step.files_changed}</code></p>
<p><strong>Possible causes:</strong></p>
<ul>
<li>Variable name misspelled</li>
<li>Using unsupported variable</li>
<li>YAML quoting issues</li>
</ul>
<p><strong>Solution</strong>: Verify the variable name and use proper quoting:</p>
<pre><code class="language-yaml"># Correct syntax
- shell: "echo ${step.files_changed}"
- shell: |
    echo "${workflow.files_modified}"
</code></pre>
<h3 id="shell-filtering-complexity"><a class="header" href="#shell-filtering-complexity">Shell Filtering Complexity</a></h3>
<p><strong>Issue</strong>: Shell filtering pipelines are getting too complex</p>
<p><strong>Solution</strong>: Extract complex filtering to separate shell scripts:</p>
<pre><code class="language-yaml"># Create a helper script
- shell: |
    cat &gt; /tmp/filter-rust.sh &lt;&lt;'EOF'
    #!/bin/bash
    echo "$1" | tr ' ' '\n' | grep '\.rs$' | tr '\n' ' '
    EOF
    chmod +x /tmp/filter-rust.sh

# Use the helper
- shell: |
    rust_files=$(/tmp/filter-rust.sh "${step.files_changed}")
    if [ -n "$rust_files" ]; then
      cargo clippy $rust_files
    fi
</code></pre>
<h2 id="future-features"><a class="header" href="#future-features">Future Features</a></h2>
<p>The git context infrastructure includes methods that are not yet exposed to workflows. These are planned for future releases:</p>
<h3 id="pattern-filtering-planned"><a class="header" href="#pattern-filtering-planned">Pattern Filtering (Planned)</a></h3>
<p>The <code>GitChangeTracker::resolve_variable()</code> method (src/cook/workflow/git_context.rs:489-505) supports pattern filtering, but it’s not currently called during workflow execution.</p>
<p><strong>Planned syntax</strong>:</p>
<pre><code class="language-yaml"># Not yet implemented - planned for future release
- shell: "echo ${step.files_changed:*.rs}"
- shell: "echo ${workflow.files_modified:src/**/*.rs}"
</code></pre>
<p>Currently variables are pre-formatted as space-separated strings during interpolation context creation (src/cook/workflow/executor/context.rs:106-172).</p>
<h3 id="format-modifiers-planned"><a class="header" href="#format-modifiers-planned">Format Modifiers (Planned)</a></h3>
<p>The <code>GitChangeTracker::format_file_list()</code> method (src/cook/workflow/git_context.rs:477-486) supports JSON, newline, and CSV formats, but it’s not used during variable resolution.</p>
<p><strong>Planned syntax</strong>:</p>
<pre><code class="language-yaml"># Not yet implemented - planned for future release
- shell: "echo ${step.files_added:json}"
- shell: "echo ${workflow.files_changed:lines}"
- shell: "echo ${step.files_modified:csv}"
</code></pre>
<h3 id="implementation-note"><a class="header" href="#implementation-note">Implementation Note</a></h3>
<p>To enable these features, the interpolation engine would need to support custom resolvers that call <code>git_tracker.resolve_variable()</code> instead of using pre-formatted string values. This would allow runtime formatting and filtering based on variable modifier syntax.</p>
<p><strong>Until then</strong>, use shell post-processing as documented in <a href="#shell-based-filtering-and-formatting">Shell-Based Filtering and Formatting</a>.</p>
<h2 id="see-also"><a class="header" href="#see-also">See Also</a></h2>
<ul>
<li><a href="variables.html">Variables and Interpolation</a> - Basic variable usage and interpolation syntax</li>
<li><a href="workflow-basics.html">Workflow Basics</a> - Git integration fundamentals and workflow structure</li>
<li><a href="mapreduce/index.html">MapReduce Workflows</a> - Using git context in parallel jobs</li>
<li><a href="conditionals.html">Conditional Execution</a> - Using git context with <code>when:</code> conditions</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="advanced/common-patterns.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="composition/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="advanced/common-patterns.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="composition/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
