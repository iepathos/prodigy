<!DOCTYPE HTML>
<html lang="en" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Failure Actions - Prodigy Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="AI-powered workflow orchestration for development teams">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Prodigy Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/iepathos/prodigy" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/iepathos/prodigy/edit/main/book/src/retry-configuration/failure-actions.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="failure-actions"><a class="header" href="#failure-actions">Failure Actions</a></h2>
<blockquote>
<p><strong>IMPORTANT</strong>: This subsection documents the <code>on_failure</code> mechanism for <strong>workflow shell commands</strong>, which uses <code>TestDebugConfig</code> for automatic debugging and retry. This is distinct from the theoretical <code>retry_config.on_failure</code> field shown in the parent chapter overview, which is defined in code but not yet integrated into command execution.</p>
</blockquote>
<p>Configure automatic debugging and retry behavior when shell commands fail using the <code>on_failure</code> field. This mechanism allows Claude to automatically diagnose and fix test failures, build errors, and other command failures.</p>
<p><strong>Source</strong>: <code>src/config/command.rs:168-183</code> (TestDebugConfig struct), <code>src/config/command.rs:372</code> (WorkflowStepCommand.on_failure field)</p>
<h2 id="what-is-testdebugconfig"><a class="header" href="#what-is-testdebugconfig">What is TestDebugConfig?</a></h2>
<p>The <code>on_failure</code> field in workflow commands accepts a <code>TestDebugConfig</code> object that specifies:</p>
<ul>
<li>A Claude command to run when the shell command fails</li>
<li>How many times to retry the debug-fix cycle</li>
<li>Whether to fail the entire workflow if debugging doesn’t fix the issue</li>
<li>Whether the debug command should create git commits</li>
</ul>
<p>This enables <strong>self-healing workflows</strong> where Claude automatically attempts to fix failures before escalating them.</p>
<p><strong>Source</strong>: <code>src/config/command.rs:168-183</code></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub struct TestDebugConfig {
    /// Claude command to run on test failure
    pub claude: String,

    /// Maximum number of retry attempts (default: 3)
    pub max_attempts: u32,

    /// Whether to fail the workflow if max attempts reached (default: false)
    pub fail_workflow: bool,

    /// Whether the debug command should create commits (default: true)
    pub commit_required: bool,
}
<span class="boring">}</span></code></pre></pre>
<h2 id="basic-syntax"><a class="header" href="#basic-syntax">Basic Syntax</a></h2>
<p>The simplest form specifies just the Claude command to run on failure:</p>
<pre><code class="language-yaml">- shell: "cargo test"
  on_failure:
    claude: "/prodigy-debug-test-failure --output ${shell.output}"
</code></pre>
<p><strong>Execution Flow</strong>:</p>
<ol>
<li>Run <code>cargo test</code></li>
<li>If it fails → Capture output in <code>${shell.output}</code></li>
<li>Run <code>/prodigy-debug-test-failure --output ${shell.output}</code></li>
<li>Claude analyzes failure and attempts fix</li>
<li>If Claude creates commits → Re-run <code>cargo test</code></li>
<li>Repeat up to <code>max_attempts</code> times (default: 3)</li>
</ol>
<p><strong>Source</strong>: Example from <code>workflows/documentation-drift.yml:47-53</code></p>
<h2 id="configuration-options"><a class="header" href="#configuration-options">Configuration Options</a></h2>
<h3 id="full-configuration"><a class="header" href="#full-configuration">Full Configuration</a></h3>
<p>All <code>on_failure</code> options:</p>
<pre><code class="language-yaml">- shell: "cargo test --doc"
  on_failure:
    claude: "/prodigy-debug-test-failure --output ${shell.output}"
    max_attempts: 3           # Maximum debug-fix-retest cycles (default: 3)
    fail_workflow: false      # Continue workflow even if can't fix (default: false)
    commit_required: true     # Debug command should create commits (default: true)
</code></pre>
<p><strong>Source</strong>: Example from <code>workflows/documentation-drift.yml:47-53</code></p>
<h3 id="max_attempts"><a class="header" href="#max_attempts">max_attempts</a></h3>
<p>Controls how many debug-fix-retest cycles to attempt:</p>
<pre><code class="language-yaml">- shell: "just fmt-check &amp;&amp; just lint"
  on_failure:
    claude: "/prodigy-lint ${shell.output}"
    max_attempts: 5           # Try up to 5 times to fix linting issues
</code></pre>
<p><strong>Default</strong>: 3 attempts (defined in <code>src/config/command.rs:173</code>)</p>
<p><strong>Use Cases</strong>:</p>
<ul>
<li><strong>1 attempt</strong>: Quick fixes only, don’t waste time on hard problems</li>
<li><strong>3 attempts</strong> (default): Reasonable for most test failures</li>
<li><strong>5+ attempts</strong>: Complex issues that might need multiple iterations</li>
</ul>
<p><strong>Source</strong>: <code>workflows/implement.yml:27-30</code></p>
<h3 id="fail_workflow"><a class="header" href="#fail_workflow">fail_workflow</a></h3>
<p>Controls whether to stop the entire workflow if debugging can’t fix the issue:</p>
<pre><code class="language-yaml"># CRITICAL: Must succeed - fail workflow if can't fix
- shell: "cargo test --lib"
  on_failure:
    claude: "/prodigy-debug-test-failure --output ${shell.output}"
    max_attempts: 3
    fail_workflow: true       # Stop workflow if tests still fail after 3 attempts
</code></pre>
<pre><code class="language-yaml"># NON-CRITICAL: Best effort - continue even if can't fix
- shell: "cargo test --doc"
  on_failure:
    claude: "/prodigy-fix-doc-tests --output ${shell.output}"
    max_attempts: 2
    fail_workflow: false      # Continue workflow even if doc tests fail
</code></pre>
<p><strong>Default</strong>: <code>false</code> - workflow continues even if debugging doesn’t fix the issue (defined in <code>src/config/command.rs:177</code>)</p>
<p><strong>Source</strong>: Examples from <code>workflows/coverage-with-test-debug.yml:14-23</code></p>
<h3 id="commit_required"><a class="header" href="#commit_required">commit_required</a></h3>
<p>Controls whether the debug command must create git commits:</p>
<pre><code class="language-yaml">- shell: "cargo clippy -- -D warnings"
  on_failure:
    claude: "/prodigy-lint ${shell.output}"
    commit_required: true     # Must commit fixes (default)
</code></pre>
<p><strong>Default</strong>: <code>true</code> - debug command must create commits (defined in <code>src/config/command.rs:181</code>)</p>
<p><strong>When to set to false</strong>: Rare - only if the debug command doesn’t modify code (e.g., just logs diagnostic info)</p>
<p><strong>Source</strong>: Field definition <code>src/config/command.rs:180-182</code></p>
<h2 id="real-world-examples"><a class="header" href="#real-world-examples">Real-World Examples</a></h2>
<h3 id="example-1-test-debugging-with-multiple-attempts"><a class="header" href="#example-1-test-debugging-with-multiple-attempts">Example 1: Test Debugging with Multiple Attempts</a></h3>
<p>From <code>workflows/implement.yml</code>:</p>
<pre><code class="language-yaml">- shell: "cargo test"
  timeout: 600
  on_failure:
    claude: "/prodigy-debug-test-failure --spec $ARG --output ${shell.output}"
    max_attempts: 5
    fail_workflow: false      # Continue even if tests can't be fixed
</code></pre>
<p><strong>Behavior</strong>:</p>
<ul>
<li>Run tests with 10-minute timeout</li>
<li>On failure, Claude analyzes output and fixes issues</li>
<li>Try up to 5 debug-fix-test cycles</li>
<li>If still failing after 5 attempts, continue workflow anyway</li>
<li>Each fix creates a commit</li>
</ul>
<p><strong>Source</strong>: <code>workflows/implement.yml:19-24</code></p>
<h3 id="example-2-critical-vs-non-critical-commands"><a class="header" href="#example-2-critical-vs-non-critical-commands">Example 2: Critical vs Non-Critical Commands</a></h3>
<p>From <code>workflows/coverage-with-test-debug.yml</code>:</p>
<pre><code class="language-yaml"># CRITICAL: Library tests must pass
- shell: "cargo test --lib"
  on_failure:
    claude: "/prodigy-debug-test-failure --spec ${coverage.spec} --output ${shell.output}"
    max_attempts: 3
    fail_workflow: true       # STOP if can't fix

# NON-CRITICAL: Doc tests are best-effort
- shell: "cargo test --doc"
  on_failure:
    claude: "/prodigy-fix-doc-tests --output ${shell.output}"
    max_attempts: 2
    fail_workflow: false      # CONTINUE if can't fix
</code></pre>
<p><strong>Source</strong>: <code>workflows/coverage-with-test-debug.yml:13-24</code></p>
<h3 id="example-3-chaining-with-on_success"><a class="header" href="#example-3-chaining-with-on_success">Example 3: Chaining with on_success</a></h3>
<p>From <code>workflows/implement-with-tests.yml</code>:</p>
<pre><code class="language-yaml">- shell: "cargo test"
  on_failure:
    # If tests fail, debug and fix them
    claude: "/prodigy-debug-test-failures '${test_output}'"
    commit_required: true
    on_success:
      # After fixing, verify tests now pass
      - shell: "cargo test"
        on_failure:
          # If STILL failing, try deeper analysis
          claude: "/prodigy-fix-test-failures '${shell.output}' --deep-analysis"
          commit_required: true
</code></pre>
<p><strong>Nested Retry Logic</strong>:</p>
<ol>
<li>Run tests</li>
<li>If fail → Debug and fix</li>
<li>If fix succeeded (commit created) → Re-run tests</li>
<li>If tests STILL fail → Try deeper analysis</li>
<li>Verify second fix works</li>
</ol>
<p><strong>Source</strong>: <code>workflows/implement-with-tests.yml:27-39</code></p>
<h3 id="example-4-linting-after-implementation"><a class="header" href="#example-4-linting-after-implementation">Example 4: Linting After Implementation</a></h3>
<p>From <code>workflows/documentation-drift.yml</code>:</p>
<pre><code class="language-yaml">- shell: "just fmt-check &amp;&amp; just lint"
  on_failure:
    claude: "/prodigy-lint ${shell.output}"
    commit_required: true
    max_attempts: 3
    fail_workflow: false      # Non-blocking - formatting issues shouldn't stop workflow
</code></pre>
<p><strong>Use Case</strong>: After implementing features, ensure code is properly formatted and linted, but don’t block if there are style issues.</p>
<p><strong>Source</strong>: <code>workflows/documentation-drift.yml:56-61</code></p>
<h2 id="how-it-works-execution-flow"><a class="header" href="#how-it-works-execution-flow">How It Works: Execution Flow</a></h2>
<h3 id="retry-loop"><a class="header" href="#retry-loop">Retry Loop</a></h3>
<p>When a shell command with <code>on_failure</code> fails:</p>
<ol>
<li><strong>Initial Failure</strong>: Shell command exits with non-zero code</li>
<li><strong>Capture Output</strong>: Stderr/stdout saved to <code>${shell.output}</code></li>
<li><strong>First Debug Attempt</strong>:
<ul>
<li>Run Claude command with failure output</li>
<li>Claude analyzes error and makes fixes</li>
<li>If <code>commit_required=true</code>, check for git commits</li>
</ul>
</li>
<li><strong>Retry Original Command</strong>:
<ul>
<li>If commits were created → Re-run original shell command</li>
<li>If no commits → Debug didn’t fix anything, stop retrying</li>
</ul>
</li>
<li><strong>Repeat</strong>: Continue debug-fix-retry cycle up to <code>max_attempts</code></li>
<li><strong>Final Result</strong>:
<ul>
<li>If any attempt succeeded → Command passes</li>
<li>If all attempts failed and <code>fail_workflow=true</code> → Workflow stops</li>
<li>If all attempts failed and <code>fail_workflow=false</code> → Workflow continues</li>
</ul>
</li>
</ol>
<h3 id="commit-requirement-logic"><a class="header" href="#commit-requirement-logic">Commit Requirement Logic</a></h3>
<p>The <code>commit_required</code> field interacts with the retry loop:</p>
<ul>
<li>
<p><strong><code>commit_required=true</code></strong> (default): Only retry if Claude created commits</p>
<ul>
<li>Rationale: If Claude didn’t commit, it didn’t find a fix</li>
<li>Prevents infinite loops where Claude can’t solve the problem</li>
</ul>
</li>
<li>
<p><strong><code>commit_required=false</code></strong>: Retry even if no commits</p>
<ul>
<li>Rare use case: Debug command doesn’t modify code (logging, diagnostics)</li>
</ul>
</li>
</ul>
<p><strong>Source</strong>: Conceptual flow based on <code>src/config/command.rs:168-183</code> definition and actual usage in workflows</p>
<h2 id="limitations-and-gotchas"><a class="header" href="#limitations-and-gotchas">Limitations and Gotchas</a></h2>
<h3 id="1-only-works-for-shell-commands"><a class="header" href="#1-only-works-for-shell-commands">1. Only Works for Shell Commands</a></h3>
<p>The <code>on_failure</code> field is only available for <code>shell:</code> commands, NOT for <code>claude:</code> commands:</p>
<pre><code class="language-yaml"># ✓ WORKS - shell command with on_failure
- shell: "cargo test"
  on_failure:
    claude: "/debug-test"

# ✗ DOES NOT WORK - claude command doesn't support on_failure
- claude: "/implement-feature"
  on_failure:              # This field is ignored!
    claude: "/fix-issue"
</code></pre>
<p><strong>Source</strong>: <code>src/config/command.rs:320-400</code> - WorkflowStepCommand has separate <code>shell</code> and <code>claude</code> fields, <code>on_failure</code> applies only to shell commands</p>
<h3 id="2-not-the-same-as-retry_config"><a class="header" href="#2-not-the-same-as-retry_config">2. Not the Same as retry_config</a></h3>
<p><strong>IMPORTANT</strong>: The <code>on_failure: TestDebugConfig</code> documented here is NOT the same as the theoretical <code>retry_config.on_failure: FailureAction</code> mentioned in the parent chapter.</p>
<pre><code class="language-yaml"># ✓ ACTUAL SYNTAX (what this subsection documents)
- shell: "cargo test"
  on_failure:
    claude: "/debug"
    max_attempts: 3

# ✗ DOES NOT WORK (theoretical syntax, not implemented)
- shell: "cargo test"
  retry_config:
    on_failure: stop        # This field exists in code but is NOT wired into execution
</code></pre>
<p>The <code>retry_config</code> field is <strong>not defined in WorkflowStepCommand</strong> (see <code>src/config/command.rs:320-400</code>). The <code>retry_v2::FailureAction</code> enum exists in <code>src/cook/retry_v2.rs:157-165</code> but is not integrated into command execution.</p>
<h3 id="3-testdebugconfig-is-not-retry-configuration"><a class="header" href="#3-testdebugconfig-is-not-retry-configuration">3. TestDebugConfig is Not Retry Configuration</a></h3>
<p>Despite the name and retry-like behavior, <code>TestDebugConfig</code> is a <strong>debugging mechanism</strong>, not a retry mechanism:</p>
<ul>
<li><strong>Retry</strong>: Re-run the same command without changes (for transient failures)</li>
<li><strong>Debug</strong>: Run a DIFFERENT command (Claude) to diagnose and fix the issue, THEN re-run</li>
</ul>
<p>The <code>TestDebugConfig</code> mechanism assumes failures are due to code issues that need fixing, not transient errors.</p>
<h3 id="4-max-attempts-includes-initial-failure"><a class="header" href="#4-max-attempts-includes-initial-failure">4. Max Attempts Includes Initial Failure</a></h3>
<p>If <code>max_attempts: 3</code>, the execution pattern is:</p>
<ol>
<li>Initial run (fails)</li>
<li>Debug attempt #1 → Retry</li>
<li>Debug attempt #2 → Retry</li>
<li>Debug attempt #3 → Retry</li>
</ol>
<p>So the original command runs up to <strong>4 times total</strong> (1 initial + 3 debug-retry cycles).</p>
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<h3 id="use-descriptive-claude-commands"><a class="header" href="#use-descriptive-claude-commands">Use Descriptive Claude Commands</a></h3>
<p>Good:</p>
<pre><code class="language-yaml">on_failure:
  claude: "/prodigy-debug-test-failure --spec ${spec_id} --output ${shell.output}"
</code></pre>
<p>Bad:</p>
<pre><code class="language-yaml">on_failure:
  claude: "/fix"              # Too generic - Claude won't know what to fix
</code></pre>
<h3 id="set-fail_workflow-based-on-criticality"><a class="header" href="#set-fail_workflow-based-on-criticality">Set fail_workflow Based on Criticality</a></h3>
<p><strong>Critical Operations</strong> (must succeed):</p>
<pre><code class="language-yaml">- shell: "cargo build --release"
  on_failure:
    claude: "/debug-build-failure"
    fail_workflow: true       # Stop if build can't be fixed
</code></pre>
<p><strong>Optional Operations</strong> (best effort):</p>
<pre><code class="language-yaml">- shell: "cargo bench"
  on_failure:
    claude: "/fix-bench-issues"
    fail_workflow: false      # Continue even if benchmarks fail
</code></pre>
<h3 id="use-appropriate-max_attempts"><a class="header" href="#use-appropriate-max_attempts">Use Appropriate max_attempts</a></h3>
<ul>
<li><strong>Quick fixes</strong> (formatting, simple errors): <code>max_attempts: 1-2</code></li>
<li><strong>Test debugging</strong> (moderate complexity): <code>max_attempts: 3</code> (default)</li>
<li><strong>Complex issues</strong> (integration tests, build issues): <code>max_attempts: 5</code></li>
<li><strong>Don’t use</strong>: <code>max_attempts: 10+</code> - if Claude can’t fix it in 5 tries, it won’t fix it in 10</li>
</ul>
<h3 id="pass-failure-output-to-claude"><a class="header" href="#pass-failure-output-to-claude">Pass Failure Output to Claude</a></h3>
<p>Always pass <code>${shell.output}</code> to give Claude the error context:</p>
<pre><code class="language-yaml">on_failure:
  claude: "/debug-test-failure --output ${shell.output}"
</code></pre>
<p>Without the output, Claude has to guess what went wrong.</p>
<h2 id="comparison-with-other-retry-mechanisms"><a class="header" href="#comparison-with-other-retry-mechanisms">Comparison with Other Retry Mechanisms</a></h2>
<p>Prodigy has multiple mechanisms that might be confused:</p>
<div class="table-wrapper"><table><thead><tr><th>Mechanism</th><th>Purpose</th><th>Scope</th><th>When to Use</th></tr></thead><tbody>
<tr><td><code>on_failure: TestDebugConfig</code></td><td>Auto-debug and fix code issues</td><td>Shell commands</td><td>Test failures, build errors that need code fixes</td></tr>
<tr><td><code>retry_config</code> (theoretical)</td><td>Retry with backoff for transient errors</td><td>Commands (not implemented)</td><td>Network errors, timeouts (when implemented)</td></tr>
<tr><td>Workflow-level retry</td><td>Retry entire work items</td><td>MapReduce jobs</td><td>Bulk operation failures, DLQ retry</td></tr>
<tr><td><code>on_success</code> chaining</td><td>Sequential command execution</td><td>Any command</td><td>Multi-step validation, verification after fixes</td></tr>
</tbody></table>
</div>
<p><strong>This subsection documents only</strong>: <code>on_failure: TestDebugConfig</code></p>
<p>For workflow-level retry, see <a href="./workflow-level-vs-command-level-retry.html">Workflow-Level vs Command-Level Retry</a>.</p>
<h2 id="migration-from-deprecated-test-syntax"><a class="header" href="#migration-from-deprecated-test-syntax">Migration from Deprecated test: Syntax</a></h2>
<p>The <code>test:</code> command type is deprecated. Migrate to <code>shell:</code> with <code>on_failure:</code>:</p>
<p><strong>Old (Deprecated)</strong>:</p>
<pre><code class="language-yaml">- test:
    command: "cargo test"
    on_failure:
      claude: "/debug"
</code></pre>
<p><strong>New (Current)</strong>:</p>
<pre><code class="language-yaml">- shell: "cargo test"
  on_failure:
    claude: "/debug"
</code></pre>
<p><strong>Source</strong>: Deprecation warning in <code>src/config/command.rs:446-455</code></p>
<h2 id="see-also"><a class="header" href="#see-also">See Also</a></h2>
<ul>
<li><a href="./basic-retry-configuration.html">Basic Retry Configuration</a> - Retry configuration basics</li>
<li><a href="./conditional-retry-with-error-matchers.html">Conditional Retry with Error Matchers</a> - Selective retry by error type</li>
<li><a href="./best-practices.html">Best Practices</a> - When to use each failure handling mechanism</li>
<li><a href="./complete-examples.html">Complete Examples</a> - Full workflow examples</li>
<li><a href="./workflow-level-vs-command-level-retry.html">Workflow-Level vs Command-Level Retry</a> - Comparison of retry systems</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../retry-configuration/retry-budget.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../retry-configuration/complete-examples.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../retry-configuration/retry-budget.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../retry-configuration/complete-examples.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
