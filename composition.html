<!DOCTYPE HTML>
<html lang="en" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Workflow Composition - Prodigy Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="AI-powered workflow orchestration for development teams">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Prodigy Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/iepathos/prodigy" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/iepathos/prodigy/edit/main/book/src/composition.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="workflow-composition"><a class="header" href="#workflow-composition">Workflow Composition</a></h1>
<p>Prodigy provides powerful composition features that enable building complex workflows from reusable components. This chapter covers importing workflows, using templates, defining parameters, and composing workflows through inheritance.</p>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>Workflow composition allows you to:</p>
<ul>
<li><strong>Import</strong> shared workflow configurations from other files</li>
<li><strong>Extend</strong> base workflows to inherit common configurations</li>
<li><strong>Use templates</strong> from a registry for standardized patterns</li>
<li><strong>Define parameters</strong> with type validation for flexible workflows</li>
<li><strong>Execute sub-workflows</strong> in parallel or sequentially</li>
<li><strong>Set defaults</strong> for common parameter values</li>
</ul>
<p>These features promote code reuse, maintainability, and consistency across your automation workflows.</p>
<h2 id="workflow-imports"><a class="header" href="#workflow-imports">Workflow Imports</a></h2>
<p>Import external workflow files to reuse configurations and share common patterns across multiple workflows.</p>
<h3 id="basic-import"><a class="header" href="#basic-import">Basic Import</a></h3>
<p>Import an entire workflow file:</p>
<pre><code class="language-yaml">name: my-workflow
imports:
  - path: ./common/utilities.yml
</code></pre>
<p>This imports all content from <code>utilities.yml</code> into your workflow.</p>
<h3 id="import-with-alias"><a class="header" href="#import-with-alias">Import with Alias</a></h3>
<p>Use an alias to reference imported workflows:</p>
<pre><code class="language-yaml">imports:
  - path: ./common/utilities.yml
    alias: utils
</code></pre>
<p>The alias provides a namespace for the imported content, preventing naming conflicts.</p>
<h3 id="selective-import"><a class="header" href="#selective-import">Selective Import</a></h3>
<p>Import only specific items from a workflow file:</p>
<pre><code class="language-yaml">imports:
  - path: ./common/validators.yml
    selective:
      - validate_output
      - validate_schema
</code></pre>
<p>This imports only the specified workflows, reducing unnecessary dependencies.</p>
<h3 id="multiple-imports"><a class="header" href="#multiple-imports">Multiple Imports</a></h3>
<p>You can import from multiple files:</p>
<pre><code class="language-yaml">imports:
  - path: ./common/setup.yml
    alias: setup
  - path: ./common/cleanup.yml
    alias: cleanup
  - path: ./shared/validators.yml
    selective:
      - validate_config
</code></pre>
<p>Imports are processed in order, and later imports can override earlier ones.</p>
<h2 id="workflow-extension-inheritance"><a class="header" href="#workflow-extension-inheritance">Workflow Extension (Inheritance)</a></h2>
<p>Extend a base workflow to inherit its configuration. Child workflows override parent values, allowing you to customize specific aspects while maintaining common configuration.</p>
<h3 id="basic-extension"><a class="header" href="#basic-extension">Basic Extension</a></h3>
<pre><code class="language-yaml">name: production-workflow
extends: base-workflow
</code></pre>
<p>This workflow inherits all configuration from <code>base-workflow</code>.</p>
<h3 id="base-resolution-paths"><a class="header" href="#base-resolution-paths">Base Resolution Paths</a></h3>
<p>Prodigy searches for base workflows in the following locations (in order):</p>
<ol>
<li><code>./bases/&lt;name&gt;.yml</code></li>
<li><code>./templates/&lt;name&gt;.yml</code></li>
<li><code>./workflows/&lt;name&gt;.yml</code></li>
<li><code>./&lt;name&gt;.yml</code></li>
</ol>
<p>For example, <code>extends: base-workflow</code> will look for:</p>
<ul>
<li><code>./bases/base-workflow.yml</code></li>
<li><code>./templates/base-workflow.yml</code></li>
<li><code>./workflows/base-workflow.yml</code></li>
<li><code>./base-workflow.yml</code></li>
</ul>
<h3 id="override-behavior"><a class="header" href="#override-behavior">Override Behavior</a></h3>
<p>Child workflows override parent configuration:</p>
<pre><code class="language-yaml"># bases/base-workflow.yml
name: base
commands:
  - shell: "echo 'Setup'"
  - shell: "echo 'Base task'"
defaults:
  timeout: 300
  verbose: false

# production.yml
name: production
extends: base-workflow
commands:
  - shell: "echo 'Production task'"  # Overrides base commands
defaults:
  verbose: true  # Overrides base default
</code></pre>
<p>The <code>production</code> workflow completely replaces the <code>commands</code> array and overrides the <code>verbose</code> default, while inheriting the <code>timeout</code> default.</p>
<h2 id="template-system"><a class="header" href="#template-system">Template System</a></h2>
<p>Templates provide reusable workflow patterns that can be instantiated with different parameters. Templates can be stored in a registry or loaded from files.</p>
<h3 id="template-sources"><a class="header" href="#template-sources">Template Sources</a></h3>
<p>Templates can come from three sources:</p>
<h4 id="1-registry-templates"><a class="header" href="#1-registry-templates">1. Registry Templates</a></h4>
<p>Store templates in a central registry:</p>
<pre><code class="language-yaml">name: my-workflow
template:
  name: refactor-base
  source: refactor-base  # Registry name
  with:
    style: modular
    target: src/
</code></pre>
<h4 id="2-file-templates"><a class="header" href="#2-file-templates">2. File Templates</a></h4>
<p>Load templates from local files:</p>
<pre><code class="language-yaml">template:
  name: ci-pipeline
  source: ./templates/ci-pipeline.yml
  with:
    environment: staging
</code></pre>
<h4 id="3-url-templates-planned"><a class="header" href="#3-url-templates-planned">3. URL Templates (Planned)</a></h4>
<p>Future support for remote templates:</p>
<pre><code class="language-yaml">template:
  name: shared-workflow
  source: https://example.com/templates/workflow.yml
</code></pre>
<p><em>Note: URL template sources are not yet implemented.</em></p>
<h3 id="template-parameters"><a class="header" href="#template-parameters">Template Parameters</a></h3>
<p>Pass parameters to templates using the <code>with</code> field:</p>
<pre><code class="language-yaml">template:
  name: refactor-base
  source: refactor-base
  with:
    style: functional
    max_complexity: 5
    target_dir: src/
</code></pre>
<p>Parameters are substituted throughout the template workflow.</p>
<h3 id="template-overrides"><a class="header" href="#template-overrides">Template Overrides</a></h3>
<p>Override specific template values:</p>
<pre><code class="language-yaml">template:
  name: test-workflow
  source: test-base
  with:
    parallel: true
  override:
    timeout: 600
    retry_count: 5
</code></pre>
<p>The <code>override</code> field allows you to modify template values after parameter substitution.</p>
<h3 id="template-registry-management"><a class="header" href="#template-registry-management">Template Registry Management</a></h3>
<h4 id="registering-templates"><a class="header" href="#registering-templates">Registering Templates</a></h4>
<p>Register a template for reuse:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use prodigy::cook::workflow::{ComposableWorkflow, TemplateRegistry};

let registry = TemplateRegistry::new();
let template = ComposableWorkflow::from_config(/* ... */);

registry.register_template("my-template".to_string(), template).await?;
<span class="boring">}</span></code></pre></pre>
<h4 id="listing-templates"><a class="header" href="#listing-templates">Listing Templates</a></h4>
<p>View all available templates:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let templates = registry.list().await?;
for template in templates {
    println!("{}: {} (v{})", template.name,
             template.description.unwrap_or_default(),
             template.version);
}
<span class="boring">}</span></code></pre></pre>
<h4 id="searching-by-tags"><a class="header" href="#searching-by-tags">Searching by Tags</a></h4>
<p>Find templates by tags:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let refactor_templates = registry.search_by_tags(&amp;["refactor".to_string()]).await?;
<span class="boring">}</span></code></pre></pre>
<h4 id="deleting-templates"><a class="header" href="#deleting-templates">Deleting Templates</a></h4>
<p>Remove a template from the registry:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>registry.delete("old-template").await?;
<span class="boring">}</span></code></pre></pre>
<h3 id="template-metadata"><a class="header" href="#template-metadata">Template Metadata</a></h3>
<p>Templates can include metadata for better organization:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use prodigy::cook::workflow::composition::registry::TemplateMetadata;

let metadata = TemplateMetadata {
    description: Some("Refactoring workflow for Rust code".to_string()),
    author: Some("DevOps Team".to_string()),
    version: "2.0.0".to_string(),
    tags: vec!["refactor".to_string(), "rust".to_string()],
    created_at: chrono::Utc::now(),
    updated_at: chrono::Utc::now(),
};

registry.register_template_with_metadata(
    "refactor-rust".to_string(),
    template,
    metadata
).await?;
<span class="boring">}</span></code></pre></pre>
<h2 id="parameter-definitions"><a class="header" href="#parameter-definitions">Parameter Definitions</a></h2>
<p>Define parameters with type validation to create flexible, reusable workflows.</p>
<h3 id="parameter-types"><a class="header" href="#parameter-types">Parameter Types</a></h3>
<p>Prodigy supports the following parameter types:</p>
<ul>
<li><code>string</code> - Text values</li>
<li><code>number</code> - Numeric values</li>
<li><code>boolean</code> - True/false values</li>
<li><code>array</code> - List of values</li>
<li><code>object</code> - Structured data</li>
<li><code>any</code> - Any JSON value</li>
</ul>
<h3 id="required-parameters"><a class="header" href="#required-parameters">Required Parameters</a></h3>
<p>Define parameters that must be provided:</p>
<pre><code class="language-yaml">parameters:
  required:
    - name: target_file
      type: string
      description: File to process
    - name: iteration_count
      type: number
      description: Number of iterations to run
    - name: enabled
      type: boolean
      description: Enable feature flag
</code></pre>
<h3 id="optional-parameters"><a class="header" href="#optional-parameters">Optional Parameters</a></h3>
<p>Define optional parameters with default values:</p>
<pre><code class="language-yaml">parameters:
  optional:
    - name: style
      type: string
      description: Processing style
      default: "functional"
    - name: timeout
      type: number
      description: Timeout in seconds
      default: 300
    - name: verbose
      type: boolean
      description: Enable verbose output
      default: false
</code></pre>
<h3 id="parameter-validation"><a class="header" href="#parameter-validation">Parameter Validation</a></h3>
<p>Add custom validation expressions:</p>
<pre><code class="language-yaml">parameters:
  required:
    - name: email
      type: string
      description: Email address
      validation: "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
    - name: count
      type: number
      description: Item count
      validation: "value &gt;= 1 &amp;&amp; value &lt;= 100"
</code></pre>
<p><em>Note: Custom validation expression evaluation is planned but not fully implemented.</em></p>
<h3 id="array-and-object-parameters"><a class="header" href="#array-and-object-parameters">Array and Object Parameters</a></h3>
<p>Define complex parameter types:</p>
<pre><code class="language-yaml">parameters:
  required:
    - name: files
      type: array
      description: List of files to process
    - name: config
      type: object
      description: Configuration object
  optional:
    - name: tags
      type: array
      description: Tags to apply
      default: []
</code></pre>
<h3 id="type-validation"><a class="header" href="#type-validation">Type Validation</a></h3>
<p>Prodigy automatically validates parameter types:</p>
<pre><code class="language-yaml"># Valid
parameters:
  target_file: "src/main.rs"
  iteration_count: 5
  enabled: true

# Invalid - type mismatch
parameters:
  target_file: "src/main.rs"
  iteration_count: "five"  # Error: expected number, got string
  enabled: true
</code></pre>
<h3 id="parameter-substitution"><a class="header" href="#parameter-substitution">Parameter Substitution</a></h3>
<p>Use parameters in commands with <code>${parameter_name}</code> syntax:</p>
<pre><code class="language-yaml">parameters:
  required:
    - name: target_dir
      type: string
      description: Target directory
commands:
  - shell: "cd ${target_dir} &amp;&amp; cargo build"
  - claude: "/analyze ${target_dir}"
</code></pre>
<h2 id="default-values"><a class="header" href="#default-values">Default Values</a></h2>
<p>Set default parameter values at the workflow level:</p>
<pre><code class="language-yaml">defaults:
  timeout: 300
  retry_count: 3
  verbose: false
  environment: development
</code></pre>
<p>Defaults are applied before parameter validation and can be overridden by:</p>
<ol>
<li>Values in the <code>parameters</code> section</li>
<li>Values passed at workflow invocation time</li>
<li>Template <code>override</code> fields</li>
</ol>
<p>Defaults interact with parameters as follows:</p>
<ul>
<li>If a required parameter has a default, it’s not strictly required</li>
<li>Optional parameter defaults take precedence over workflow defaults</li>
<li>Workflow defaults provide fallback values for any parameter</li>
</ul>
<h2 id="sub-workflows"><a class="header" href="#sub-workflows">Sub-Workflows</a></h2>
<p>Execute child workflows as part of a parent workflow. Sub-workflows can run in parallel and have their own parameters and outputs.</p>
<h3 id="basic-sub-workflow"><a class="header" href="#basic-sub-workflow">Basic Sub-Workflow</a></h3>
<pre><code class="language-yaml">workflows:
  process_files:
    source: ./workflows/process.yml
    parameters:
      parallel: true
</code></pre>
<h3 id="sub-workflow-parameters"><a class="header" href="#sub-workflow-parameters">Sub-Workflow Parameters</a></h3>
<p>Pass parameters to sub-workflows:</p>
<pre><code class="language-yaml">workflows:
  validate_code:
    source: ./workflows/validate.yml
    parameters:
      strict_mode: true
      max_warnings: 5
</code></pre>
<h3 id="inputoutput-mapping"><a class="header" href="#inputoutput-mapping">Input/Output Mapping</a></h3>
<p>Map inputs and outputs between parent and sub-workflows:</p>
<pre><code class="language-yaml">workflows:
  transform_data:
    source: ./workflows/transform.yml
    inputs:
      source_files: "file_list"  # Map parent variable to sub-workflow input
      config: "transform_config"
    outputs:
      - processed_count  # Expose sub-workflow output to parent
      - error_log
</code></pre>
<h3 id="parallel-execution"><a class="header" href="#parallel-execution">Parallel Execution</a></h3>
<p>Run multiple sub-workflows in parallel:</p>
<pre><code class="language-yaml">workflows:
  run_tests:
    source: ./workflows/test.yml
    parallel: true
    parameters:
      suite: unit

  run_linting:
    source: ./workflows/lint.yml
    parallel: true
</code></pre>
<p>Both workflows execute concurrently.</p>
<h3 id="error-handling"><a class="header" href="#error-handling">Error Handling</a></h3>
<p>Control sub-workflow error behavior:</p>
<pre><code class="language-yaml">workflows:
  optional_task:
    source: ./workflows/optional.yml
    continue_on_error: true  # Parent continues if this fails

  critical_task:
    source: ./workflows/critical.yml
    continue_on_error: false  # Parent fails if this fails (default)
</code></pre>
<h3 id="timeouts-and-working-directory"><a class="header" href="#timeouts-and-working-directory">Timeouts and Working Directory</a></h3>
<p>Configure execution constraints:</p>
<pre><code class="language-yaml">workflows:
  long_running:
    source: ./workflows/process.yml
    timeout: 600  # 10 minutes in seconds
    working_dir: ./build/  # Execute from this directory
</code></pre>
<h2 id="composition-metadata"><a class="header" href="#composition-metadata">Composition Metadata</a></h2>
<p>Prodigy tracks metadata about workflow composition for debugging and dependency analysis.</p>
<h3 id="tracked-information"><a class="header" href="#tracked-information">Tracked Information</a></h3>
<p>The composition system tracks:</p>
<ul>
<li><strong>Sources</strong>: All workflow files involved in composition</li>
<li><strong>Templates</strong>: Templates used and their sources</li>
<li><strong>Parameters</strong>: Parameters applied during composition</li>
<li><strong>Composed At</strong>: Timestamp of composition</li>
<li><strong>Dependencies</strong>: Full dependency graph with types</li>
</ul>
<h3 id="dependency-types"><a class="header" href="#dependency-types">Dependency Types</a></h3>
<p>The system tracks four types of dependencies:</p>
<ul>
<li><code>Import</code> - Files imported with <code>imports:</code></li>
<li><code>Extends</code> - Base workflows referenced with <code>extends:</code></li>
<li><code>Template</code> - Templates used with <code>template:</code></li>
<li><code>SubWorkflow</code> - Sub-workflows defined in <code>workflows:</code></li>
</ul>
<h3 id="dependency-graph"><a class="header" href="#dependency-graph">Dependency Graph</a></h3>
<p>Prodigy builds a complete dependency graph during composition:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use prodigy::cook::workflow::{WorkflowComposer, ComposedWorkflow};

let composed: ComposedWorkflow = composer.compose(&amp;source, params).await?;

// Access composition metadata
println!("Sources: {:?}", composed.metadata.sources);
println!("Templates: {:?}", composed.metadata.templates);
println!("Dependencies: {:?}", composed.metadata.dependencies);
<span class="boring">}</span></code></pre></pre>
<h3 id="circular-dependency-detection"><a class="header" href="#circular-dependency-detection">Circular Dependency Detection</a></h3>
<p>The composer automatically detects circular dependencies:</p>
<pre><code class="language-yaml"># workflow-a.yml
name: workflow-a
extends: workflow-b

# workflow-b.yml
name: workflow-b
extends: workflow-a  # Error: circular dependency detected
</code></pre>
<p>This prevents infinite loops during composition.</p>
<h2 id="complete-examples"><a class="header" href="#complete-examples">Complete Examples</a></h2>
<h3 id="example-1-basic-import-with-alias"><a class="header" href="#example-1-basic-import-with-alias">Example 1: Basic Import with Alias</a></h3>
<pre><code class="language-yaml">name: integration-test
imports:
  - path: ./common/setup.yml
    alias: setup
  - path: ./common/assertions.yml
    alias: assert

commands:
  - shell: "npm install"
  - shell: "npm test"
</code></pre>
<h3 id="example-2-selective-import"><a class="header" href="#example-2-selective-import">Example 2: Selective Import</a></h3>
<pre><code class="language-yaml">name: validation-workflow
imports:
  - path: ./validators/all.yml
    selective:
      - validate_yaml
      - validate_json
      - validate_toml

commands:
  - shell: "find . -name '*.yml' -exec validate {}"
</code></pre>
<h3 id="example-3-template-from-registry"><a class="header" href="#example-3-template-from-registry">Example 3: Template from Registry</a></h3>
<pre><code class="language-yaml">name: refactor-project
template:
  name: rust-refactor
  source: rust-refactor  # From registry
  with:
    max_complexity: 5
    style: functional
    target: src/

commands:
  - claude: "/analyze-debt"
</code></pre>
<h3 id="example-4-template-with-override"><a class="header" href="#example-4-template-with-override">Example 4: Template with Override</a></h3>
<pre><code class="language-yaml">name: custom-ci
template:
  name: ci-base
  source: ./templates/ci.yml
  with:
    environment: production
  override:
    timeout: 1800
    retry_count: 3
</code></pre>
<h3 id="example-5-workflow-with-parameters"><a class="header" href="#example-5-workflow-with-parameters">Example 5: Workflow with Parameters</a></h3>
<pre><code class="language-yaml">name: deploy-service
parameters:
  required:
    - name: environment
      type: string
      description: Deployment environment
      validation: "^(dev|staging|prod)$"
    - name: version
      type: string
      description: Version to deploy
  optional:
    - name: rollback_on_error
      type: boolean
      description: Auto-rollback on deployment failure
      default: true

commands:
  - shell: "deploy --env ${environment} --version ${version}"
  - shell: "verify-deployment ${environment}"
</code></pre>
<h3 id="example-6-complex-composition"><a class="header" href="#example-6-complex-composition">Example 6: Complex Composition</a></h3>
<pre><code class="language-yaml">name: full-pipeline
extends: base-pipeline

imports:
  - path: ./common/docker.yml
    alias: docker
  - path: ./common/kubernetes.yml
    alias: k8s

template:
  name: ci-cd-base
  source: ci-cd-base
  with:
    registry: docker.io
    namespace: my-app

parameters:
  required:
    - name: branch
      type: string
      description: Git branch
    - name: tag
      type: string
      description: Docker tag
  optional:
    - name: skip_tests
      type: boolean
      description: Skip test execution
      default: false

defaults:
  timeout: 600
  retry_count: 2

workflows:
  run_tests:
    source: ./workflows/test.yml
    parallel: true
    parameters:
      suite: all
    continue_on_error: false

  build_image:
    source: ./workflows/docker-build.yml
    parameters:
      tag: "${tag}"
    timeout: 900

commands:
  - shell: "echo 'Pipeline completed for ${branch}'"
</code></pre>
<h3 id="example-7-sub-workflow-execution"><a class="header" href="#example-7-sub-workflow-execution">Example 7: Sub-Workflow Execution</a></h3>
<pre><code class="language-yaml">name: multi-stage-pipeline
workflows:
  stage1_build:
    source: ./workflows/build.yml
    parameters:
      target: release
    outputs:
      - artifact_path

  stage2_test:
    source: ./workflows/test.yml
    parallel: true
    inputs:
      artifact: "artifact_path"
    continue_on_error: false

  stage3_deploy:
    source: ./workflows/deploy.yml
    inputs:
      artifact: "artifact_path"
    timeout: 600
    working_dir: ./deployment/

commands:
  - shell: "echo 'All stages completed'"
</code></pre>
<h3 id="example-8-parameterized-template"><a class="header" href="#example-8-parameterized-template">Example 8: Parameterized Template</a></h3>
<pre><code class="language-yaml">name: analyze-codebase
template:
  name: code-analysis
  source: code-analysis
  with:
    language: rust
    strictness: high
    output_format: json
  override:
    max_parallel: 4

parameters:
  required:
    - name: target_dir
      type: string
      description: Directory to analyze
  optional:
    - name: exclude_patterns
      type: array
      description: Patterns to exclude
      default: ["target/", "node_modules/"]

commands:
  - claude: "/analyze ${target_dir} --exclude ${exclude_patterns}"
</code></pre>
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<h3 id="when-to-use-each-feature"><a class="header" href="#when-to-use-each-feature">When to Use Each Feature</a></h3>
<ul>
<li><strong>Imports</strong>: Share common configurations (environment variables, setup steps)</li>
<li><strong>Extends</strong>: Create workflow hierarchies with base configurations</li>
<li><strong>Templates</strong>: Standardize workflows across projects and teams</li>
<li><strong>Parameters</strong>: Make workflows flexible and reusable</li>
<li><strong>Sub-workflows</strong>: Break complex workflows into manageable pieces</li>
</ul>
<h3 id="organizing-reusable-workflows"><a class="header" href="#organizing-reusable-workflows">Organizing Reusable Workflows</a></h3>
<p>Create a clear directory structure:</p>
<pre><code>project/
├── workflows/          # Main workflows
├── bases/             # Base workflows for inheritance
├── templates/         # Template workflows
└── common/            # Shared configurations for import
    ├── setup.yml
    ├── cleanup.yml
    └── validators.yml
</code></pre>
<h3 id="template-registry-management-1"><a class="header" href="#template-registry-management-1">Template Registry Management</a></h3>
<ul>
<li>Use descriptive template names</li>
<li>Version templates semantically (1.0.0, 2.0.0)</li>
<li>Tag templates for discoverability (e.g., “refactor”, “ci”, “test”)</li>
<li>Document required parameters in template descriptions</li>
<li>Test templates before registering them</li>
</ul>
<h3 id="avoiding-circular-dependencies"><a class="header" href="#avoiding-circular-dependencies">Avoiding Circular Dependencies</a></h3>
<ul>
<li>Keep inheritance chains shallow (max 2-3 levels)</li>
<li>Use imports for shared utilities, not mutual dependencies</li>
<li>Design base workflows to be self-contained</li>
<li>Document dependency relationships</li>
</ul>
<h3 id="testing-composed-workflows"><a class="header" href="#testing-composed-workflows">Testing Composed Workflows</a></h3>
<p>Test workflows at each composition level:</p>
<ol>
<li><strong>Unit level</strong>: Test individual workflows</li>
<li><strong>Integration level</strong>: Test workflows with imports</li>
<li><strong>Composition level</strong>: Test fully composed workflows with all features</li>
</ol>
<h3 id="naming-conventions"><a class="header" href="#naming-conventions">Naming Conventions</a></h3>
<p>Use consistent naming:</p>
<ul>
<li>Base workflows: <code>base-{purpose}.yml</code></li>
<li>Templates: <code>{category}-{purpose}.yml</code></li>
<li>Shared utilities: <code>{function}-utils.yml</code></li>
<li>Parameters: Use snake_case (<code>target_file</code>, not <code>targetFile</code>)</li>
</ul>
<h2 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h2>
<h3 id="circular-dependency-errors"><a class="header" href="#circular-dependency-errors">Circular Dependency Errors</a></h3>
<p><strong>Error</strong>: <code>Circular dependency detected in workflow composition</code></p>
<p><strong>Cause</strong>: Workflows reference each other in a loop</p>
<p><strong>Solution</strong>: Review your <code>extends</code> and <code>imports</code> to break the cycle:</p>
<pre><code class="language-yaml"># Bad: A extends B, B extends A
# Good: A and B both extend base-workflow
</code></pre>
<h3 id="template-not-found-errors"><a class="header" href="#template-not-found-errors">Template Not Found Errors</a></h3>
<p><strong>Error</strong>: <code>Template 'my-template' not found in registry</code></p>
<p><strong>Cause</strong>: Template doesn’t exist or hasn’t been registered</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>List available templates: <code>registry.list().await?</code></li>
<li>Register the template before using it</li>
<li>Check template name spelling</li>
</ol>
<h3 id="parameter-validation-failures"><a class="header" href="#parameter-validation-failures">Parameter Validation Failures</a></h3>
<p><strong>Error</strong>: <code>Required parameter 'target' not provided</code></p>
<p><strong>Cause</strong>: Missing required parameter</p>
<p><strong>Solution</strong>: Provide all required parameters:</p>
<pre><code class="language-yaml">parameters:
  target: "src/"
  iterations: 5
</code></pre>
<p><strong>Error</strong>: <code>Type mismatch: expected Number, got String</code></p>
<p><strong>Cause</strong>: Parameter value doesn’t match declared type</p>
<p><strong>Solution</strong>: Ensure parameter types match:</p>
<pre><code class="language-yaml"># Wrong: count: "5"
# Right: count: 5
</code></pre>
<h3 id="import-path-resolution"><a class="header" href="#import-path-resolution">Import Path Resolution</a></h3>
<p><strong>Error</strong>: <code>Failed to load import from "./common/utils.yml"</code></p>
<p><strong>Cause</strong>: Import path doesn’t exist</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Use paths relative to workflow file</li>
<li>Verify file exists at the specified location</li>
<li>Check file permissions</li>
</ol>
<h3 id="base-workflow-not-found"><a class="header" href="#base-workflow-not-found">Base Workflow Not Found</a></h3>
<p><strong>Error</strong>: <code>Base workflow 'base' not found</code></p>
<p><strong>Cause</strong>: Base workflow not in standard locations</p>
<p><strong>Solution</strong>: Place base workflow in one of:</p>
<ul>
<li><code>./bases/base.yml</code></li>
<li><code>./templates/base.yml</code></li>
<li><code>./workflows/base.yml</code></li>
<li><code>./base.yml</code></li>
</ul>
<p>Or use a full path in <code>extends</code>.</p>
<h2 id="related-chapters"><a class="header" href="#related-chapters">Related Chapters</a></h2>
<ul>
<li><a href="workflow-basics.html">Workflow Basics</a> - Fundamental workflow concepts</li>
<li><a href="commands.html">Commands</a> - Command types and execution</li>
<li><a href="variables.html">Variables</a> - Variable interpolation and substitution</li>
<li><a href="examples.html">Examples</a> - Additional workflow examples</li>
</ul>
<h2 id="further-reading"><a class="header" href="#further-reading">Further Reading</a></h2>
<ul>
<li>Source code: <code>src/cook/workflow/composition/</code></li>
<li>Integration tests: <code>tests/workflow_composition_test.rs</code></li>
<li>Template registry: <code>src/cook/workflow/composition/registry.rs</code></li>
<li>Dependency resolution: <code>src/cook/workflow/composition/composer.rs</code></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="advanced.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="retry-configuration.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="advanced.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="retry-configuration.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
