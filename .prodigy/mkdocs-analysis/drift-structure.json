{
  "item_type": "page",
  "page_id": "structure",
  "page_title": "structure",
  "page_file": "docs/advanced/storage/structure.md",
  "drift_detected": true,
  "severity": "low",
  "quality_assessment": "Good coverage of storage structure with minor documentation gaps",
  "issues": [
    {
      "type": "outdated_information",
      "severity": "low",
      "section": "Storage Structure",
      "description": "Documentation shows separate session-to-job.json and job-to-session.json mapping files, but actual implementation stores mappings as individual JSON files per session/job ID in a single mappings/ directory",
      "current_content": "├── mappings/\n│   ├── session-to-job.json\n│   └── job-to-session.json",
      "should_be": "├── mappings/\n│   ├── {session_id}.json\n│   └── {job_id}.json",
      "fix_suggestion": "Update the directory structure diagram to reflect the actual implementation where each mapping is stored as a separate file named after the session ID or job ID (e.g., session-123.json, mapreduce-456.json)",
      "source_reference": "src/storage/session_job_mapping.rs:40-51"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Storage Structure",
      "description": "Missing documentation for resume_locks/ directory used for concurrent resume protection",
      "feature_reference": "storage_architecture.structure",
      "fix_suggestion": "Add resume_locks/ directory to the storage structure diagram: └── resume_locks/  # Concurrent resume protection locks\n    └── {job_id}.lock",
      "source_reference": "src/cook/execution/resume_lock.rs:52"
    },
    {
      "type": "incomplete_explanation",
      "severity": "low",
      "section": "State Storage",
      "description": "Documentation mentions job-state.json but actual implementation uses a more comprehensive checkpoint structure with MapReduceCheckpoint type containing metadata, execution_state, work_item_state, agent_state, variable_state, resource_state, and error_state",
      "fix_suggestion": "Enhance the checkpoint documentation to mention the comprehensive checkpoint structure including all major state components",
      "source_reference": "src/cook/execution/mapreduce/checkpoint/types.rs:47-64"
    },
    {
      "type": "outdated_information",
      "severity": "low",
      "section": "Checkpoint Types - Map Phase",
      "description": "The map checkpoint documentation shows simplified fields (completed_items, in_progress_items, pending_items as arrays), but actual WorkItemState structure uses more detailed types including WorkItem, WorkItemProgress, CompletedWorkItem, and FailedWorkItem with full metadata",
      "current_content": "\"completed_items\": [\"item-1\", \"item-2\"],\n\"in_progress_items\": [\"item-3\"],\n\"pending_items\": [\"item-4\", \"item-5\"]",
      "should_be": "Work items are stored as full objects with id, data, timestamps, and associated metadata - not as simple string arrays",
      "fix_suggestion": "Add note explaining that the example is simplified and actual checkpoint data includes full work item metadata including WorkItem objects, timestamps, and agent information",
      "source_reference": "src/cook/execution/mapreduce/checkpoint/types.rs:128-176"
    }
  ],
  "positive_aspects": [
    "Excellent visual diagrams using mermaid showing storage hierarchy and cross-worktree aggregation",
    "Clear ASCII directory tree providing quick reference",
    "Good use of MkDocs Material features (admonitions, code annotations with numbered callouts)",
    "Comprehensive coverage of main storage directories (events, dlq, state, sessions, worktrees, orphaned_worktrees)",
    "Accurate event storage documentation with JSONL format and timestamp-based file naming",
    "Useful cross-worktree aggregation diagram showing how multiple agents share event logs",
    "Checkpoint types section provides good overview of setup/map/reduce phase checkpoints"
  ],
  "improvement_suggestions": [
    "Add resume_locks/ directory to storage structure for completeness",
    "Correct the mappings/ structure to show individual {id}.json files rather than session-to-job.json and job-to-session.json",
    "Add a note about checkpoint file versioning and cleanup behavior",
    "Consider adding a section on storage migration and backward compatibility",
    "Add cross-references to related pages (session-dlq.md, worktree-storage.md) for navigation"
  ],
  "metadata": {
    "analyzed_at": "2025-12-27T03:30:00Z",
    "feature_inventory": ".prodigy/mkdocs-analysis/features.json",
    "topics_covered": ["storage structure", "events", "DLQ", "checkpoints", "sessions", "worktrees", "orphaned worktrees"],
    "validation_focus": "Auto-discovered page - check for drift and enhance with visual features",
    "internal_links_validated": true,
    "broken_links_found": 0
  }
}
