{
  "item_type": "page",
  "page_id": "variables-index",
  "page_title": "Variable Interpolation",
  "page_file": "docs/variables/index.md",
  "drift_detected": true,
  "severity": "medium",
  "quality_assessment": "Page provides good overview structure but has incomplete variable coverage in the phase availability table and lacks visual enhancements",
  "issues": [
    {
      "type": "missing_content",
      "severity": "medium",
      "section": "Variable Availability by Phase",
      "description": "Table is missing several important MapReduce variables that are documented in available-variables.md and implemented in the codebase: map.successful, map.failed, map.success_rate, map.results_json, worker.id",
      "current_content": "Map Aggregation (`${map.total}`, etc.)",
      "should_be": "Map Aggregation should explicitly list: map.total, map.successful, map.failed, map.success_rate, map.results, map.results_json, worker.id",
      "fix_suggestion": "Update the table row for 'Map Aggregation' to list all available MapReduce variables or add a note referencing the complete list in available-variables.md",
      "source_reference": "src/cook/execution/mapreduce/utils.rs:114-116, src/cook/execution/mapreduce/reduce_phase.rs:124-140"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Variable Availability by Phase",
      "description": "Table is missing Git Context variables that are available in multiple phases (step.files_added, step.commits, etc.)",
      "fix_suggestion": "Add a row for 'Git Context Variables' showing availability: Setup ✓, Map ✓, Reduce ✓, Merge ✓",
      "source_reference": "docs/variables/available-variables.md:443-476"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Variable Availability by Phase",
      "description": "Table is missing Computed Variables (env.*, file:*, cmd:*, json:*, date:*, uuid) that are available in all phases",
      "fix_suggestion": "Add a row for 'Computed Variables' showing availability in all phases",
      "source_reference": "src/cook/execution/variables.rs:109-125"
    },
    {
      "type": "incomplete_explanation",
      "severity": "low",
      "section": "Overview",
      "description": "Overview mentions 'same `${variable.name}` interpolation syntax' but doesn't mention that $VAR (unbraced) syntax is also supported for simple variable names",
      "current_content": "Both systems use the same `${variable.name}` interpolation syntax",
      "should_be": "Both systems support `${variable.name}` syntax (recommended) and simple `$VAR` syntax for unbraced variable names",
      "fix_suggestion": "Add a brief note about both syntax options, or add a cross-reference to the 'Variable Interpolation Syntax' section in available-variables.md",
      "source_reference": "src/cook/execution/variables.rs:445 (regex supports both patterns)"
    },
    {
      "type": "unclear_content",
      "severity": "low",
      "section": "Additional Topics",
      "description": "The 'See also' section uses bare markdown links without context or descriptions of what each linked page covers",
      "fix_suggestion": "Add brief descriptions for each link, e.g., '- [Available Variables](available-variables.md) - Complete reference of all built-in and computed variables'",
      "source_reference": "N/A - Documentation improvement"
    }
  ],
  "positive_aspects": [
    "Clear two-tier organization distinguishing built-in vs custom captured variables",
    "Excellent phase availability table providing quick visual reference",
    "Good warning note about phase-specific variable scope",
    "Helpful explanation of reduce phase access to item data via map.results",
    "Clean page structure with logical flow from overview to specifics"
  ],
  "improvement_suggestions": [
    "Add MkDocs Material admonitions (info boxes) to highlight important concepts like variable scoping",
    "Consider adding a simple mermaid diagram showing variable flow between phases (similar to available-variables.md)",
    "Expand the phase availability table to include all variable categories for completeness",
    "Add a 'Quick Start' example showing basic variable usage before the table",
    "Consider adding links to specific sections in sub-pages for common variable types"
  ],
  "cross_references": [
    "available-variables",
    "custom-variable-capture",
    "troubleshooting-variable-interpolation"
  ],
  "links_validated": {
    "total_internal_links": 3,
    "broken_links": 0,
    "all_links_valid": true,
    "validated_links": [
      {"target": "available-variables.md", "status": "valid"},
      {"target": "custom-variable-capture.md", "status": "valid"},
      {"target": "troubleshooting-variable-interpolation.md", "status": "valid"}
    ]
  },
  "metadata": {
    "analyzed_at": "2025-12-27T00:00:00Z",
    "feature_inventory": ".prodigy/mkdocs-analysis/features.json",
    "topics_covered": ["variable interpolation", "phase availability", "built-in variables", "custom variables"],
    "validation_focus": "Auto-discovered page - check for drift and enhance with visual features",
    "source_files_checked": [
      "src/cook/execution/variables.rs",
      "src/cook/workflow/variables.rs",
      "src/cook/execution/mapreduce/utils.rs",
      "src/cook/execution/mapreduce/reduce_phase.rs",
      "docs/variables/available-variables.md"
    ]
  }
}
