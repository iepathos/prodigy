{
  "chapter_id": "workflow-basics",
  "chapter_title": "Workflow Basics",
  "chapter_file": "book/src/workflow-basics.md",
  "drift_detected": true,
  "severity": "high",
  "quality_assessment": "Chapter is incomplete and missing many critical workflow features. Only covers basic structure and environment configuration but lacks documentation for all command types, advanced features, and conditional execution.",
  "issues": [
    {
      "type": "missing_content",
      "severity": "high",
      "section": "Command Types",
      "description": "Chapter only shows 'shell' and 'claude' commands but doesn't document test, goal_seek, foreach, validate, analyze, or handler commands",
      "should_add": "Document all available command types: test (deprecated), goal_seek, foreach, validate, analyze, and handler with examples",
      "fix_suggestion": "Add 'Command Types' section explaining each command type with YAML examples",
      "source_reference": "src/config/command.rs:WorkflowStepCommand (lines 280-356)"
    },
    {
      "type": "missing_content",
      "severity": "high",
      "section": "Advanced Command Options",
      "description": "Missing documentation for on_failure, on_success, when (conditional), timeout, capture_output, capture_format, capture_streams, and output_file",
      "should_add": "Document all step-level options: on_failure, on_success, when, timeout, capture_output, capture_format, capture_streams, output_file",
      "fix_suggestion": "Add 'Advanced Step Options' section showing how to use conditional execution, error handling, timeouts, and output capture",
      "source_reference": "src/cook/workflow/executor.rs:WorkflowStep (lines 477-600)"
    },
    {
      "type": "missing_content",
      "severity": "high",
      "section": "Conditional Execution",
      "description": "No documentation of 'when:' field for conditional step execution based on expressions",
      "should_add": "Explain when: field for conditional execution with expression syntax and examples",
      "fix_suggestion": "Add subsection on conditional execution showing when: expressions with variable checks",
      "source_reference": "src/config/command.rs:WorkflowStepCommand.when (line 343)"
    },
    {
      "type": "missing_content",
      "severity": "medium",
      "section": "Output Capture",
      "description": "No documentation of output capture functionality (capture, capture_format, capture_streams)",
      "should_add": "Document capture: variable name, capture_format: (string|json|lines|number|boolean), capture_streams: (stdout|stderr|both)",
      "fix_suggestion": "Add 'Output Capture' section explaining how to capture command output to variables with format options",
      "source_reference": "src/cook/workflow/executor.rs:WorkflowStep.capture (lines 512-520)"
    },
    {
      "type": "missing_content",
      "severity": "medium",
      "section": "Error Handling",
      "description": "No documentation of on_failure and on_success handlers for step-level error handling",
      "should_add": "Document on_failure and on_success configuration for conditional command execution",
      "fix_suggestion": "Add 'Error Handling' subsection with examples of on_failure and on_success configurations",
      "source_reference": "src/config/command.rs:TestDebugConfig (lines 166-183)"
    },
    {
      "type": "missing_content",
      "severity": "medium",
      "section": "Working Directory",
      "description": "No mention of working_dir option for setting command working directory",
      "should_add": "Document working_dir: option for setting per-step working directory",
      "fix_suggestion": "Add to advanced options section with example of working_dir usage",
      "source_reference": "src/cook/workflow/executor.rs:WorkflowStep.working_dir"
    },
    {
      "type": "incomplete_explanation",
      "severity": "medium",
      "section": "Merge Workflow",
      "description": "Merge workflow shown but not explained - what it's for, when to use it, available variables",
      "should_add": "Explain merge workflow purpose, execution context, and available ${merge.*} variables",
      "fix_suggestion": "Add explanation of merge workflow concept with merge.worktree, merge.source_branch, merge.target_branch variables",
      "source_reference": "src/config/mapreduce.rs:MergeWorkflow (lines 86-94)"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Variable Interpolation",
      "description": "Chapter shows ${env:VAR} and ${merge.VAR} syntax but doesn't explain variable interpolation comprehensively",
      "should_add": "Add section on variable interpolation syntax, available variable types, and escaping",
      "fix_suggestion": "Add 'Variables and Interpolation' section or cross-reference to variables chapter",
      "source_reference": "src/cook/execution/interpolation.rs"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Test Command Deprecation",
      "description": "test: command exists but is deprecated - not documented",
      "should_add": "Note that test: is deprecated in favor of shell: with on_failure:",
      "fix_suggestion": "Add deprecation note in commands section",
      "source_reference": "src/config/command.rs:WorkflowStepCommand.test comment (line 293)"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Handler Commands",
      "description": "handler: command type for modular extensibility not documented",
      "should_add": "Document handler: command type for custom extensible commands",
      "fix_suggestion": "Add advanced section on handler commands if user-facing, or note internal-only if not",
      "source_reference": "src/cook/workflow/executor.rs:HandlerStep"
    }
  ],
  "positive_aspects": [
    "Clear introduction distinguishing standard vs MapReduce workflows",
    "Good progression from simple to full configuration format",
    "Environment configuration well documented (env, secrets, env_files, profiles)",
    "Shows both simple array and full configuration formats",
    "Merge workflow example provided",
    "Cross-references to other chapters included"
  ],
  "improvement_suggestions": [
    "Add complete 'Command Reference' section documenting all command types",
    "Add 'Advanced Features' section for conditional execution, error handling, output capture",
    "Add practical examples showing real workflow patterns",
    "Add troubleshooting section for common issues",
    "Cross-reference related chapters (variables, error-handling, advanced)",
    "Add table of contents or quick reference for command options",
    "Consider splitting into 'Basic Workflows' and 'Advanced Workflows' chapters"
  ],
  "metadata": {
    "analyzed_at": "2025-10-05",
    "feature_inventory": "Analyzed directly from codebase (features.json not available)",
    "topics_covered": [
      "Workflow types (standard vs MapReduce)",
      "Basic structure (simple array format)",
      "Full configuration format",
      "Environment configuration",
      "Merge workflows"
    ],
    "topics_missing": [
      "All command types (test, goal_seek, foreach, validate, analyze, handler)",
      "Conditional execution (when:)",
      "Error handling (on_failure, on_success)",
      "Output capture (capture, capture_format, capture_streams)",
      "Timeouts",
      "Working directory",
      "Variable interpolation details"
    ],
    "validation_focus": "Check basic workflow syntax and structure documentation",
    "codebase_sources": [
      "src/config/workflow.rs",
      "src/config/command.rs",
      "src/cook/workflow/executor.rs",
      "src/config/mapreduce.rs"
    ]
  }
}
