{
  "chapter_id": "workflow-basics",
  "chapter_title": "Workflow Basics",
  "chapter_file": "book/src/workflow-basics.md",
  "drift_detected": true,
  "severity": "medium",
  "quality_assessment": "Chapter is generally accurate but has a critical field name inconsistency and some missing configuration details. Examples work but use incorrect field name.",
  "issues": [
    {
      "type": "incorrect_example",
      "severity": "high",
      "section": "Output Capture (line 154-159)",
      "description": "Chapter shows 'capture:' field for output capture, but YAML config uses 'capture_output:' field",
      "current_content": "- shell: \"git rev-parse HEAD\"\n  id: \"get-commit\"\n  capture: \"commit_hash\"       # Modern: variable name to capture output\n  capture_format: \"string\"     # Format type (see below)\n  capture_streams: \"stdout\"    # Which streams to capture (default)",
      "should_be": "- shell: \"git rev-parse HEAD\"\n  id: \"get-commit\"\n  capture_output: \"commit_hash\"  # Variable name to capture output\n  capture_format: \"string\"       # Format type (see below)\n  capture_streams: \"stdout\"      # Which streams to capture (default)",
      "fix_suggestion": "Replace all instances of 'capture:' with 'capture_output:' throughout the Output Capture section. The internal WorkflowStep struct uses 'capture' but the YAML WorkflowStepCommand field is 'capture_output'.",
      "source_reference": "src/config/command.rs:368 (capture_output field), src/cook/workflow/executor.rs:319 (normalized as 'capture')"
    },
    {
      "type": "outdated_information",
      "severity": "medium",
      "section": "Output Capture (line 181-184)",
      "description": "Backward compatibility note says 'capture' is recommended but this is misleading - the YAML field is 'capture_output'",
      "current_content": "**Backward compatibility:**\n- `capture` - Recommended for simple output capture (just the output string)\n- `capture_output` - Legacy field that stores full metadata including `exit_code`, `success`, and `duration`. Use `capture` for new workflows unless you need the extra metadata.",
      "should_be": "**Note:**\n- `capture_output` - Captures command output to a variable name (string) or enables capture (boolean)\n- When set to a string, the output is stored in a variable with that name\n- Additional metadata (exit_code, success, duration) is automatically captured as sub-fields: `varname.exit_code`, `varname.success`, `varname.duration`",
      "fix_suggestion": "Clarify that capture_output is the actual YAML field name and explain how it works with metadata. Remove the 'modern vs legacy' distinction as it's confusing and incorrect.",
      "source_reference": "src/config/command.rs:368, src/cook/workflow/variables.rs:516-538 (metadata capture)"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Working Directory Control",
      "description": "Chapter mentions 'cwd' and 'working_dir' as aliases but doesn't show them in the Available Fields table",
      "should_add": "Add 'cwd'/'working_dir' row to the Command-Level Options table showing it's an alias for working directory control",
      "fix_suggestion": "Update the Basic Options code example section at line 113-121 - the table format mentions it but a structured table would be clearer",
      "source_reference": "Line 119 shows 'cwd: \"./subproject\"' with comment about alias"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Command Types",
      "description": "Chapter mentions 'validate:' command type but doesn't explain it's for implementation completeness validation",
      "should_add": "Brief description of what validation command does: validates that implementation matches spec/plan requirements",
      "fix_suggestion": "Add a one-sentence description after line 99: \"Validate command checks implementation completeness against requirements\"",
      "source_reference": "src/config/command.rs:380 (validate field)"
    },
    {
      "type": "incomplete_explanation",
      "severity": "low",
      "section": "Capture Formats",
      "description": "Capture formats section is good but doesn't mention that metadata is always captured as sub-fields",
      "should_add": "Explain that when using capture_output with a variable name, the system automatically creates sub-fields like `varname.exit_code`, `varname.success`, `varname.stderr`, etc.",
      "fix_suggestion": "Add a note after the capture formats list explaining automatic metadata sub-field creation",
      "source_reference": "src/cook/workflow/variables.rs:505-538"
    }
  ],
  "positive_aspects": [
    "Clear progression from simple to full format",
    "Good examples of environment configuration",
    "Comprehensive coverage of command types",
    "Helpful 'Next Steps' section linking to other chapters",
    "Working directory control is well documented",
    "Capture formats are accurately listed (string, json, lines, number, boolean)",
    "Capture streams options are correct (stdout, stderr, both)",
    "Merge workflow section is accurate and helpful",
    "Environment profiles example is clear and practical"
  ],
  "improvement_suggestions": [
    "Fix the critical 'capture:' vs 'capture_output:' field name inconsistency throughout",
    "Clarify the backward compatibility note about capture_output",
    "Add more real-world examples of complex workflows",
    "Consider adding a troubleshooting subsection for common beginner mistakes",
    "Add a callout box explaining the difference between YAML field names and internal normalized field names"
  ],
  "metadata": {
    "analyzed_at": "2025-01-12",
    "feature_inventory": ".prodigy/book-analysis/features.json",
    "topics_covered": [
      "Workflow structure",
      "Command types",
      "Environment configuration",
      "Output capture",
      "Merge workflows",
      "Command-level options"
    ],
    "validation_focus": "Check basic workflow syntax and structure documentation"
  }
}
