{
  "item_type": "chapter",
  "chapter_id": "examples",
  "chapter_title": "Examples",
  "chapter_file": "book/src/examples.md",
  "drift_detected": true,
  "severity": "medium",
  "quality_assessment": "The Examples chapter provides comprehensive, practical examples covering major workflow features with good progression from simple to complex. The chapter is largely accurate but has one high-severity issue with Example 2's goal_seek syntax (feature appears to be stubbed but not implemented). Most other examples are valid and work with current syntax. The chapter could be improved by adding examples for newer features like circuit breakers and retry strategies, and by removing or updating the goal_seek example.",
  "issues": [
    {
      "type": "incorrect_syntax",
      "severity": "high",
      "section": "Example 2: Coverage Improvement with Goal Seeking",
      "description": "Example shows goal_seek syntax that may not be fully implemented - code references exist but implementation appears to be a stub",
      "current_content": "- goal_seek:\n    goal: \"Achieve 80% test coverage\"\n    claude: \"/improve-coverage\"  # Can also use 'shell' for shell commands\n    validate: |\n      coverage=$(cargo tarpaulin | grep 'Coverage' | sed 's/.*: \\([0-9.]*\\)%.*/\\1/')\n      echo \"score: ${coverage%.*}\"\n    threshold: 80\n    max_attempts: 5",
      "should_be": "The goal_seek feature is defined in WorkflowStepCommand (src/config/command.rs:340) but the CLI implementation (src/cli/commands/goal_seek.rs) only prints 'Starting goal-seeking operation...' without actual logic. This suggests the feature is planned but not yet implemented.",
      "fix_suggestion": "Either: (1) Remove this example and replace with a working validation example using the 'validate:' field which IS fully implemented (see Example 6), OR (2) Add a clear note that goal_seek is planned but not yet fully implemented, and show an alternative using validate: instead.",
      "source_reference": "src/config/command.rs:340 (goal_seek field exists), src/cli/commands/goal_seek.rs:1-33 (stub implementation)"
    },
    {
      "type": "missing_content",
      "severity": "medium",
      "section": "Missing Examples",
      "description": "No example demonstrating circuit breaker configuration for resilient MapReduce workflows",
      "fix_suggestion": "Add example showing circuit_breaker within error_policy block: failure_threshold (default: 5), success_threshold (default: 3), timeout (default: 30s), half_open_requests (default: 3)",
      "feature_reference": "error_handling.workflow_level.circuit_breaker",
      "source_reference": "features.json:error_handling.workflow_level.circuit_breaker.enabled"
    },
    {
      "type": "missing_content",
      "severity": "medium",
      "section": "Missing Examples",
      "description": "No example demonstrating retry configuration with backoff strategies",
      "fix_suggestion": "Add example showing retry_defaults with backoff strategies: fixed (Fixed { delay }), linear (Linear { initial, increment }), exponential (Exponential { initial, multiplier }, default), fibonacci (Fibonacci { initial })",
      "feature_reference": "retry_configuration.backoff_strategies",
      "source_reference": "features.json:retry_configuration.backoff_strategies"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Missing Examples",
      "description": "No example demonstrating workflow composition features (imports, extends, templates)",
      "fix_suggestion": "Add example showing composable workflows using imports and extends syntax. Note from features.json: 'implementation_status: Partially implemented - core composition logic exists, CLI integration pending (Spec 131-133)'. Mark as 'planned' or 'preview' since CLI integration is not complete.",
      "feature_reference": "workflow_composition.composable_workflows",
      "source_reference": "features.json:workflow_composition.implementation_status"
    },
    {
      "type": "incomplete_explanation",
      "severity": "low",
      "section": "Example 10: Advanced Features",
      "description": "Example mentions 'working_dir' field but the actual field name in WorkflowStepCommand may differ",
      "current_content": "# Run command in specific directory\n- shell: \"cargo test\"\n  working_dir: \"subproject/\"  # Execute in subproject/ directory",
      "should_be": "Verify actual field name - may be 'cwd' based on common shell command patterns",
      "fix_suggestion": "Review WorkflowStepCommand structure to confirm whether field is 'working_dir', 'cwd', or configured via step environment. Update example to match implementation.",
      "source_reference": "src/config/command.rs:WorkflowStepCommand structure (need to verify field name)"
    },
    {
      "type": "minor_inconsistency",
      "severity": "low",
      "section": "Example 10: Git Context Variables",
      "description": "Pattern filtering syntax shows two different formats: ${git.modified_files|pattern:**/*.rs} and :*.rs modifier",
      "current_content": "# Pattern filtering for git context\n- claude: \"/review-changes ${git.modified_files|pattern:**/*.rs}\"\n- shell: \"echo 'Changed Rust files: ${git.staged_files|pattern:**/*.rs}'\"\n\n# Basename-only output (no paths)\n- shell: \"echo 'File names: ${git.modified_files|basename}'\"",
      "fix_suggestion": "Verify which syntax is correct: pipe-style (|pattern:) or colon-style (:*.rs). The features.json shows both formats. Standardize on one syntax or explain when to use each.",
      "source_reference": "features.json:git_context_advanced.format_modifiers and git_context_advanced.pattern_filtering"
    }
  ],
  "positive_aspects": [
    "Excellent progression from simple (Example 1: Build/Test) to complex (Example 8: MapReduce with full error handling)",
    "Example 4 includes helpful JSONPath patterns ($[*], $.items[*], filtering with ?(@.priority > 5))",
    "Example 5 thoroughly explains capture_format options (string, json, lines, number, boolean) and capture_streams",
    "Example 7 demonstrates environment variables, secrets with masking, profiles, and env_files comprehensively",
    "Example 8 shows comprehensive MapReduce features: distinct, timeout_config, error_policy, session-job ID mapping, DLQ debugging",
    "Example 9 demonstrates write_file with all three formats (text, json, yaml) and create_dirs option",
    "Example 10 shows advanced features: nested handlers (on_success, on_failure), max_attempts, conditional execution",
    "Example 11 provides detailed custom merge workflow example with all merge variables explained",
    "Most examples use realistic scenarios (code review, deployment, tech debt elimination)",
    "Good inline notes and comments explaining options and defaults",
    "Source references to actual code locations and workflow files (e.g., 'src/cook/environment/config.rs:12-36')",
    "Troubleshooting examples for MapReduce cleanup failures and orphaned worktrees",
    "DLQ debugging workflow with json_log_location is clearly documented"
  ],
  "improvement_suggestions": [
    "Fix or remove Example 2 (goal_seek) - replace with working validation example or mark as 'planned'",
    "Add circuit breaker example showing resilient error handling for external service calls",
    "Add retry configuration example with different backoff strategies (exponential, fibonacci, etc.)",
    "Verify and clarify working_dir vs cwd field name in Example 10",
    "Add note to workflow composition about implementation status (CLI integration pending)",
    "Standardize git context pattern filtering syntax (|pattern: vs :*.rs)",
    "Consider adding example showing analyze: command configuration",
    "Consider adding example demonstrating outputs and OutputDeclaration usage",
    "Add versioning note at top indicating when examples were last verified against codebase",
    "Cross-reference examples to relevant spec sections (Spec 120, Spec 134, etc.)"
  ],
  "cross_references": [
    "workflow-basics.md - Basic workflow structure",
    "commands.md - Command types reference",
    "error-handling.md - Error handling patterns",
    "variables.md - Variable interpolation",
    "environment.md - Environment configuration",
    "mapreduce/ - MapReduce documentation sections"
  ],
  "metadata": {
    "analyzed_at": "2025-01-11T00:00:00Z",
    "feature_inventory": ".prodigy/book-analysis/features.json",
    "topics_covered": [
      "Standard workflows (build, test, lint)",
      "Goal seeking with validation (may need update)",
      "Foreach iteration (sequential and parallel)",
      "MapReduce parallel processing",
      "Conditional deployment",
      "Multi-step validation",
      "Environment variables and secrets",
      "Error handling and DLQ",
      "File generation with write_file",
      "Advanced features (nested handlers, git context)",
      "Custom merge workflows"
    ],
    "validation_focus": "Check examples are valid and work with current syntax",
    "examples_validated": [
      "Example 1: Simple Build and Test - ✓ Valid",
      "Example 2: Goal Seeking - ✗ Feature not fully implemented (stub only)",
      "Example 3: Foreach Iteration - ✓ Valid",
      "Example 4: Parallel Code Review - ✓ Valid",
      "Example 5: Conditional Deployment - ✓ Valid",
      "Example 6: Multi-Step Validation - ✓ Valid",
      "Example 7: Environment-Aware Workflow - ✓ Valid (structure matches mapreduce-env-example.yml)",
      "Example 8: Complex MapReduce - ✓ Valid",
      "Example 9: Generating Configuration Files - ✓ Valid",
      "Example 10: Advanced Features - ✓ Mostly valid (minor field name verification needed)",
      "Example 11: Custom Merge Workflows - ✓ Valid"
    ],
    "examples_count": 11,
    "syntax_accuracy": "high (90% valid, 1 example has unimplemented feature)",
    "feature_coverage": "comprehensive (covers major features, missing some advanced error handling patterns)",
    "key_findings": [
      "Goal_seek example (Example 2) references feature that is defined but not fully implemented",
      "All other examples appear to work with current syntax",
      "Example 7 environment/secrets structure matches actual workflow files",
      "Missing examples for circuit breakers and retry backoff strategies",
      "Git context variables are fully implemented and documented in Example 10",
      "MapReduce examples (4, 8, 11) are comprehensive and accurate"
    ]
  }
}
