{
  "item_type": "chapter",
  "chapter_id": "examples",
  "chapter_title": "Examples",
  "chapter_file": "book/src/examples.md",
  "drift_detected": true,
  "severity": "high",
  "quality_assessment": "The Examples chapter provides comprehensive, practical examples covering major workflow features. However, there are several high-severity issues: (1) Example 7's secrets syntax is partially incorrect - it shows nested 'env' block and direct string values, but actual structure requires secrets at top level with 'secret: true' and 'value' fields; (2) Missing examples for critical features like workflow composition, custom merge workflows, and circuit breakers; (3) Some timeout and error handling syntax needs verification against actual implementation. The chapter would benefit from correcting the secrets syntax, adding missing feature examples, and verifying all syntax against current implementation.",
  "issues": [
    {
      "type": "outdated_information",
      "severity": "high",
      "section": "Example 7: Environment-Aware Workflow - Secrets",
      "description": "Secrets syntax shown is incorrect - it shows secrets nested under 'env' block with direct string values, but secrets should be at top level with 'secret: true' and 'value' fields",
      "current_content": "# Global environment variables\nenv:\n  NODE_ENV: production\n  API_URL: https://api.production.com\n\n# Secrets (automatically masked in logs)\nsecrets:\n  API_KEY:\n    secret: true\n    value: \"${SECRET_API_KEY}\"",
      "should_be": "# Global environment variables\nenv:\n  NODE_ENV: production\n  API_URL: https://api.production.com\n  # Secrets with masking\n  API_KEY:\n    secret: true\n    value: \"${SECRET_API_KEY}\"",
      "fix_suggestion": "Merge secrets into the 'env' block instead of having a separate 'secrets' section. Secrets are just environment variables with 'secret: true' flag for masking.",
      "source_reference": "features.json environment.secrets, environment.global_env"
    },
    {
      "type": "missing_content",
      "severity": "high",
      "section": "Examples",
      "description": "Missing example for workflow composition/templates feature - a major capability",
      "feature_reference": "advanced_features.workflow_composition",
      "fix_suggestion": "Add Example 11 showing workflow template composition with imports, extends, parameters, and registry usage. This is documented in features.json as a key feature.",
      "source_reference": "features.json advanced_features.workflow_composition"
    },
    {
      "type": "missing_content",
      "severity": "high",
      "section": "Examples",
      "description": "Missing example for custom merge workflows - important for MapReduce worktree merging",
      "feature_reference": "mapreduce.phases.merge",
      "fix_suggestion": "Add example showing merge workflow configuration with merge-specific variables (${merge.worktree}, ${merge.source_branch}, ${merge.target_branch}, ${merge.session_id})",
      "source_reference": "features.json mapreduce.phases.merge, variables.merge"
    },
    {
      "type": "outdated_information",
      "severity": "medium",
      "section": "Example 8: Complex MapReduce with Error Handling",
      "description": "timeout_config example shows commented-out fields (item_timeout_secs, phase_timeout_secs) that may not be implemented",
      "current_content": "timeout_config:\n  agent_timeout_secs: 600\n  # Additional timeout levels for fine-grained control:\n  # item_timeout_secs: 300\n  # phase_timeout_secs: 3600",
      "fix_suggestion": "Verify if item_timeout_secs and phase_timeout_secs are actually implemented. If not, remove the commented examples or mark clearly as 'planned but not yet implemented'.",
      "source_reference": "features.json mapreduce.configuration.timeout_config"
    },
    {
      "type": "outdated_information",
      "severity": "medium",
      "section": "Example 2: Coverage Improvement with Goal Seeking",
      "description": "Example shows 'max_attempts' field at goal_seek level, but this may need to be inside on_incomplete handler",
      "current_content": "goal_seek:\n  goal: \"Achieve 80% test coverage\"\n  claude: \"/improve-coverage\"\n  validate: |...\n  threshold: 80\n  max_attempts: 5",
      "fix_suggestion": "Verify that max_attempts is supported directly on goal_seek command. If not, move it to the on_incomplete handler or validation section.",
      "source_reference": "command_types.goal_seek.fields in features.json"
    },
    {
      "type": "missing_content",
      "severity": "medium",
      "section": "Examples",
      "description": "Missing example for circuit breaker error handling",
      "feature_reference": "error_handling.workflow_level.circuit_breaker",
      "fix_suggestion": "Add example showing circuit breaker configuration (failure_threshold, success_threshold, timeout, half-open state) for preventing cascading failures",
      "source_reference": "features.json error_handling.workflow_level.circuit_breaker"
    },
    {
      "type": "missing_content",
      "severity": "medium",
      "section": "Example 8: MapReduce",
      "description": "Example shows 'distinct' field in comment but doesn't explain what it does",
      "current_content": "distinct: \"item.id\"  # Prevent duplicate work items based on ID field",
      "fix_suggestion": "The example is actually present with good inline comment. However, add a note section explaining how distinct works and why it's useful for idempotent processing.",
      "source_reference": "features.json mapreduce.input_processing.distinct"
    },
    {
      "type": "missing_content",
      "severity": "medium",
      "section": "Example 8: MapReduce Resume",
      "description": "Shows resume commands but doesn't explain session-job ID bidirectional mapping",
      "current_content": "# Unified resume command (auto-detects ID type)\nprodigy resume mapreduce-1234567890",
      "fix_suggestion": "Add explanation that session-job mapping is bidirectional and stored in ~/.prodigy/state/{repo_name}/mappings/, allowing resume with either ID type.",
      "source_reference": "features.json mapreduce.checkpoint_resume (Spec 134)"
    },
    {
      "type": "incomplete_explanation",
      "severity": "low",
      "section": "Example 10: Advanced Features",
      "description": "Future capabilities section mentions git context variables that are actually implemented",
      "current_content": "Future capabilities (not yet implemented, but planned):\n- Git context variables: Access files_modified, files_added from git operations",
      "fix_suggestion": "Git context variables ARE implemented per features.json. Move git.modified_files, git.staged_files, git.unstaged_files out of 'Future capabilities' and show working examples.",
      "source_reference": "features.json variables.git_context"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Example 10: Advanced Features",
      "description": "Missing example for git context pattern filtering",
      "feature_reference": "advanced_features.git_context_advanced",
      "fix_suggestion": "Add example showing git context with pattern filtering: ${git.modified_files|pattern:**/*.rs} and ${git.staged_files|basename}",
      "source_reference": "features.json advanced_features.git_context_advanced"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Examples",
      "description": "Missing example for retry configuration with backoff strategies",
      "feature_reference": "error_handling.retry_configuration",
      "fix_suggestion": "Add example showing backoff strategies (fixed, linear, exponential, fibonacci) with retry_budget and conditional_retry",
      "source_reference": "features.json error_handling.retry_configuration.backoff_strategies"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Example 3: Foreach Iteration",
      "description": "Example shows 'parallel' field but doesn't verify all three modes work",
      "current_content": "parallel: 3  # Options: false (sequential), true (default parallelism), or number (specific count)",
      "fix_suggestion": "Verify against implementation that parallel supports: false (sequential), true (default), and number (specific count). Update comment if implementation differs.",
      "source_reference": "command_types.foreach.fields.parallel"
    }
  ],
  "positive_aspects": [
    "Excellent progression from simple to complex examples (Example 1 â†’ Example 10)",
    "Comprehensive coverage of major workflow types: standard, foreach, goal_seek, mapreduce",
    "Example 4 includes helpful JSONPath patterns and advanced filtering syntax",
    "Example 5 thoroughly explains capture_format options (string, json, lines, number, boolean)",
    "Example 5 shows advanced capture_streams usage with multiple streams",
    "Example 7 demonstrates environment variables, profiles, and env_files",
    "Example 8 shows comprehensive MapReduce with error_policy, resume, and DLQ debugging",
    "Example 9 demonstrates write_file with all three formats (text, json, yaml)",
    "Example 10 shows nested error handlers and complex conditionals",
    "Most examples use realistic scenarios (build/test, code review, deployment, tech debt)",
    "Good inline notes explaining options and defaults",
    "Troubleshooting section for MapReduce cleanup failures (orphaned worktrees)",
    "Resume commands shown for both session ID and job ID",
    "DLQ debugging with json_log_location is documented"
  ],
  "improvement_suggestions": [
    "Fix secrets syntax in Example 7 - merge into env block instead of separate section",
    "Add Example 11 for workflow composition (imports, extends, parameters)",
    "Add example for custom merge workflows with merge variables",
    "Add example for circuit breaker error handling configuration",
    "Add example for retry backoff strategies (exponential, fibonacci, etc.)",
    "Add example for git context pattern filtering (${git.modified_files|pattern:**/*.rs})",
    "Move implemented git context variables out of 'Future capabilities' section",
    "Verify and fix timeout_config example - clarify what fields are actually supported",
    "Verify goal_seek max_attempts placement is correct",
    "Add explanation of session-job ID bidirectional mapping",
    "Add versioning note at top indicating when examples were last verified",
    "Group examples by category (Basic, MapReduce, Advanced, Error Handling)",
    "Add performance considerations section for MapReduce parallelism tuning",
    "Add 'Common Pitfalls' section based on troubleshooting experience",
    "Cross-reference examples to relevant spec sections"
  ],
  "metadata": {
    "analyzed_at": "2025-11-09T23:43:36Z",
    "feature_inventory": ".prodigy/book-analysis/features.json",
    "topics_covered": [
      "Standard workflows",
      "MapReduce parallel processing",
      "Goal seeking with validation",
      "Foreach iteration (sequential and parallel)",
      "Conditional execution",
      "Output capture with multiple formats and streams",
      "Environment variables, secrets, and profiles",
      "Error handling and policies",
      "File generation with write_file",
      "Advanced features (nested handlers, conditionals, working_dir)"
    ],
    "validation_focus": "Check examples are valid and work with current syntax",
    "examples_count": 10,
    "syntax_accuracy": "medium (secrets syntax incorrect, some fields need verification)",
    "feature_coverage": "broad but missing workflow composition, merge workflows, circuit breakers",
    "key_findings": [
      "Secrets syntax needs major correction - should be in env block, not separate section",
      "Missing examples for critical features: workflow composition, custom merge",
      "Git context variables ARE implemented but marked as 'future'",
      "timeout_config and goal_seek max_attempts syntax needs verification",
      "Good coverage of MapReduce, capture, and error handling features"
    ]
  }
}
