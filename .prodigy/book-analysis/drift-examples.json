{
  "item_type": "chapter",
  "chapter_id": "examples",
  "chapter_title": "Examples",
  "chapter_file": "book/src/examples.md",
  "drift_detected": true,
  "severity": "medium",
  "quality_assessment": "The Examples chapter provides comprehensive, practical examples covering major workflow features. Most examples are syntactically correct and use current APIs. However, there are several issues: (1) Example 7's secrets syntax is partially incorrect - it shows direct string values and nested provider format, but the actual SecretValue structure requires 'secret: true' and 'value' fields; (2) Example 10 uses incorrect field name 'cwd' instead of 'working_dir' in the working directory example; (3) Missing examples for newer features like timeout_config, orphaned worktree cleanup, and concurrent resume protection. The chapter would benefit from correcting the secrets syntax and adding examples for advanced features.",
  "issues": [
    {
      "type": "outdated_information",
      "severity": "high",
      "section": "Example 7: Environment-Aware Workflow - Secrets",
      "description": "Secrets syntax shown is incorrect - it suggests both direct string values and nested provider format, but the actual SecretValue structure requires 'secret: true' and 'value' fields",
      "current_content": "secrets:\n  # Simple format - just the secret value\n  API_KEY: \"${SECRET_API_KEY}\"\n\n  # OR provider format - fetch from external secret store\n  # API_KEY:\n  #   provider: env\n  #   key: SECRET_API_KEY\n  #   version: latest  # optional",
      "should_be": "secrets:\n  API_KEY:\n    secret: true\n    value: \"${SECRET_API_KEY}\"\n    # Optional: provider field for external secret stores\n    # provider: \"vault\"",
      "fix_suggestion": "Update Example 7 to show correct secrets syntax matching SecretValue structure. Secrets require an object with 'secret: true' and 'value' fields, not direct string values.",
      "source_reference": "src/config/workflow.rs:26 (secrets: Option<HashMap<String, SecretValue>>), features.json environment.secrets.syntax"
    },
    {
      "type": "incorrect_example",
      "severity": "medium",
      "section": "Example 10: Advanced Features - Working Directory",
      "description": "Example shows 'cwd' as field name for working directory, but the correct field is 'working_dir' per StepEnvironment",
      "current_content": "**Example of working_dir usage:**\n```yaml\n# Run command in specific directory\n- shell: \"cargo test\"\n  working_dir: \"subproject/\"  # Execute in subproject/ directory\n\n# Or set for multiple commands\n- shell: \"npm install\"\n  env:\n    NODE_ENV: production\n  working_dir: \"frontend/\"\n```",
      "should_be": "The field name is correct as 'working_dir' in the example, but the earlier text mentions 'cwd' which is incorrect",
      "fix_suggestion": "The example code itself is correct with 'working_dir', but ensure all text references use 'working_dir' consistently, not 'cwd'",
      "source_reference": "features.json advanced_features.working_directory.field: cwd (this may be outdated in features.json - actual implementation uses working_dir)"
    },
    {
      "type": "missing_content",
      "severity": "medium",
      "section": "Advanced Features / MapReduce",
      "description": "Missing examples for advanced MapReduce timeout configuration (timeout_config with multiple levels)",
      "fix_suggestion": "Add example showing timeout_config usage in MapReduce with agent_timeout_secs, item timeout, and phase timeout configuration beyond the simple agent_timeout_secs field",
      "source_reference": "features.json mapreduce.configuration.map.timeout_config (Advanced timeout configuration with agent, item, and phase timeouts)"
    },
    {
      "type": "missing_content",
      "severity": "medium",
      "section": "Session Management / Resume",
      "description": "No example demonstrating session-job ID mapping or resume with either ID type",
      "fix_suggestion": "Add note or example showing 'prodigy resume <session-id>' and 'prodigy resume-job <job-id>' with explanation of bidirectional mapping",
      "source_reference": "features.json session_management.resume.session_job_mapping (Bidirectional mapping stored in ~/.prodigy/state/{repo_name}/mappings/)"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Git Integration / Worktree Management",
      "description": "No example or mention of orphaned worktree cleanup after failures",
      "fix_suggestion": "Add note about 'prodigy worktree clean-orphaned <job_id>' for cleanup failures, especially relevant for MapReduce workflows",
      "source_reference": "features.json git_integration.worktree_management.orphaned_cleanup"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Session Management / Concurrent Resume",
      "description": "No example demonstrating concurrent resume protection or RAII-based locking behavior",
      "fix_suggestion": "Add troubleshooting note showing what users see when attempting concurrent resume (lock held error message)",
      "source_reference": "features.json mapreduce.capabilities.concurrent_protection, session_management.resume.concurrent_protection"
    },
    {
      "type": "incomplete_explanation",
      "severity": "low",
      "section": "Example 4: Parallel Code Review",
      "description": "JSONPath explanation is helpful but limited to simple array access",
      "current_content": "**Note:** JSONPath `\"$[*]\"` matches all items in the root array.",
      "fix_suggestion": "Add example or note showing more complex JSONPath patterns like $.items[*].files[*] for nested extraction or $.items[?(@.priority > 5)] for filtering",
      "source_reference": "features.json mapreduce.configuration.map.json_path (JSONPath expression for item extraction, default: $[*], example: $.items[*])"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Example 8: MapReduce",
      "description": "No example showing 'distinct' field usage for deduplication",
      "fix_suggestion": "Add 'distinct: item.id' or similar to Example 8 MapReduce configuration with explanation that it prevents duplicate work item processing",
      "source_reference": "features.json mapreduce.filtering.distinct (Field for deduplication)"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Example 5: Advanced Capture Options",
      "description": "Example shows capture_streams in comment but doesn't demonstrate actual usage",
      "current_content": "**Advanced capture options:**\n```yaml\n# Capture specific streams (stdout, stderr, exit_code, success, duration)\n- shell: \"cargo build 2>&1\"\n  capture_output: \"build_output\"\n  capture_streams: \"stdout,stderr,exit_code\"  # Capture multiple streams",
      "fix_suggestion": "The example is actually present and correct - no fix needed. This was incorrectly flagged.",
      "source_reference": "Example 5 lines 120-127 already shows capture_streams usage"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Observability / DLQ",
      "description": "Example 8 mentions DLQ but doesn't show how to use json_log_location for debugging failed agents",
      "fix_suggestion": "Add note explaining that DLQ entries include json_log_location field pointing to Claude JSON logs for debugging",
      "source_reference": "features.json observability.claude_json_logs.access (DLQ entries include json_log_location field for failed agents)"
    }
  ],
  "positive_aspects": [
    "Comprehensive coverage of major workflow types: standard, MapReduce, goal_seek, foreach",
    "Good progression from simple (Example 1) to complex (Example 8, 10)",
    "Excellent documentation of capture_format options with all supported formats (string, json, lines, number, boolean)",
    "Clear explanation of capture_streams for advanced output capture with example code",
    "Strong coverage of conditional execution with 'when' clauses and examples",
    "Good MapReduce examples showing practical use cases (parallel code review, tech debt elimination)",
    "Helpful notes explaining JSONPath, capture formats, and error_policy defaults",
    "Examples include realistic use cases that developers will encounter",
    "Good coverage of nested error handlers with on_failure/on_success",
    "Working directory (working_dir) usage shown with correct syntax in Example 10",
    "Foreach parallel options well-documented with clear inline comment",
    "Error policy example (Example 8) shows comprehensive configuration with defaults explained",
    "Environment profiles example includes clear CLI activation instructions",
    "Write_file example demonstrates all three formats (text, json, yaml) with options"
  ],
  "improvement_suggestions": [
    "Correct secrets syntax in Example 7 to match SecretValue structure (secret: true, value: ...)",
    "Verify and update features.json if 'cwd' should be 'working_dir' everywhere",
    "Add example showing session-job ID mapping and resume with either ID type",
    "Include example or note about orphaned worktree cleanup workflow",
    "Show advanced timeout_config usage beyond simple agent_timeout_secs",
    "Add troubleshooting section for common example-related issues (JSONPath errors, timeout tuning)",
    "Show example of DLQ retry workflow with json_log_location for debugging",
    "Include example demonstrating offset and max_items for batch processing",
    "Add example showing distinct field for deduplication in MapReduce",
    "Add more complex JSONPath examples (nested extraction, filtering)",
    "Show concurrent resume protection error message in troubleshooting",
    "Add cross-references between examples (e.g., 'see Example 5 for capture_format options')",
    "Consider adding an example demonstrating git context variables in reduce phase"
  ],
  "metadata": {
    "analyzed_at": "2025-01-11T19:37:34Z",
    "feature_inventory": ".prodigy/book-analysis/features.json",
    "topics_covered": [
      "Standard workflows",
      "MapReduce parallel processing",
      "Goal seeking with validation",
      "Foreach iteration (sequential and parallel)",
      "Conditional execution",
      "Output capture with multiple formats",
      "Environment variables and secrets",
      "Profiles for multi-environment deployment",
      "Error handling and policies",
      "File generation with write_file",
      "Advanced features (nested handlers, conditionals, working directory)"
    ],
    "validation_focus": "Check examples are valid and work with current syntax",
    "examples_count": 10,
    "syntax_accuracy": "high (with noted exceptions in secrets and field naming)",
    "feature_coverage": "broad but missing some newer features",
    "key_findings": [
      "Secrets syntax needs correction to match SecretValue structure",
      "Working directory field name is correct in example code but text may reference outdated 'cwd'",
      "Missing examples for timeout_config, session-job mapping, orphaned worktree cleanup",
      "Most core features are well-documented with practical examples",
      "Error handling and capture mechanisms are thoroughly explained"
    ]
  }
}
