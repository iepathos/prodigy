{
  "item_type": "subsection",
  "chapter_id": "mapreduce",
  "subsection_id": "workflow-format-comparison",
  "subsection_title": "Workflow Format Comparison",
  "subsection_file": "book/src/mapreduce/workflow-format-comparison.md",
  "feature_mappings": [
    "mapreduce.syntax",
    "workflow.formats"
  ],
  "drift_detected": false,
  "severity": "low",
  "quality_assessment": "Subsection accurately documents the workflow format evolution and syntax differences. The documentation correctly explains both the legacy nested format and the preferred direct array format, and provides clear migration guidance.",
  "issues": [
    {
      "type": "incomplete_explanation",
      "severity": "low",
      "section": "Full Configuration Format",
      "description": "Documentation shows 'secrets' as a top-level field but doesn't explain it's integrated with the 'env' block in modern Prodigy",
      "current_content": "secrets:\n  API_TOKEN:\n    provider: env\n    key: \"GITHUB_TOKEN\"",
      "should_be": "Environment variables with secret masking should be shown as part of the env block with secret: true flag, per Spec 120",
      "fix_suggestion": "Update example to show secrets as part of env block: 'env:\\n  API_TOKEN:\\n    secret: true\\n    provider: env\\n    key: \"GITHUB_TOKEN\"' or clarify that secrets is a separate top-level configuration",
      "source_reference": "src/config/mapreduce.rs:35-40 shows env field with EnvConfig, CLAUDE.md Spec 120 documents env vars with secret flag"
    },
    {
      "type": "unclear_content",
      "severity": "low",
      "section": "Migration Guide",
      "description": "Could benefit from mentioning the deprecation warning that Prodigy emits when using nested format",
      "fix_suggestion": "Add note: 'When using the old nested format, Prodigy emits a warning: \"Using deprecated nested 'commands' syntax in agent_template. Consider using the simplified array format directly under 'agent_template'.\"'",
      "source_reference": "src/config/mapreduce.rs:310 and src/config/mapreduce.rs:347 emit tracing::warn for deprecated syntax"
    },
    {
      "type": "missing_best_practices",
      "severity": "low",
      "section": "Format Decision Tree",
      "description": "Could mention that the simplified format is preferred not just for cleanliness, but also for forward compatibility",
      "fix_suggestion": "Add note in decision tree: 'The direct array syntax is preferred for forward compatibility, as the nested format may be removed in future versions'",
      "source_reference": "src/config/mapreduce.rs comments indicate the old format is deprecated"
    }
  ],
  "positive_aspects": [
    "Clear side-by-side comparison of old vs new syntax",
    "Excellent migration guide with before/after examples",
    "Well-structured decision tree for format selection",
    "Accurate documentation of the untagged enum deserialization supporting both formats",
    "Good explanation of when to use simple array vs full config format for standard workflows",
    "Helpful cross-references to related subsections"
  ],
  "improvement_suggestions": [
    "Add a note about the deprecation warnings in the migration section",
    "Clarify the relationship between 'secrets' and 'env' configuration (are they separate or integrated?)",
    "Consider adding a troubleshooting tip about what to do if workflow fails after migration",
    "Add example showing mixed usage (some commands in new format, some in old - if supported) or explicitly state this isn't possible",
    "Consider adding a timeline or version info for when the new format was introduced"
  ],
  "cross_references": [
    "setup-phase",
    "map-phase",
    "reduce-phase",
    "../workflow-basics/basic-structure"
  ],
  "metadata": {
    "analyzed_at": "2025-11-09T23:43:36Z",
    "feature_inventory": ".prodigy/book-analysis/features.json",
    "topics_covered": [
      "syntax",
      "formats",
      "comparison",
      "migration",
      "backward compatibility"
    ],
    "validation_focus": "Check workflow format comparisons",
    "implementation_verified": [
      "src/config/mapreduce.rs:281-315 - AgentTemplate untagged enum deserialization",
      "src/config/mapreduce.rs:317-352 - ReducePhaseYaml untagged enum deserialization",
      "src/config/mapreduce.rs:96-124 - MergeWorkflow untagged enum deserialization",
      "src/config/mapreduce.rs:192-221 - SetupPhaseConfig untagged enum deserialization"
    ]
  }
}
