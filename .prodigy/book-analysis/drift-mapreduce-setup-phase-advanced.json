{
  "item_type": "subsection",
  "chapter_id": "mapreduce",
  "subsection_id": "setup-phase-advanced",
  "subsection_title": "Setup Phase Advanced",
  "subsection_file": "book/src/mapreduce/setup-phase-advanced.md",
  "feature_mappings": [
    "mapreduce.setup",
    "mapreduce.phases"
  ],
  "drift_detected": true,
  "severity": "medium",
  "quality_assessment": "Documentation is comprehensive and accurate for setup phase features with excellent coverage of CaptureConfig and multiline handling. Has broken links to non-existent subsections that need fixing. Content is well-structured with practical examples and best practices.",
  "issues": [
    {
      "type": "broken_links",
      "severity": "medium",
      "section": "See Also",
      "description": "Two broken internal links to non-existent subsections",
      "broken_links": [
        {
          "link_text": "Worktree Isolation",
          "link_target": "./worktree-isolation.md",
          "expected_file": "book/src/mapreduce/worktree-isolation.md",
          "current_file": "book/src/mapreduce/setup-phase-advanced.md",
          "issue": "File does not exist",
          "suggested_fix": "Create worktree-isolation.md subsection or link to worktree-architecture.md if it exists"
        },
        {
          "link_text": "Map Phase Configuration",
          "link_target": "./map-phase-configuration.md",
          "expected_file": "book/src/mapreduce/map-phase-configuration.md",
          "current_file": "book/src/mapreduce/setup-phase-advanced.md",
          "issue": "File does not exist",
          "suggested_fix": "Remove link until map-phase-configuration.md subsection is created, or reference index.md instead"
        }
      ],
      "fix_suggestion": "Update 'See Also' section to only reference existing subsections. Link to checkpoint-and-resume.md and environment-variables-in-configuration.md (which exist). Consider linking to index.md for worktree and map phase concepts until dedicated subsections are created.",
      "validation_required": true,
      "source_reference": "book/src/mapreduce/setup-phase-advanced.md:180-183"
    },
    {
      "type": "incorrect_link",
      "severity": "low",
      "section": "See Also",
      "description": "Link to 'Environment Variables' points to wrong filename",
      "current_content": "[Environment Variables](./environment-variables.md)",
      "should_be": "[Environment Variables](./environment-variables-in-configuration.md)",
      "fix_suggestion": "Update link to match actual filename: environment-variables-in-configuration.md",
      "source_reference": "book/src/mapreduce/setup-phase-advanced.md:181"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Execution Context",
      "description": "Missing details about checkpoint structure and storage location",
      "feature_reference": "mapreduce.capabilities.checkpoint_resume",
      "fix_suggestion": "Add brief mention: 'Checkpoints are stored in ~/.prodigy/state/{repo_name}/mapreduce/jobs/{job_id}/setup-checkpoint.json and preserve setup outputs, environment state, and captured variables for resume.'",
      "source_reference": "book/src/mapreduce/setup-phase-advanced.md:10"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Common Use Cases",
      "description": "Could clarify that setup runs in isolated parent worktree, not main repository",
      "feature_reference": "mapreduce.isolation.parent_worktree",
      "fix_suggestion": "Add note: 'All setup operations execute in the parent worktree (not the main repository), providing isolation and safety for initialization tasks.'",
      "source_reference": "book/src/mapreduce/setup-phase-advanced.md:17-23"
    }
  ],
  "positive_aspects": [
    "Comprehensive documentation of CaptureConfig with both simple and detailed formats",
    "Excellent explanation of capture source options (stdout, stderr, both, combined) with use cases and examples from tests",
    "Clear documentation of multiline handling options (preserve, join, first_line, last_line, array) with practical table and examples",
    "Good pattern extraction explanation with regex examples and capture group syntax",
    "Strong best practices section covering idempotency, timeout sizing, output capture, and error handling",
    "Accurate implementation references to source code (variable_capture.rs, setup.rs)",
    "Well-structured with clear progression from basics (simple format) to advanced (detailed CaptureConfig)",
    "Includes actual test examples from codebase (variable_capture_test.rs) showing real usage patterns",
    "Documents timeout with both numeric and environment variable syntax",
    "Covers all key setup phase fields: commands, timeout, capture_outputs"
  ],
  "improvement_suggestions": [
    "Fix broken links in 'See Also' section to point to existing files",
    "Add checkpoint storage location and structure details to 'Execution Context'",
    "Consider adding troubleshooting section for common capture issues (JSON parsing failures, regex not matching, size limits exceeded)",
    "Add cross-reference to DLQ subsection for handling setup phase failures",
    "Consider adding example showing how captured variables are used in map phase (${var_name})",
    "Add note about worktree isolation under 'Common Use Cases' for clarity"
  ],
  "cross_references": [
    "checkpoint-and-resume",
    "environment-variables-in-configuration",
    "dead-letter-queue-dlq",
    "worktree-architecture"
  ],
  "metadata": {
    "analyzed_at": "2025-01-11T00:00:00Z",
    "feature_inventory": ".prodigy/book-analysis/features.json",
    "topics_covered": [
      "setup phase",
      "initialization",
      "preprocessing",
      "variable capture",
      "output capture",
      "capture source options",
      "multiline handling",
      "pattern extraction",
      "timeout control",
      "checkpoint creation",
      "best practices"
    ],
    "validation_focus": "Check advanced setup phase features"
  }
}
