{
  "chapter_id": "commands",
  "chapter_title": "Command Types",
  "chapter_file": "book/src/commands.md",
  "drift_detected": true,
  "severity": "medium",
  "quality_assessment": "Chapter is mostly accurate but has some inconsistencies with implementation. The documentation correctly covers most command types and their fields, but the capture_streams field implementation differs from the documented structure.",
  "issues": [
    {
      "type": "incorrect_example",
      "severity": "medium",
      "section": "CaptureStreams Configuration",
      "description": "Chapter documents capture_streams as an object type, but implementation shows it as a struct with specific boolean fields, not a string",
      "current_content": "capture_streams: Option<String>",
      "should_be": "capture_streams: Option<CaptureStreams> where CaptureStreams is a struct with stdout, stderr, exit_code, success, duration boolean fields",
      "fix_suggestion": "Update WorkflowStepCommand struct to use CaptureStreams type instead of String, and update documentation examples to reflect the actual struct fields",
      "source_reference": "src/config/command.rs:350-351, src/cook/workflow/variables.rs:268-292"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Deprecated Fields",
      "description": "Chapter doesn't mention capture_output field is deprecated in favor of capture",
      "should_add": "Document that capture_output (boolean) is deprecated in favor of capture (string variable name)",
      "fix_suggestion": "Add to deprecated fields section: capture_output: true/false is deprecated, use capture: 'variable_name' instead",
      "source_reference": "src/config/command.rs:321-323, src/config/command.rs:358-366"
    },
    {
      "type": "inconsistent_naming",
      "severity": "low",
      "section": "ValidationConfig command field",
      "description": "Documentation correctly notes that 'command' is deprecated in favor of 'shell', which matches implementation",
      "current_content": "command: Option<String> (deprecated)",
      "should_be": "shell: Option<String> or claude: Option<String>",
      "fix_suggestion": "Chapter correctly documents this - no change needed. Implementation matches documentation.",
      "source_reference": "src/cook/workflow/validation.rs:13-23"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "OnIncompleteConfig",
      "description": "Chapter doesn't mention retry_original and strategy fields available in OnIncompleteConfig",
      "should_add": "Document retry_original field (boolean, default false) and strategy field (retry strategy config) in OnIncompleteConfig",
      "fix_suggestion": "Add documentation for retry_original and strategy fields mentioned in chapter lines 128-129 but not detailed in the examples",
      "source_reference": "book/src/commands.md:128-129"
    },
    {
      "type": "incomplete_explanation",
      "severity": "low",
      "section": "Common Command Fields",
      "description": "Several advanced fields are listed but examples don't show their usage",
      "current_content": "Fields listed: handler, retry, on_exit_code, auto_commit, commit_config, step_validate, skip_validation, validation_timeout, ignore_validation_failure",
      "should_be": "Provide examples showing how to use these advanced fields",
      "fix_suggestion": "Add examples section showing usage of handler, retry, on_exit_code, auto_commit, and step_validate fields",
      "source_reference": "book/src/commands.md:194-204"
    }
  ],
  "positive_aspects": [
    "Clear structure with numbered sections for each command type",
    "Good examples for basic command types (shell, claude, goal_seek, foreach)",
    "Comprehensive command reference table with all fields",
    "Properly documents capture_format enum values and examples",
    "Correctly identifies deprecated fields (test:, command: in ValidationConfig)",
    "Good migration examples for deprecated syntax",
    "Validation section is thorough with multiple alternative formats",
    "CaptureStreams documentation accurately describes the fields even though implementation type differs"
  ],
  "improvement_suggestions": [
    "Add examples for advanced fields like handler, retry, on_exit_code",
    "Expand on auto_commit and commit_config usage",
    "Show working_dir examples for command execution in different directories",
    "Add troubleshooting section for common command configuration errors",
    "Include real-world workflow examples combining multiple command types",
    "Document the relationship between on_failure in WorkflowStepCommand vs TestDebugConfig",
    "Clarify when to use capture vs capture_output",
    "Add section on environment variable usage at command level"
  ],
  "metadata": {
    "analyzed_at": "2025-10-05",
    "feature_inventory": "Manual source code analysis (features.json not available)",
    "topics_covered": [
      "Shell commands",
      "Claude commands",
      "Goal-seeking",
      "Foreach",
      "Validation"
    ],
    "validation_focus": "Check all command types and their fields are documented"
  }
}
