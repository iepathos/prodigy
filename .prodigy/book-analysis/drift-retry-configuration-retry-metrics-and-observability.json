{
  "item_type": "subsection",
  "chapter_id": "retry-configuration",
  "subsection_id": "retry-metrics-and-observability",
  "subsection_title": "Retry Metrics and Observability",
  "subsection_file": "book/src/retry-configuration/retry-metrics-and-observability.md",
  "feature_mappings": [],
  "drift_detected": true,
  "severity": "critical",
  "quality_assessment": "Documentation is completely outdated and fictional. The documented API does not exist in the codebase. The `RetryExecutor::metrics()` method exists but the actual RetryMetrics structure is internal and not exposed for workflow-level observation.",
  "issues": [
    {
      "type": "incorrect_example",
      "severity": "critical",
      "section": "Example Usage",
      "description": "The documented example shows synchronous API usage that does not match the actual async implementation",
      "current_content": "let executor = RetryExecutor::new(config);\n// ... execute operations ...\nlet metrics = executor.metrics().await;\n\nprintln!(\"Total attempts: {}\", metrics.total_attempts);",
      "should_be": "RetryExecutor is an internal implementation detail used by the workflow executor. Metrics are not directly accessible to users in workflows.",
      "fix_suggestion": "Document actual retry observability features available to workflow users: event tracking, logs, and execution results. Remove the fictional API example.",
      "source_reference": "src/cook/retry_v2.rs:320-322 (RetryExecutor::metrics is internal)"
    },
    {
      "type": "missing_content",
      "severity": "high",
      "section": "Observability Integration",
      "description": "Missing documentation on how retry events are actually tracked in workflows",
      "fix_suggestion": "Document that retry attempts are logged via tracing infrastructure (info! and warn! macros) and visible in workflow execution logs. Explain verbosity flags for viewing retry logs.",
      "source_reference": "src/cook/retry_v2.rs:247-250"
    },
    {
      "type": "missing_content",
      "severity": "high",
      "section": "Circuit Breaker Observability",
      "description": "No mention of circuit breaker state changes and how they're logged",
      "fix_suggestion": "Add section explaining circuit breaker state transitions are logged (circuit breaker open/closed messages) and how to monitor them in workflow logs.",
      "source_reference": "src/cook/retry_v2.rs:359, 377, 391"
    },
    {
      "type": "missing_content",
      "severity": "medium",
      "section": "Retry Budget Exhaustion",
      "description": "No documentation on retry budget tracking and exhaustion warnings",
      "fix_suggestion": "Explain that retry budget exhaustion generates warning logs ('Retry budget exhausted') visible in workflow output.",
      "source_reference": "src/cook/retry_v2.rs:238-243"
    },
    {
      "type": "outdated_information",
      "severity": "critical",
      "section": "Metrics Structure",
      "description": "Documented metrics fields are accurate but the access pattern is fictional",
      "current_content": "Metrics include:\n- `total_attempts` - Total number of attempts made\n- `successful_attempts` - Number of successful operations\n- `failed_attempts` - Number of failed operations\n- `retries` - Vec of (attempt_number, delay) pairs",
      "should_be": "RetryMetrics is an internal structure. Users observe retry behavior through tracing logs, not direct metric access.",
      "fix_suggestion": "Reframe this section to describe what information is logged during retry operations rather than presenting it as a queryable API.",
      "source_reference": "src/cook/retry_v2.rs:399-422"
    },
    {
      "type": "missing_content",
      "severity": "high",
      "section": "Workflow-Level Observability",
      "description": "No explanation of how retries appear in workflow execution output",
      "fix_suggestion": "Add concrete examples of what users see in workflow output: 'Retrying {context} (attempt {N}/{max}) after {delay}' messages, failure warnings, and circuit breaker alerts.",
      "source_reference": "src/cook/retry_v2.rs:247-250"
    },
    {
      "type": "missing_content",
      "severity": "medium",
      "section": "Troubleshooting with Logs",
      "description": "No guidance on using logs to debug retry issues",
      "fix_suggestion": "Add section on using -v/-vv flags to view retry logs, interpreting retry attempt messages, and identifying retry configuration issues from log output.",
      "source_reference": "N/A - workflow execution pattern"
    },
    {
      "type": "incomplete_explanation",
      "severity": "medium",
      "section": "Integration with Error Handling",
      "description": "No explanation of how retry metrics relate to on_failure handlers and DLQ",
      "fix_suggestion": "Explain the relationship between retry exhaustion, failure handlers, and dead letter queue for MapReduce workflows. Show how retries are the first line of defense before escalating to failure handlers.",
      "source_reference": "Related to MapReduce DLQ documentation"
    }
  ],
  "positive_aspects": [
    "RetryMetrics field descriptions are accurate (total_attempts, successful_attempts, failed_attempts, retries)",
    "Clear structure showing what information is tracked"
  ],
  "improvement_suggestions": [
    "Completely rewrite to focus on user-visible observability (logs, events) rather than internal API",
    "Add concrete examples of what users see in workflow output during retries",
    "Explain how to enable verbose logging to view retry details",
    "Document the relationship between retries and workflow error handling",
    "Add troubleshooting section for common retry patterns in logs",
    "Cross-reference to circuit breaker configuration and its logged state changes",
    "Include example log output showing retry progression and final outcomes"
  ],
  "cross_references": [
    "basic-retry-configuration",
    "backoff-strategies",
    "../mapreduce/event-tracking"
  ],
  "metadata": {
    "analyzed_at": "2025-01-11T03:45:00Z",
    "feature_inventory": ".prodigy/book-analysis/features.json",
    "topics_covered": [
      "Retry metrics",
      "Observability",
      "Monitoring"
    ],
    "validation_focus": "Check retry metrics and observability documentation matches implementation"
  }
}
