{
  "chapter_id": "git-context-advanced",
  "chapter_title": "Advanced Git Context",
  "chapter_file": "book/src/git-context-advanced.md",
  "drift_detected": true,
  "severity": "medium",
  "quality_assessment": "Chapter is well-structured and explains the implemented features clearly, but features.json claims additional capabilities that don't exist in the code. The chapter itself is accurate to the actual implementation.",
  "issues": [
    {
      "type": "missing_feature_in_code",
      "severity": "low",
      "section": "Format Modifiers",
      "description": "features.json claims format modifiers (basename, dirname, extension, relative, count) that are not implemented in the code",
      "current_content": "Chapter documents: json, lines/newline, csv/comma (accurate)",
      "features_json_claims": "basename, dirname, extension, relative, count, list, json",
      "actual_implementation": "Only json, lines/newline, csv/comma, and default space-separated are implemented (src/cook/workflow/git_context.rs:442-447)",
      "fix_suggestion": "features.json should be corrected to match actual implementation. Chapter is already correct.",
      "source_reference": "src/cook/workflow/git_context.rs:442-447 (VariableFormat enum at lines 181-191)"
    },
    {
      "type": "missing_feature_in_code",
      "severity": "low",
      "section": "Pattern Filtering",
      "description": "features.json claims regex patterns and exclusion patterns that are not implemented",
      "current_content": "Chapter correctly documents glob patterns only",
      "features_json_claims": "regex_patterns, exclusions with ! prefix, include_exclude combined filters",
      "actual_implementation": "Only glob patterns using glob::Pattern (src/cook/workflow/git_context.rs:164)",
      "fix_suggestion": "features.json should be corrected to remove non-existent features. Chapter is already correct.",
      "source_reference": "src/cook/workflow/git_context.rs:163-177 (filter_files method)"
    },
    {
      "type": "syntax_discrepancy",
      "severity": "low",
      "section": "Combined Filters",
      "description": "features.json shows pipeline syntax with | that doesn't exist in code",
      "current_content": "Chapter correctly shows :pattern:format syntax",
      "features_json_claims": "Pipeline syntax: ${git.files.modified|*.rs|basename}",
      "actual_implementation": "Colon-based syntax: ${step.files_added:*.rs:json} where only one pattern and one format can be specified",
      "fix_suggestion": "features.json should be corrected to show actual :pattern:format syntax. Chapter is already correct.",
      "source_reference": "src/cook/workflow/git_context.rs:425-450 (resolve_variable method)"
    },
    {
      "type": "inconsistent_variable_naming",
      "severity": "low",
      "section": "Variable Names",
      "description": "features.json uses different variable prefix (git.) vs implementation (step./workflow.)",
      "current_content": "Chapter correctly uses step. and workflow. prefixes",
      "features_json_claims": "Uses git.files.modified, git.changed_files",
      "actual_implementation": "Variables use step.* and workflow.* prefixes, not git.*",
      "fix_suggestion": "features.json should be corrected to use step./workflow. prefixes. Chapter is already correct.",
      "source_reference": "src/cook/workflow/git_context.rs:452-468 (variable path matching)"
    }
  ],
  "positive_aspects": [
    "Chapter accurately documents all implemented features",
    "Clear explanation of pattern filtering with glob syntax",
    "Good examples showing both pattern and format usage",
    "Comprehensive variable reference table",
    "Excellent use case examples (code review, documentation, testing)",
    "Well-organized troubleshooting section",
    "Accurate syntax examples that match implementation"
  ],
  "improvement_suggestions": [
    "Could add a note that only glob patterns are supported (not regex) to prevent confusion",
    "Could clarify that pattern and format modifiers cannot be combined beyond :pattern:format",
    "Could add example showing what happens when no files match a pattern",
    "Could explain performance characteristics of pattern matching"
  ],
  "metadata": {
    "analyzed_at": "2025-11-02",
    "feature_inventory": ".prodigy/book-analysis/features.json",
    "topics_covered": [
      "Pattern filtering",
      "Format modifiers",
      "File patterns",
      "Combined filters",
      "Git context variables"
    ],
    "validation_focus": "Check that pattern filtering syntax, format modifiers, and file pattern options are documented",
    "verdict": "Chapter is accurate and well-written. The drift exists in features.json, not in the chapter documentation."
  }
}
