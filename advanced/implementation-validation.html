<!DOCTYPE HTML>
<html lang="en" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Implementation Validation - Prodigy Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="AI-powered workflow orchestration for development teams">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Prodigy Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/iepathos/prodigy" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/iepathos/prodigy/edit/main/book/src/advanced/implementation-validation.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="implementation-validation"><a class="header" href="#implementation-validation">Implementation Validation</a></h2>
<p>Validate that implementations meet requirements using the <code>validate</code> field.</p>
<h3 id="basic-validation"><a class="header" href="#basic-validation">Basic Validation</a></h3>
<p>Run validation commands after a step completes:</p>
<pre><code class="language-yaml">- claude: "/implement-feature"
  validate:
    shell: "cargo test"
    threshold: 100  # Require 100% completion (default)
</code></pre>
<p><strong>Note</strong>: The <code>threshold</code> field defaults to <strong>100</strong> if not specified, requiring full implementation completion.</p>
<p><strong>Source</strong>: <a href="../../../src/cook/workflow/validation.rs">src/cook/workflow/validation.rs:280-282</a></p>
<h3 id="validation-with-claude"><a class="header" href="#validation-with-claude">Validation with Claude</a></h3>
<p>Use Claude to validate implementation quality:</p>
<pre><code class="language-yaml">- shell: "generate-code.sh"
  validate:
    claude: "/verify-implementation"
    threshold: 95
</code></pre>
<h3 id="multi-step-validation"><a class="header" href="#multi-step-validation">Multi-Step Validation</a></h3>
<p>Run multiple validation commands in sequence using the <code>commands</code> array:</p>
<pre><code class="language-yaml">- claude: "/refactor"
  validate:
    commands:
      - shell: "cargo test"
      - shell: "cargo clippy"
      - shell: "cargo fmt --check"
    threshold: 100
</code></pre>
<p><strong>Convenience Array Syntax</strong>: For simple cases, you can use an array format directly:</p>
<pre><code class="language-yaml">- claude: "/refactor"
  validate:
    - shell: "cargo test"
    - shell: "cargo clippy"
    - shell: "cargo fmt --check"
</code></pre>
<h3 id="validation-with-result-files"><a class="header" href="#validation-with-result-files">Validation with Result Files</a></h3>
<p>Read validation results from a file instead of stdout:</p>
<pre><code class="language-yaml">- claude: "/implement-feature"
  validate:
    shell: "run-validator.sh"
    result_file: "validation-results.json"
    threshold: 95
</code></pre>
<p><strong>When to Use result_file:</strong></p>
<p>The <code>result_file</code> option is useful when you need to separate validation output from command logs:</p>
<ul>
<li><strong>Complex JSON Output</strong>: Validation produces structured JSON that shouldn’t be mixed with logs</li>
<li><strong>Separate Concerns</strong>: Keep validation results separate from command stdout/stderr</li>
<li><strong>Additional Logging</strong>: Validation command produces diagnostic output alongside results</li>
<li><strong>Debugging</strong>: Preserve validation output in a file for later inspection</li>
</ul>
<p>The file must contain valid JSON matching the ValidationResult schema. When the validation command completes, Prodigy reads the specified file and parses it as JSON. If the file doesn’t exist or contains invalid JSON, the validation fails.</p>
<p><strong>Source</strong>: <a href="../../../src/cook/workflow/executor/validation.rs">src/cook/workflow/executor/validation.rs:700-715</a></p>
<h4 id="advanced-result-files-with-commands-array"><a class="header" href="#advanced-result-files-with-commands-array">Advanced: Result Files with Commands Array</a></h4>
<p>You can use <code>result_file</code> with the <code>commands</code> array for multi-step validation where the final result is written to a file:</p>
<pre><code class="language-yaml">- claude: "/implement-spec $ARG"
  validate:
    commands:
      - claude: "/prodigy-validate-spec $ARG --output .prodigy/validation-result.json"
    result_file: ".prodigy/validation-result.json"
    threshold: 100
    on_incomplete:
      claude: "/prodigy-complete-spec $ARG --gaps ${validation.gaps}"
      max_attempts: 5
      commit_required: true
</code></pre>
<p>In this pattern, the validation command writes its results to a JSON file, and Prodigy reads that file after all commands complete.</p>
<p><strong>Source</strong>: Real-world example from <a href="../../../workflows/implement.yml">workflows/implement.yml:6-16</a></p>
<h3 id="handling-incomplete-implementations"><a class="header" href="#handling-incomplete-implementations">Handling Incomplete Implementations</a></h3>
<p>Automatically remediate when validation fails to meet the threshold.</p>
<p><strong>Convenience Array Syntax</strong> - For simple remediation workflows:</p>
<pre><code class="language-yaml">- claude: "/implement-spec"
  validate:
    shell: "check-completeness.sh"
    threshold: 100
    on_incomplete:
      - claude: "/fill-gaps"
      - shell: "cargo fmt"
</code></pre>
<p><strong>Verbose Configuration</strong> - For complex cases requiring additional control:</p>
<pre><code class="language-yaml">- claude: "/implement-spec"
  validate:
    shell: "check-completeness.sh"
    threshold: 100
    on_incomplete:
      claude: "/fill-gaps"
      max_attempts: 2          # Default: 2 (not 3)
      fail_workflow: true      # Default: true
      commit_required: false   # Default: false
</code></pre>
<p><strong>Default Values</strong>:</p>
<ul>
<li><code>max_attempts</code>: <strong>2</strong> (maximum remediation attempts before giving up)</li>
<li><code>fail_workflow</code>: <strong>true</strong> (workflow fails if remediation doesn’t reach threshold)</li>
<li><code>commit_required</code>: <strong>false</strong> (remediation command doesn’t need to create a commit)</li>
</ul>
<p><strong>Source</strong>: <a href="../../../src/cook/workflow/validation.rs">src/cook/workflow/validation.rs:284-289</a></p>
<p>The <code>on_incomplete</code> configuration supports:</p>
<ul>
<li><code>claude</code>: Claude command to execute for gap-filling</li>
<li><code>shell</code>: Shell command to execute for gap-filling</li>
<li><code>commands</code>: Array of commands to execute in sequence</li>
<li><code>max_attempts</code>: Maximum remediation attempts (default: <strong>2</strong>)</li>
<li><code>fail_workflow</code>: Whether to fail workflow if remediation fails (default: <strong>true</strong>)</li>
<li><code>commit_required</code>: Whether remediation command should create a commit (default: <strong>false</strong>)</li>
</ul>
<p><strong>Source</strong>: <a href="../../../src/cook/workflow/validation.rs">src/cook/workflow/validation.rs:123-152</a></p>
<h3 id="timeout-configuration"><a class="header" href="#timeout-configuration">Timeout Configuration</a></h3>
<p>Set a timeout for validation commands to prevent hanging:</p>
<pre><code class="language-yaml">- claude: "/implement-feature"
  validate:
    shell: "long-running-test.sh"
    threshold: 100
    timeout: 300  # 5 minutes timeout
</code></pre>
<p>The <code>timeout</code> field specifies the maximum number of seconds the validation command can run. If the command exceeds this time, it’s terminated and the validation fails.</p>
<p><strong>Source</strong>: <a href="../../../src/cook/workflow/validation.rs">src/cook/workflow/validation.rs:37-39</a></p>
<h3 id="validationresult-schema"><a class="header" href="#validationresult-schema">ValidationResult Schema</a></h3>
<p>When using <code>result_file</code>, the JSON file must match this structure:</p>
<pre><code class="language-json">{
  "completion_percentage": 95.5,
  "status": "incomplete",
  "implemented": [
    "Feature A is fully implemented",
    "Feature B includes unit tests"
  ],
  "missing": [
    "Feature C lacks error handling",
    "Feature D needs integration tests"
  ],
  "gaps": {
    "error_handling": {
      "description": "Missing error handling in parser",
      "location": "src/parser.rs:45",
      "severity": "high",
      "suggested_fix": "Add Result&lt;T, E&gt; return type and handle parse errors"
    }
  }
}
</code></pre>
<p><strong>Fields</strong>:</p>
<ul>
<li><code>completion_percentage</code>: Float (0-100) indicating implementation completeness</li>
<li><code>status</code>: Enum - <code>"complete"</code>, <code>"incomplete"</code>, <code>"failed"</code>, or <code>"skipped"</code></li>
<li><code>implemented</code>: Array of strings describing completed requirements</li>
<li><code>missing</code>: Array of strings describing incomplete requirements</li>
<li><code>gaps</code>: Object mapping gap IDs to GapDetail objects with description, location, severity, and suggested_fix</li>
</ul>
<p><strong>Source</strong>: <a href="../../../src/cook/workflow/validation.rs">src/cook/workflow/validation.rs:216-239</a></p>
<h3 id="validation-patterns"><a class="header" href="#validation-patterns">Validation Patterns</a></h3>
<p><strong>Progressive Validation</strong> - Validate in stages:</p>
<pre><code class="language-yaml">- claude: "/implement-feature"
  validate:
    commands:
      - shell: "cargo check"     # Fast syntax check first
      - shell: "cargo test"      # Then run tests
      - shell: "cargo bench"     # Finally benchmarks
    threshold: 100
    timeout: 600  # 10 minute timeout for all commands
    on_incomplete:
      - claude: "/analyze-failures"
      - claude: "/fix-issues"
</code></pre>
<p><strong>Conditional Validation</strong> - Validate based on previous results:</p>
<pre><code class="language-yaml">- claude: "/optimize-code"
  id: "optimization"
  validate:
    shell: "benchmark.sh"
    threshold: 90

- shell: "verify-performance.sh"
  when: "${optimization.success}"
  validate:
    shell: "stress-test.sh"
    threshold: 100
</code></pre>
<p><strong>Complex Multi-Step Validation with Result Files</strong> - Real-world pattern from Prodigy’s debtmap workflow:</p>
<pre><code class="language-yaml">- claude: "/implement-changes"
  commit_required: true
  validate:
    commands:
      - shell: "just coverage-lcov"
      - shell: "debtmap analyze . --lcov target/coverage/lcov.info --output .prodigy/debtmap-after.json"
      - shell: "debtmap compare --before .prodigy/debtmap-before.json --after .prodigy/debtmap-after.json --output .prodigy/comparison.json"
      - claude: "/validate-improvement --comparison .prodigy/comparison.json --output .prodigy/validation.json"
    result_file: ".prodigy/validation.json"
    threshold: 75
    on_incomplete:
      commands:
        - claude: "/fix-remaining-gaps --validation .prodigy/validation.json"
          commit_required: true
        - shell: "just coverage-lcov"
        - shell: "debtmap analyze . --lcov target/coverage/lcov.info --output .prodigy/debtmap-after.json"
      max_attempts: 5
      fail_workflow: true
</code></pre>
<p><strong>Source</strong>: <a href="../../../workflows/debtmap.yml">workflows/debtmap.yml:26-42</a></p>
<p>This pattern demonstrates:</p>
<ul>
<li>Multiple validation commands executed in sequence</li>
<li>Reading results from a file after all commands complete</li>
<li>Multi-command remediation with commit requirements</li>
<li>Iterative validation and fixing</li>
</ul>
<h3 id="configuration-reference"><a class="header" href="#configuration-reference">Configuration Reference</a></h3>
<p>Complete list of validation configuration fields:</p>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td><code>shell</code></td><td>String</td><td>None</td><td>Shell command to run for validation</td></tr>
<tr><td><code>claude</code></td><td>String</td><td>None</td><td>Claude command to run for validation</td></tr>
<tr><td><code>commands</code></td><td>Array</td><td>None</td><td>Array of commands for multi-step validation</td></tr>
<tr><td><code>threshold</code></td><td>Number</td><td><strong>100</strong></td><td>Completion percentage required (0-100)</td></tr>
<tr><td><code>timeout</code></td><td>Number</td><td>None</td><td>Timeout in seconds for validation commands</td></tr>
<tr><td><code>result_file</code></td><td>String</td><td>None</td><td>File path to read validation results from</td></tr>
<tr><td><code>on_incomplete</code></td><td>Object</td><td>None</td><td>Configuration for handling validation failures</td></tr>
</tbody></table>
</div>
<p><strong>Source</strong>: <a href="../../../src/cook/workflow/validation.rs">src/cook/workflow/validation.rs:11-49</a></p>
<h3 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h3>
<ol>
<li><strong>Use result_file for structured output</strong>: When validation produces JSON results, write them to a file to keep logs clean</li>
<li><strong>Set appropriate timeouts</strong>: Long-running tests should have explicit timeouts to prevent hanging</li>
<li><strong>Start with high thresholds</strong>: Use threshold: 100 for critical workflows, lower for exploratory work</li>
<li><strong>Limit remediation attempts</strong>: Set <code>max_attempts: 2-5</code> to balance thoroughness with workflow time</li>
<li><strong>Require commits for fixes</strong>: Use <code>commit_required: true</code> in <code>on_incomplete</code> to verify fixes were actually made</li>
<li><strong>Progressive validation</strong>: Run fast checks first (syntax), then slower ones (tests, benchmarks)</li>
</ol>
<h3 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h3>
<p><strong>Validation always fails with 0% completion</strong>:</p>
<ul>
<li>Check that your validation command outputs valid JSON to stdout or <code>result_file</code></li>
<li>Verify the JSON structure matches the ValidationResult schema</li>
<li>Use <code>result_file</code> to debug what your validation command is producing</li>
</ul>
<p><strong>Validation times out</strong>:</p>
<ul>
<li>Increase the <code>timeout</code> value for long-running tests</li>
<li>Consider splitting validation into multiple steps with separate timeouts</li>
</ul>
<p><strong>on_incomplete doesn’t fix issues</strong>:</p>
<ul>
<li>Verify <code>max_attempts</code> is set high enough (default is 2)</li>
<li>Check that the remediation command has access to <code>${validation.gaps}</code> for context</li>
<li>Use <code>commit_required: true</code> to ensure fixes are actually committed</li>
</ul>
<p><strong>For more information on error handling</strong>, see <a href="../error-handling.html">Error Handling</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../advanced/timeout-configuration.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../advanced/parallel-iteration-with-foreach.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../advanced/timeout-configuration.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../advanced/parallel-iteration-with-foreach.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
